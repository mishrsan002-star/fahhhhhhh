// Generated by Construct, the game and animation creation tool
// Visit: https://www.construct.net

// workers/domHandler.js
"use strict";window.DOMHandler=class{constructor(t,i){this._iRuntime=t,this._componentId=i,this._hasTickCallback=!1,this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(t,i,e,s){this._iRuntime.PostToRuntimeComponent(this._componentId,t,i,e,s)}PostToRuntimeAsync(t,i,e,s){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,t,i,e,s)}_PostToRuntimeMaybeSync(t,i,e){this._iRuntime.UsesWorker()?this.PostToRuntime(t,i,e):this._iRuntime._GetLocalRuntime()["_OnMessageFromDOM"]({"type":"event","component":this._componentId,"handler":t,"dispatchOpts":e||null,"data":i,"responseId":null})}AddRuntimeMessageHandler(t,i){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,t,i)}AddRuntimeMessageHandlers(t){for(const[i,e]of t)this.AddRuntimeMessageHandler(i,e)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}},window.RateLimiter=class{constructor(t,i){this._callback=t,this._interval=i,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1}SetCanRunImmediate(t){this._canRunImmediate=!!t}Call(){if(-1!==this._timerId)return;const t=Date.now(),i=t-this._lastCallTime,e=this._interval;i>=e&&this._canRunImmediate?(this._lastCallTime=t,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(e-i,4))}_RunCallback(){this._ignoreReset=!0,this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1,this._lastCallTime=Date.now(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._timerCallFunc=null}};

// workers/domElementHandler.js
"use strict";{class e{constructor(e){this._elem=e,this._hadFirstUpdate=!1,this._isVisibleFlag=!0,this._wantHtmlIndex=-1,this._actualHtmlIndex=-1,this._htmlZIndex=-1}SetVisibleFlag(e){this._isVisibleFlag=!!e}GetVisibleFlag(){return this._isVisibleFlag}HadFirstUpdate(){return this._hadFirstUpdate}SetHadFirstUpdate(){this._hadFirstUpdate=!0}GetWantHTMLIndex(){return this._wantHtmlIndex}SetWantHTMLIndex(e){this._wantHtmlIndex=e}GetActualHTMLIndex(){return this._actualHtmlIndex}SetActualHTMLIndex(e){this._actualHtmlIndex=e}SetHTMLZIndex(e){this._htmlZIndex=e}GetHTMLZIndex(){return this._htmlZIndex}GetElement(){return this._elem}}window.DOMElementHandler=class extends self.DOMHandler{constructor(e,t){super(e,t),this._elementMap=new Map,this._autoAttach=!0,this.AddRuntimeMessageHandlers([["create",e=>this._OnCreate(e)],["destroy",e=>this._OnDestroy(e)],["set-visible",e=>this._OnSetVisible(e)],["update-position",e=>this._OnUpdatePosition(e)],["update-state",e=>this._OnUpdateState(e)],["focus",e=>this._OnSetFocus(e)],["set-css-style",e=>this._OnSetCssStyle(e)],["set-attribute",e=>this._OnSetAttribute(e)],["remove-attribute",e=>this._OnRemoveAttribute(e)]]),this.AddDOMElementMessageHandler("get-element",e=>e)}SetAutoAttach(e){this._autoAttach=!!e}AddDOMElementMessageHandler(e,t){this.AddRuntimeMessageHandler(e,e=>{const n=e["elementId"],s=this.GetElementById(n);return t(s,e)})}AddDOMElementMessageHandlers(e){for(const[t,n]of e)this.AddDOMElementMessageHandler(t,n)}_OnCreate(t){const n=t["elementId"],s=this.CreateElement(n,t),i=new e(s);this._elementMap.set(n,i),s.style.boxSizing="border-box",s.style.display="none",i.SetVisibleFlag(t["isVisible"]);const l=this._GetFocusElement(s);l.addEventListener("focus",e=>this._OnFocus(n)),l.addEventListener("blur",e=>this._OnBlur(n));const a=t["htmlIndex"];if(i.SetWantHTMLIndex(a),i.SetHTMLZIndex(t["htmlZIndex"]),this._autoAttach){const e=this.GetRuntimeInterface().GetAvailableHTMLIndex(a);i.SetActualHTMLIndex(e);this.GetRuntimeInterface().GetHTMLWrapElement(e).appendChild(s)}}CreateElement(e,t){throw new Error("required override")}DestroyElement(e){}_OnDestroy(e){const t=e["elementId"],n=this.GetElementById(t);this.DestroyElement(n),this._autoAttach&&n.parentElement.removeChild(n),this._elementMap.delete(t)}PostToRuntimeElement(e,t,n){n||(n={}),n["elementId"]=t,this.PostToRuntime(e,n)}_PostToRuntimeElementMaybeSync(e,t,n){n||(n={}),n["elementId"]=t,this._PostToRuntimeMaybeSync(e,n)}_OnSetVisible(e){if(!this._autoAttach)return;const t=this._elementMap.get(e["elementId"]),n=t.GetElement();t.HadFirstUpdate()?n.style.display=e["isVisible"]?"":"none":t.SetVisibleFlag(e["isVisible"])}_OnUpdatePosition(e){if(!this._autoAttach)return;const t=this._elementMap.get(e["elementId"]),n=t.GetElement(),s=this.GetRuntimeInterface();n.style.left=e["left"]+"px",n.style.top=e["top"]+"px",n.style.width=e["width"]+"px",n.style.height=e["height"]+"px";const i=e["fontSize"];null!==i&&(n.style.fontSize=i+"em");const l=e["htmlIndex"];t.SetWantHTMLIndex(l);const a=s.GetAvailableHTMLIndex(l);if(a!==t.GetActualHTMLIndex()){n.remove();s.GetHTMLWrapElement(a).appendChild(n),t.SetActualHTMLIndex(a),s._UpdateHTMLElementsZOrder()}const d=e["htmlZIndex"];d!==t.GetHTMLZIndex()&&(t.SetHTMLZIndex(d),s._UpdateHTMLElementsZOrder()),t.HadFirstUpdate()||(t.SetHadFirstUpdate(),t.GetVisibleFlag()&&(n.style.display=""))}_OnHTMLLayersChanged(){if(this._autoAttach)for(const e of this._elementMap.values()){const t=this.GetRuntimeInterface().GetAvailableHTMLIndex(e.GetWantHTMLIndex()),n=e.GetActualHTMLIndex();if(-1!==t&&-1!==n&&t!==n){const n=e.GetElement();n.remove();this.GetRuntimeInterface().GetHTMLWrapElement(t).appendChild(n),e.SetActualHTMLIndex(t)}}}_GetAllElementStatesForZOrderUpdate(){return this._autoAttach?[...this._elementMap.values()]:null}_OnUpdateState(e){const t=this.GetElementById(e["elementId"]);this.UpdateState(t,e)}UpdateState(e,t){throw new Error("required override")}_GetFocusElement(e){return e}_OnFocus(e){this.PostToRuntimeElement("elem-focused",e)}_OnBlur(e){this.PostToRuntimeElement("elem-blurred",e)}_OnSetFocus(e){const t=this._GetFocusElement(this.GetElementById(e["elementId"]));e["focus"]?t.focus():t.blur()}_OnSetCssStyle(e){const t=this.GetElementById(e["elementId"]),n=e["prop"],s=e["val"];n.startsWith("--")?t.style.setProperty(n,s):t.style[n]=s}_OnSetAttribute(e){this.GetElementById(e["elementId"]).setAttribute(e["name"],e["val"])}_OnRemoveAttribute(e){this.GetElementById(e["elementId"]).removeAttribute(e["name"])}GetElementById(e){const t=this._elementMap.get(e);if(!t)throw new Error(`no element with id ${e}`);return t.GetElement()}}}

// workers/domSide.js
"use strict";{const e=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),t=/android/i.test(navigator.userAgent),s=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/|nwjs)/i.test(navigator.userAgent);let r=0;function n(e){const t=document.createElement("script");return t.async=!1,t.type="module",e.isStringSrc?new Promise(s=>{const n="c3_resolve_"+r;++r,self[n]=s,t.textContent=e.str+`\n\nself["${n}"]();`,document.head.appendChild(t)}):new Promise((s,r)=>{t.onload=s,t.onerror=r,t.src=e,document.head.appendChild(t)})}async function i(){if(!navigator["userActivation"]||"undefined"==typeof OffscreenCanvas)return!1;try{let e=!1;const t=new Blob(['\n\tself.addEventListener("message", () =>\n\t{\n\t\ttry {\n\t\t\tconst offscreenCanvas = new OffscreenCanvas(32, 32);\n\t\t\tconst gl = offscreenCanvas.getContext("webgl");\n\t\t\tself.postMessage(!!gl);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.warn("Feature detection worker error:", err);\n\t\t\tself.postMessage(false);\n\t\t}\n\t});'],{"type":"text/javascript"}),s=new Worker(URL.createObjectURL(t),{get type(){e=!0}}),r=await new Promise(e=>{s.addEventListener("message",t=>{s.terminate(),e(t.data)}),s.postMessage("")});return e&&r}catch(e){return console.warn("Error feature detecting worker mode: ",e),!1}}let a=new Audio;const o={"audio/webm; codecs=opus":!!a.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!a.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!a.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!a.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!a.canPlayType("audio/mp4"),"audio/mpeg":!!a.canPlayType("audio/mpeg")};async function l(e){const t=await c(e);return new TextDecoder("utf-8").decode(t)}function c(e){return new Promise((t,s)=>{const r=new FileReader;r.onload=e=>t(e.target.result),r.onerror=e=>s(e),r.readAsArrayBuffer(e)})}a=null;const d=[];let h=0;const p=8;window["RealFile"]=window["File"];const m=[],u=new Map,_=new Map;let w=0;const y=[];self.runOnStartup=function(e){if("function"!=typeof e)throw new Error("runOnStartup called without a function");y.push(e)};const f=new Set(["cordova","playable-ad-single-file","playable-ad-zip","instant-games"]);function g(e){return f.has(e)}let v=!1;window.RuntimeInterface=class r{constructor(e){if(this._useWorker=e.useWorker,this._messageChannelPort=null,this._runtimeBaseUrl="",this._scriptFolder=e.scriptFolder,this._worker=null,this._localRuntime=null,this._domHandlers=[],this._runtimeDomHandler=null,this._isFirstSizeUpdate=!0,this._canvasLayers=[],this._pendingRemoveElements=[],this._pendingUpdateHTMLZOrder=!1,this._updateHTMLZOrderRAFCallback=()=>this._DoUpdateHTMLElementsZOrder(),this._isExportingToVideo=!1,this._exportToVideoDuration=0,this._jobScheduler=null,this._rafId=-1,this._rafFunc=()=>this._OnRAFCallback(),this._rafCallbacks=new Set,this._wrapperInitResolve=null,this._wrapperComponentIds=[],this._exportType=e.exportType,this._isFileProtocol="file"===location.protocol.substr(0,4),this._directoryHandles=[],"playable-ad-single-file"!==this._exportType&&"playable-ad-zip"!==this._exportType&&"instant-games"!==this._exportType||(this._useWorker=!1),s&&(this._useWorker=!1),"cordova"===this._exportType&&this._useWorker&&t){const e=/Chrome\/(\d+)/i.exec(navigator.userAgent);e&&parseInt(e[1],10)>=90||(this._useWorker=!1)}this.IsAnyWebView2Wrapper()?self["chrome"]["webview"].addEventListener("message",e=>this._OnWrapperMessage(e.data,e["additionalObjects"])):"macos-wkwebview"===this._exportType?self["C3WrapperOnMessage"]=e=>this._OnWrapperMessage(JSON.parse(e)):"linux-cef"===this._exportType&&self["c3_linux_cef_set_message_callback"](e=>this._OnWrapperMessage(JSON.parse(e))),this._localFileBlobs=null,this._localFileStrings=null,"html5"!==this._exportType||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available."),this.AddRuntimeComponentMessageHandler("canvas","update-size",e=>this._OnUpdateCanvasSize(e)),this.AddRuntimeComponentMessageHandler("canvas","set-html-layer-count",e=>this["_OnSetHTMLLayerCount"](e)),this.AddRuntimeComponentMessageHandler("canvas","cleanup-html-layers",()=>this._OnCleanUpHTMLLayers()),this.AddRuntimeComponentMessageHandler("canvas","update-html-layer-dom-state",e=>this._UpdateHTMLLayerDOMProperties(e["layersDomState"])),this.AddRuntimeComponentMessageHandler("runtime","cordova-fetch-local-file",e=>this._OnCordovaFetchLocalFile(e)),this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",e=>this._OnCreateJobWorker(e)),this.AddRuntimeComponentMessageHandler("runtime","send-wrapper-extension-message",e=>this._OnSendWrapperExtensionMessage(e)),"cordova"===this._exportType?document.addEventListener("deviceready",()=>this._Init(e)):this._Init(e),this._skipAndroidVirtualKeyboardDetection=0}Release(){this._CancelAnimationFrame(),this._messageChannelPort&&(this._messageChannelPort.onmessage=null,this._messageChannelPort=null),this._worker&&(this._worker.terminate(),this._worker=null),this._localRuntime&&(this._localRuntime.Release(),this._localRuntime=null);for(const{canvas:e,htmlWrap:t}of this._canvasLayers)e.remove(),t.remove();this._canvasLayers.length=0}GetMainCanvas(){return this._canvasLayers[0].canvas}GetAvailableHTMLIndex(e){return Math.min(e,this._canvasLayers.length-1)}GetHTMLWrapElement(e){if(e<0||e>=this._canvasLayers.length)throw new RangeError("invalid canvas layer");return this._canvasLayers[e].htmlWrap}"_GetHTMLWrapElement"(e){return this.GetHTMLWrapElement(e)}GetRuntimeBaseURL(){return this._runtimeBaseUrl}UsesWorker(){return this._useWorker}GetExportType(){return this._exportType}IsFileProtocol(){return this._isFileProtocol}GetScriptFolder(){return this._scriptFolder}IsiOSCordova(){return e&&"cordova"===this._exportType}IsiOSWebView(){const t=navigator.userAgent;return e&&g(this._exportType)||navigator["standalone"]||/crios\/|fxios\/|edgios\//i.test(t)}IsAndroid(){return t}IsAndroidWebView(){return t&&g(this._exportType)}IsWindowsWebView2(){return"windows-webview2"===this._exportType||!!("preview"===this._exportType&&window["chrome"]&&window["chrome"]["webview"]&&window["chrome"]["webview"]["postMessage"])}IsAnyWebView2Wrapper(){return this.IsWindowsWebView2()||"xbox-uwp-webview2"===this._exportType}SkipNextAndroidVirtualKeyboardDetection(){this.IsAndroidWebView()&&this._skipAndroidVirtualKeyboardDetection++}CanDoAndroidVirtualKeyboardDetection(){return this._CanDoAndroidVirtualKeyboardDetection().next().value}*_CanDoAndroidVirtualKeyboardDetection(){if(!this.IsAndroidWebView())return!0;yield 0===this._skipAndroidVirtualKeyboardDetection,this._skipAndroidVirtualKeyboardDetection>0&&this._skipAndroidVirtualKeyboardDetection--}async _Init(e){if(this._useWorker){await i()||(this._useWorker=!1)}if("macos-wkwebview"===this._exportType&&this._SendWrapperMessage({"type":"ready"}),this.IsAnyWebView2Wrapper()||"macos-wkwebview"===this._exportType||"linux-cef"===this._exportType){this._SetupDesktopWrapperPolyfills();const e=await this._InitWrapper();this._wrapperComponentIds=e["registeredComponentIds"]}if("playable-ad-single-file"===this._exportType&&(this._localFileBlobs=self["c3_base64files"],this._localFileStrings={},await this._ConvertDataUrisToBlobs()),"nwjs"===this._exportType&&self["nw"]){if(self["nw"]["Window"]["get"]()["on"]("close",()=>self["nw"]["App"]["quit"]()),self["nw"]["App"]["manifest"]["c3-steam-mode"]){let e=0;this._AddRAFCallback(()=>{e++,document.documentElement.style.opacity=e%2==0?"1":"0.999"})}}if(e.runtimeBaseUrl)this._runtimeBaseUrl=e.runtimeBaseUrl;else{const e=location.origin;this._runtimeBaseUrl=("null"===e?"file:///":e)+location.pathname;const t=this._runtimeBaseUrl.lastIndexOf("/");-1!==t&&(this._runtimeBaseUrl=this._runtimeBaseUrl.substr(0,t+1))}const t=new MessageChannel;if(this._messageChannelPort=t.port1,this._messageChannelPort.onmessage=e=>this["_OnMessageFromRuntime"](e.data),window["c3_addPortMessageHandler"]&&window["c3_addPortMessageHandler"](e=>this._OnMessageFromDebugger(e)),this._jobScheduler=new self.JobSchedulerDOM(this),await this._jobScheduler.Init(),"object"==typeof window["StatusBar"]&&window["StatusBar"]["hide"](),"object"==typeof window["AndroidFullScreen"])try{await new Promise((e,t)=>{window["AndroidFullScreen"]["immersiveMode"](e,t)})}catch(e){console.error("Failed to enter Android immersive mode: ",e)}this._useWorker?await this._InitWorker(e,t.port2):await this._InitDOM(e,t.port2)}_GetCommonRuntimeOptions(e){return{"runtimeBaseUrl":this._runtimeBaseUrl,"previewUrl":location.href,"windowInnerWidth":this._GetWindowInnerWidth(),"windowInnerHeight":this._GetWindowInnerHeight(),"cssDisplayMode":this.GetCssDisplayMode(),"devicePixelRatio":window.devicePixelRatio,"isFullscreen":r.IsDocumentFullscreen(),"swClientId":window["cr_swClientId"]||"","exportType":e.exportType,"isNWjs":"undefined"!=typeof nw,"fileMap":globalThis.c3_swFileMap??new Map(Object.entries(this._localFileBlobs??{})),"scriptFolder":this._scriptFolder,"isDebug":new URLSearchParams(self.location.search).has("debug"),"ife":!!self.ife,"jobScheduler":this._jobScheduler.GetPortData(),"supportedAudioFormats":o,"isFileProtocol":this._isFileProtocol,"isiOSCordova":this.IsiOSCordova(),"isiOSWebView":this.IsiOSWebView(),"isWindowsWebView2":this.IsWindowsWebView2(),"isAnyWebView2Wrapper":this.IsAnyWebView2Wrapper(),"wrapperComponentIds":this._wrapperComponentIds,"isFBInstantAvailable":void 0!==self["FBInstant"]}}async _InitWorker(e,t){const s=e.workerMainUrl;"preview"===this._exportType?(this._worker=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((e,t)=>{const r=s=>{this._worker.removeEventListener("message",r),s.data&&"ok"===s.data["type"]?e():t()};this._worker.addEventListener("message",r),this._worker.postMessage({"type":"construct-worker-init","import":new URL(s,this._runtimeBaseUrl).toString()})})):this._worker=await this.CreateWorker(s,{type:"module",name:"Runtime"});const r=document.createElement("canvas");r.style.display="none";const n=r["transferControlToOffscreen"]();document.body.appendChild(r);const i=document.createElement("div");i.className="c3htmlwrap",i.setAttribute("interactive",""),document.body.appendChild(i),this._canvasLayers.push({canvas:r,htmlWrap:i,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window["c3canvas"]=r,self["C3_InsertHTMLPlaceholders"]&&self["C3_InsertHTMLPlaceholders"](),this._worker.postMessage(Object.assign(this._GetCommonRuntimeOptions(e),{"type":"init-runtime","isInWorker":!0,"messagePort":t,"canvas":n,"runtimeScriptList":e.runtimeScriptList,"projectMainScriptPath":e.projectMainScriptPath,"javaScriptInEventsPath":e.javaScriptInEventsPath,"typeScriptInEventsPath":e.typeScriptInEventsPath}),[t,n,...this._jobScheduler.GetPortTransferables()]),this._domHandlers=m.map(e=>new e(this)),this._FindRuntimeDOMHandler(),this._runtimeDomHandler._AddDefaultCanvasEventHandlers(r),this._runtimeDomHandler._AddDefaultHTMLWrapEventHandlers(i),this._runtimeDomHandler._EnableWindowResizeEvent(),self["c3_callFunction"]=(e,t)=>this._runtimeDomHandler._InvokeFunctionFromJS(e,t),"preview"===this._exportType&&(self["goToLastErrorScript"]=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async _InitDOM(e,t){const s=document.createElement("canvas");s.style.display="none",document.body.appendChild(s);const r=document.createElement("div");r.className="c3htmlwrap",r.setAttribute("interactive",""),document.body.appendChild(r),this._canvasLayers.push({canvas:s,htmlWrap:r,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window["c3canvas"]=s,self["C3_InsertHTMLPlaceholders"]&&self["C3_InsertHTMLPlaceholders"](),this._domHandlers=m.map(e=>new e(this)),this._FindRuntimeDOMHandler(),this._runtimeDomHandler._AddDefaultCanvasEventHandlers(s),this._runtimeDomHandler._AddDefaultHTMLWrapEventHandlers(r);const i=await Promise.all(e.runtimeScriptList.map(e=>this._MaybeGetPlatformSpecificScriptURL(e)));await Promise.all(i.map(e=>n(e)));const a=e.projectMainScriptPath,o=e.javaScriptInEventsPath,l=e.typeScriptInEventsPath;if(a)try{if(await n(a),"preview"===this._exportType&&!globalThis.C3_ProjectMainScriptOK)throw new Error("main script did not run to completion")}catch(e){this._RemoveLoadingMessage(),console.error("Error loading project main script: ",e),alert(`Failed to load the project main script (${a}). Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the script. Press F12 and check the console for error details.`)}if(o)try{if(await n(o),"preview"===this._exportType&&!globalThis.C3.JavaScriptInEvents)throw new Error("JavaScript in events did not run to completion")}catch(e){this._RemoveLoadingMessage(),console.error("Error loading JavaScript in events: ",e),alert("Failed to load JavaScript in events. Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}if(l)try{if(await n(l),"preview"===this._exportType&&!globalThis.C3.TypeScriptInEvents)throw new Error("TypeScript in events did not run to completion")}catch(e){this._RemoveLoadingMessage(),console.error("Error loading TypeScript in events: ",e),alert("Failed to load TypeScript in events. Check all your TypeScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}const c=Object.assign(this._GetCommonRuntimeOptions(e),{"isInWorker":!1,"messagePort":t,"canvas":s,"runOnStartupFunctions":y});this._runtimeDomHandler._EnableWindowResizeEvent(),this._OnBeforeCreateRuntime(),this._localRuntime=self["C3_CreateRuntime"](c),await self["C3_InitRuntime"](this._localRuntime,c)}async CreateWorker(e,t){if(e.startsWith("blob:"))return new Worker(e,t);if("cordova"===this._exportType&&this._isFileProtocol){const s=await this.CordovaFetchLocalFileAsArrayBuffer(e),r=new Blob([s],{type:"application/javascript"});return new Worker(URL.createObjectURL(r),t)}if("playable-ad-single-file"===this._exportType){const s=this._localFileBlobs[e];if(!s)throw new Error("missing script: "+e);return new Worker(URL.createObjectURL(s),t)}const s=new URL(e,location.href);if(location.origin!==s.origin){const e=await fetch(s);if(!e.ok)throw new Error("failed to fetch worker script");const r=await e.blob();return new Worker(URL.createObjectURL(r),t)}return new Worker(s,t)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,1)}GetCssDisplayMode(){if(this.IsAnyWebView2Wrapper())return"standalone";const e=this.GetExportType();return new Set(["cordova","nwjs","macos-wkwebview","linux-cef"]).has(e)?"standalone":window.matchMedia("(display-mode: fullscreen)").matches?"fullscreen":window.matchMedia("(display-mode: standalone)").matches?"standalone":window.matchMedia("(display-mode: minimal-ui)").matches?"minimal-ui":navigator["standalone"]?"standalone":"browser"}_OnBeforeCreateRuntime(){this._RemoveLoadingMessage()}_RemoveLoadingMessage(){const e=window["cr_previewLoadingElem"];e&&(e.parentElement.removeChild(e),window["cr_previewLoadingElem"]=null)}async _OnCreateJobWorker(e){const t=await this._jobScheduler._CreateJobWorker();return{"outputPort":t,"transferables":[t]}}_OnUpdateCanvasSize(e){if(this.IsExportingToVideo())return;const t=e["styleWidth"]+"px",s=e["styleHeight"]+"px",r=e["marginLeft"]+"px",n=e["marginTop"]+"px";for(const{canvas:e,htmlWrap:i}of this._canvasLayers)e.style.width=t,e.style.height=s,e.style.marginLeft=r,e.style.marginTop=n,i.style.width=t,i.style.height=s,i.style.marginLeft=r,i.style.marginTop=n,this._isFirstSizeUpdate&&(e.style.display="",i.style.display="");document.documentElement.style.setProperty("--construct-scale",e["displayScale"]),this._isFirstSizeUpdate=!1}"_OnSetHTMLLayerCount"(e){const t=e["count"],s=e["layersDomState"],r=e["immediate"],n=e["styleWidth"]+"px",i=e["styleHeight"]+"px",a=e["marginLeft"]+"px",o=e["marginTop"]+"px",l=[],c=[];if(t<this._canvasLayers.length)for(;this._canvasLayers.length>t;){const{canvas:e,htmlWrap:t}=this._canvasLayers.pop();t.remove(),this._useWorker&&!r?this._pendingRemoveElements.push(e):e.remove()}else if(t>this._canvasLayers.length)for(let e=0,s=t-this._canvasLayers.length;e<s;++e){const e=document.createElement("canvas");if(e.classList.add("c3overlay"),this._useWorker){const t=e["transferControlToOffscreen"]();l.push(t),c.push(t)}else l.push(e);document.body.appendChild(e);const t=document.createElement("div");t.classList.add("c3htmlwrap","c3overlay"),t.setAttribute("interactive",""),document.body.appendChild(t),e.style.width=n,e.style.height=i,e.style.marginLeft=a,e.style.marginTop=o,t.style.width=n,t.style.height=i,t.style.marginLeft=a,t.style.marginTop=o,this._runtimeDomHandler._AddDefaultCanvasEventHandlers(e),this._runtimeDomHandler._AddDefaultHTMLWrapEventHandlers(t),this._canvasLayers.push({canvas:e,htmlWrap:t,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}})}this._UpdateHTMLLayerDOMProperties(s);for(const e of this._domHandlers)e instanceof window.DOMElementHandler&&e._OnHTMLLayersChanged();return this._UpdateHTMLElementsZOrder(),{"addedCanvases":l,"transferables":c}}_UpdateHTMLLayerDOMProperties(e){for(let t=0,s=Math.min(this._canvasLayers.length,e.length);t<s;++t){const{htmlWrap:s,lastHtmlLayerDomState:r}=this._canvasLayers[t],n=e[t],i=n["isVisible"],a=n["opacity"],o=n["isInteractive"];i!==r.isVisible&&(s.style.display=i?"":"none",r.isVisible=i),a!==r.opacity&&(s.style.opacity=1===a?"":String(a),r.opacity=a),o!==r.isInteractive&&(s.style.pointerEvents=o?"":"none",o?s.setAttribute("interactive",""):s.removeAttribute("interactive"),r.isInteractive=o)}}_OnCleanUpHTMLLayers(){for(const e of this._pendingRemoveElements)e.remove();this._pendingRemoveElements.length=0}_UpdateHTMLElementsZOrder(){this._pendingUpdateHTMLZOrder||(this._pendingUpdateHTMLZOrder=!0,this._AddRAFCallback(this._updateHTMLZOrderRAFCallback))}_DoUpdateHTMLElementsZOrder(){this._RemoveRAFCallback(this._updateHTMLZOrderRAFCallback),this._pendingUpdateHTMLZOrder=!1;let e=[];for(const t of this._domHandlers)if(t instanceof window.DOMElementHandler){const s=t._GetAllElementStatesForZOrderUpdate();s&&e.push(...s)}e.sort((e,t)=>{const s=e.GetActualHTMLIndex(),r=t.GetActualHTMLIndex();if(s!==r)return s-r;return e.GetHTMLZIndex()-t.GetHTMLZIndex()});let t=0,s=0,r=0,n=e.length;for(;r<n;++r){const n=e[r];n.GetActualHTMLIndex()!==t&&(this._DoUpdateHTMLElementsZOrderOnHTMLLayer(t,e.slice(s,r)),t=n.GetActualHTMLIndex(),s=r)}s<r&&this._DoUpdateHTMLElementsZOrderOnHTMLLayer(t,e.slice(s,r))}_DoUpdateHTMLElementsZOrderOnHTMLLayer(e,t){if(t.length<=1)return;if(e>=this._canvasLayers.length)return;const s=t.map(e=>e.GetElement()),r=new Set(s),n=this.GetHTMLWrapElement(e),i=Array.from(n.children).filter(e=>r.has(e));for(let e=0,t=0,r=s.length;e<r;++e){const r=s[e],a=i[t];r===a?++t:n["moveBefore"]?n["moveBefore"](r,a):n.insertBefore(r,a)}}_GetLocalRuntime(){if(this._useWorker)throw new Error("not available in worker mode");return this._localRuntime}PostToRuntimeComponent(e,t,s,r,n){this._messageChannelPort.postMessage({"type":"event","component":e,"handler":t,"dispatchOpts":r||null,"data":s,"responseId":null},n)}PostToRuntimeComponentAsync(e,t,s,r,n){const i=w++,a=new Promise((e,t)=>{_.set(i,{resolve:e,reject:t})});return this._messageChannelPort.postMessage({"type":"event","component":e,"handler":t,"dispatchOpts":r||null,"data":s,"responseId":i},n),a}"_OnMessageFromRuntime"(e){const t=e["type"];if("event"===t)return this._OnEventFromRuntime(e);if("result"===t)this._OnResultFromRuntime(e);else if("runtime-ready"===t)this._OnRuntimeReady();else if("alert-error"===t)this._RemoveLoadingMessage(),alert(e["message"]);else{if("creating-runtime"!==t)throw new Error(`unknown message '${t}'`);this._OnBeforeCreateRuntime()}}_OnEventFromRuntime(e){const t=e["component"],s=e["handler"],r=e["data"],n=e["responseId"],i=u.get(t);if(!i)return void console.warn(`[DOM] No event handlers for component '${t}'`);const a=i.get(s);if(!a)return void console.warn(`[DOM] No handler '${s}' for component '${t}'`);let o=null;try{o=a(r)}catch(e){return console.error(`Exception in '${t}' handler '${s}':`,e),void(null!==n&&this._PostResultToRuntime(n,!1,""+e))}if(null===n)return o;o&&o.then?o.then(e=>this._PostResultToRuntime(n,!0,e)).catch(e=>{console.error(`Rejection from '${t}' handler '${s}':`,e),this._PostResultToRuntime(n,!1,""+e)}):this._PostResultToRuntime(n,!0,o)}_PostResultToRuntime(e,t,s){let r;s&&s["transferables"]&&(r=s["transferables"]),this._messageChannelPort.postMessage({"type":"result","responseId":e,"isOk":t,"result":s},r)}_OnResultFromRuntime(e){const t=e["responseId"],s=e["isOk"],r=e["result"],n=_.get(t);s?n.resolve(r):n.reject(r),_.delete(t)}AddRuntimeComponentMessageHandler(e,t,s){let r=u.get(e);if(r||(r=new Map,u.set(e,r)),r.has(t))throw new Error(`[DOM] Component '${e}' already has handler '${t}'`);r.set(t,s)}static AddDOMHandlerClass(e){if(m.includes(e))throw new Error("DOM handler already added");m.push(e)}_FindRuntimeDOMHandler(){for(const e of this._domHandlers)if("runtime"===e.GetComponentID())return void(this._runtimeDomHandler=e);throw new Error("cannot find runtime DOM handler")}_OnMessageFromDebugger(e){this.PostToRuntimeComponent("debugger","message",e)}_OnRuntimeReady(){for(const e of this._domHandlers)e.Attach()}static IsDocumentFullscreen(){return!!(document["fullscreenElement"]||document["webkitFullscreenElement"]||document["mozFullScreenElement"]||v)}static _SetWrapperIsFullscreenFlag(e){v=!!e}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(e){this._rafCallbacks.add(e),this._RequestAnimationFrame()}_RemoveRAFCallback(e){this._rafCallbacks.delete(e),0===this._rafCallbacks.size&&this._CancelAnimationFrame()}_RequestAnimationFrame(){-1===this._rafId&&this._rafCallbacks.size>0&&(this._rafId=requestAnimationFrame(this._rafFunc))}_CancelAnimationFrame(){-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1)}_OnRAFCallback(){this._rafId=-1;for(const e of this._rafCallbacks)e();this._RequestAnimationFrame()}TryPlayMedia(e){this._runtimeDomHandler.TryPlayMedia(e)}RemovePendingPlay(e){this._runtimeDomHandler.RemovePendingPlay(e)}_PlayPendingMedia(){this._runtimeDomHandler._PlayPendingMedia()}SetSilent(e){this._runtimeDomHandler.SetSilent(e)}IsAudioFormatSupported(e){return!!o[e]}SetIsExportingToVideo(e){this._isExportingToVideo=!0,this._exportToVideoDuration=e}IsExportingToVideo(){return this._isExportingToVideo}GetExportToVideoDuration(){return this._exportToVideoDuration}IsAbsoluteURL(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)}IsRelativeURL(e){return!this.IsAbsoluteURL(e)}async _MaybeGetPlatformSpecificScriptURL(e){if("cordova"===this._exportType&&(e.startsWith("file:")||this._isFileProtocol&&this.IsRelativeURL(e))){let t=e;t.startsWith(this._runtimeBaseUrl)&&(t=t.substr(this._runtimeBaseUrl.length));const s=await this.CordovaFetchLocalFileAsArrayBuffer(t),r=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(r)}if("playable-ad-single-file"===this._exportType){if(this._localFileStrings.hasOwnProperty(e))return{isStringSrc:!0,str:this._localFileStrings[e]};if(this._localFileBlobs.hasOwnProperty(e))return URL.createObjectURL(this._localFileBlobs[e]);throw new Error("missing script: "+e)}return e}async _OnCordovaFetchLocalFile(e){const t=e["filename"];switch(e["as"]){case"text":return await this.CordovaFetchLocalFileAsText(t);case"buffer":return await this.CordovaFetchLocalFileAsArrayBuffer(t);default:throw new Error("unsupported type")}}CordovaFetchLocalFile(e){const t=window["cordova"]["file"]["applicationDirectory"]+"www/"+e;return new Promise((e,s)=>{window["resolveLocalFileSystemURL"](t,t=>{t["file"](e,s)},s)})}async CordovaFetchLocalFileAsText(e){const t=await this.CordovaFetchLocalFile(e);return await l(t)}_CordovaMaybeStartNextArrayBufferRead(){if(!d.length)return;if(h>=p)return;h++;const e=d.shift();this._CordovaDoFetchLocalFileAsAsArrayBuffer(e.filename,e.successCallback,e.errorCallback)}CordovaFetchLocalFileAsArrayBuffer(e){return new Promise((t,s)=>{d.push({filename:e,successCallback:e=>{h--,this._CordovaMaybeStartNextArrayBufferRead(),t(e)},errorCallback:e=>{h--,this._CordovaMaybeStartNextArrayBufferRead(),s(e)}}),this._CordovaMaybeStartNextArrayBufferRead()})}async _CordovaDoFetchLocalFileAsAsArrayBuffer(e,t,s){try{const s=await this.CordovaFetchLocalFile(e);t(await c(s))}catch(e){s(e)}}"_PlayableAdFetchBlob"(e){if(this._localFileBlobs.hasOwnProperty(e))return this._localFileBlobs[e];throw new Error("missing file: "+e)}_GetPermissionAPI(){const e=window["cordova"]&&window["cordova"]["plugins"]&&window["cordova"]["plugins"]["permissions"];if("object"!=typeof e)throw new Error("Permission API is not loaded");return e}_MapPermissionID(e,t){const s=e[t];if("string"!=typeof s)throw new Error("Invalid permission name");return s}_HasPermission(e){const t=this._GetPermissionAPI();return new Promise((s,r)=>t["checkPermission"](this._MapPermissionID(t,e),e=>s(!!e["hasPermission"]),r))}_RequestPermission(e){const t=this._GetPermissionAPI();return new Promise((s,r)=>t["requestPermission"](this._MapPermissionID(t,e),e=>s(!!e["hasPermission"]),r))}async RequestPermissions(e){if("cordova"!==this.GetExportType())return!0;if(this.IsiOSCordova())return!0;for(const t of e){if(await this._HasPermission(t))continue;if(!1===await this._RequestPermission(t))return!1}return!0}async RequirePermissions(...e){if(!1===await this.RequestPermissions(e))throw new Error("Permission not granted")}_OnWrapperMessage(e,t){if("object"!=typeof e||!e)return void console.warn("Unknown wrapper message: ",e);const s=e["type"];if("directory-handles"===s)this._directoryHandles=t;else if("wrapper-init-response"===s)this._wrapperInitResolve(e),this._wrapperInitResolve=null;else if("fullscreen-change"===s)r._SetWrapperIsFullscreenFlag(e["isFullscreen"]),this._runtimeDomHandler._OnFullscreenChange();else if("log-to-console"===s)switch(e["logType"]){case"error":console.error(e["message"]);break;case"warning":console.warn(e["message"]);break;default:console.log(e["message"])}else"extension-message"===s?this.PostToRuntimeComponent("runtime","wrapper-extension-message",e):console.warn("Unknown wrapper message: ",e)}_OnSendWrapperExtensionMessage(e){this._SendWrapperMessage({"type":"extension-message","componentId":e["componentId"],"messageId":e["messageId"],"params":e["params"]||[],"asyncId":e["asyncId"]})}_SendWrapperMessage(e){this.IsAnyWebView2Wrapper()?window["chrome"]["webview"]["postMessage"](JSON.stringify(e)):"macos-wkwebview"===this._exportType?window["webkit"]["messageHandlers"]["C3Wrapper"]["postMessage"](JSON.stringify(e)):"linux-cef"===this._exportType&&window["c3_linux_cef_sendmessage"](JSON.stringify(e))}_SetupDesktopWrapperPolyfills(){window.moveTo=(e,t)=>{this._SendWrapperMessage({"type":"set-window-position","windowX":Math.ceil(e),"windowY":Math.ceil(t)})},window.resizeTo=(e,t)=>{this._SendWrapperMessage({"type":"set-window-size","windowWidth":Math.ceil(e),"windowHeight":Math.ceil(t)})}}_InitWrapper(){return new Promise(e=>{this._wrapperInitResolve=e,this._SendWrapperMessage({"type":"wrapper-init"})})}_GetDirectoryHandles(){return this._directoryHandles}async _ConvertDataUrisToBlobs(){const e=[];for(const[t,s]of Object.entries(this._localFileBlobs))e.push(this._ConvertDataUriToBlobs(t,s));await Promise.all(e)}async _ConvertDataUriToBlobs(e,t){if("object"==typeof t)this._localFileBlobs[e]=new Blob([t["str"]],{"type":t["type"]}),this._localFileStrings[e]=t["str"];else{let s=await this._FetchDataUri(t);s||(s=this._DataURIToBinaryBlobSync(t)),this._localFileBlobs[e]=s}}async _FetchDataUri(e){try{const t=await fetch(e);return await t.blob()}catch(e){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",e),null}}_DataURIToBinaryBlobSync(e){const t=this._ParseDataURI(e);return this._BinaryStringToBlob(t.data,t.mime_type)}_ParseDataURI(e){const t=e.indexOf(",");if(t<0)throw new URIError("expected comma in data: uri");const s=e.substring(5,t),r=e.substring(t+1),n=s.split(";"),i=n[0]||"",a=n[1],o=n[2];let l;return l="base64"===a||"base64"===o?atob(r):decodeURIComponent(r),{mime_type:i,data:l}}_BinaryStringToBlob(e,t){let s,r,n=e.length,i=n>>2,a=new Uint8Array(n),o=new Uint32Array(a.buffer,0,i);for(s=0,r=0;s<i;++s)o[s]=e.charCodeAt(r++)|e.charCodeAt(r++)<<8|e.charCodeAt(r++)<<16|e.charCodeAt(r++)<<24;let l=3&n;for(;l--;)a[r]=e.charCodeAt(r),++r;return new Blob([a],{"type":t})}}}

// workers/runtimeDomEvents.js
"use strict";{const e=self.RuntimeInterface;function t(e){return e["sourceCapabilities"]&&e["sourceCapabilities"]["firesTouchEvents"]||e["originalEvent"]&&e["originalEvent"]["sourceCapabilities"]&&e["originalEvent"]["sourceCapabilities"]["firesTouchEvents"]}const i=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),n={"dispatchRuntimeEvent":!0,"dispatchUserScriptEvent":!0},s={"dispatchUserScriptEvent":!0},o={"dispatchRuntimeEvent":!0};async function a(e){const t=URL.createObjectURL(e);try{return await(i=t,new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=e=>t(e),n.src=i}))}finally{URL.revokeObjectURL(t)}var i}function r(e){do{if(e.parentNode&&e.hasAttribute("contenteditable"))return!0;e=e.parentNode}while(e);return!1}const d=new Set(["input","textarea","datalist","select"]);const l=new Set(["canvas","body","html"]);function c(e){if(!e.target.tagName)return;const t=e.target.tagName.toLowerCase();l.has(t)&&e.preventDefault()}function h(e){e.target.tagName&&e.target.classList.contains("c3htmlwrap")&&e.preventDefault()}function u(e){(e.metaKey||e.ctrlKey)&&e.preventDefault()}self["C3_GetSvgImageSize"]=async function(e){const t=await a(e);if(t.width>0&&t.height>0)return[t.width,t.height];{t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.visibility="hidden",document.body.appendChild(t);const e=t.getBoundingClientRect();return document.body.removeChild(t),[e.width,e.height]}},self["C3_RasterSvgImageBlob"]=async function(e,t,i,n,s){const o=await a(e),r=document.createElement("canvas");r.width=n,r.height=s;return r.getContext("2d").drawImage(o,0,0,t,i),r};let m=!1;function g(){try{return window.parent&&window.parent.document.hasFocus()}catch(e){return!1}}document.addEventListener("pause",()=>m=!0),document.addEventListener("resume",()=>m=!1);const p="runtime",_=class extends self.DOMHandler{constructor(e){super(e,p),this._enableWindowResizeEvent=!1,this._simulatedResizeTimerId=-1,this._targetOrientation="any",this._attachedDeviceOrientationEvent=!1,this._attachedDeviceMotionEvent=!1,this._pageVisibilityIsHidden=!1,this._screenReaderTextWrap=document.createElement("div"),this._screenReaderTextWrap.className="c3-screen-reader-text",this._screenReaderTextWrap.setAttribute("aria-live","polite"),document.body.appendChild(this._screenReaderTextWrap),this._debugHighlightElem=null,this._isExportToVideo=!1,this._exportVideoProgressMessage="",this._exportVideoUpdateTimerId=-1,this._enableAndroidVKDetection=!1,this._lastWindowWidth=e._GetWindowInnerWidth(),this._lastWindowHeight=e._GetWindowInnerHeight(),this._virtualKeyboardHeight=0,this._vkTranslateYOffset=0,e.AddRuntimeComponentMessageHandler("runtime","invoke-download",e=>this._OnInvokeDownload(e)),e.AddRuntimeComponentMessageHandler("runtime","load-webfonts",e=>this._OnLoadWebFonts(e)),e.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",e=>this._OnRasterSvgImage(e)),e.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",e=>this._OnGetSvgImageSize(e)),e.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",e=>this._OnSetTargetOrientation(e)),e.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW()),e.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",e=>this._OnPostToDebugger(e)),e.AddRuntimeComponentMessageHandler("runtime","go-to-script",e=>this._OnPostToDebugger(e)),e.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking()),e.AddRuntimeComponentMessageHandler("runtime","debug-highlight",e=>this._OnDebugHighlight(e)),e.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent()),e.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent()),e.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",e=>this._OnAddStylesheet(e)),e.AddRuntimeComponentMessageHandler("runtime","script-create-worker",e=>this._OnScriptCreateWorker(e)),e.AddRuntimeComponentMessageHandler("runtime","alert",e=>this._OnAlert(e)),e.AddRuntimeComponentMessageHandler("runtime","screen-reader-text",e=>this._OnScreenReaderTextEvent(e)),e.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash()),e.AddRuntimeComponentMessageHandler("runtime","set-exporting-to-video",e=>this._SetExportingToVideo(e)),e.AddRuntimeComponentMessageHandler("runtime","export-to-video-progress",e=>this._OnExportVideoProgress(e)),e.AddRuntimeComponentMessageHandler("runtime","exported-to-video",e=>this._OnExportedToVideo(e)),e.AddRuntimeComponentMessageHandler("runtime","exported-to-image-sequence",e=>this._OnExportedToImageSequence(e));const t=new Set(["input","textarea","datalist"]);if(window.addEventListener("contextmenu",e=>{const i=e.target,n=i.tagName.toLowerCase();t.has(n)||r(i)||e.preventDefault()}),window.addEventListener("selectstart",c),window.addEventListener("gesturehold",c),window.addEventListener("touchstart",c,{"passive":!1}),window.addEventListener("pointerdown",c,{"passive":!1}),this._mousePointerLastButtons=0,window.addEventListener("mousedown",e=>{1===e.button&&e.preventDefault()}),window.addEventListener("mousewheel",u,{"passive":!1}),window.addEventListener("wheel",u,{"passive":!1}),window.addEventListener("resize",()=>this._OnWindowResize()),window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("fullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("webkitfullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("mozfullscreenerror",e=>this._OnFullscreenError(e)),e.IsiOSWebView()){let e=1/0;window["visualViewport"].addEventListener("resize",()=>{const t=window["visualViewport"].height;t>e&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0),e=t}),document.documentElement.setAttribute("ioswebview","")}this._mediaPendingPlay=new Set,this._mediaRemovedPendingPlay=new WeakSet,this._isSilent=!1}_AddDefaultCanvasEventHandlers(e){e.addEventListener("selectstart",c),e.addEventListener("gesturehold",c),e.addEventListener("pointerdown",c)}_AddDefaultHTMLWrapEventHandlers(e){e.addEventListener("selectstart",h),e.addEventListener("gesturehold",h),e.addEventListener("touchstart",h)}_OnBeforeStartTicking(){return self.setTimeout(()=>{this._enableAndroidVKDetection=!0},1e3),"cordova"===this._iRuntime.GetExportType()?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange("hidden"===document.visibilityState)),this._pageVisibilityIsHidden=!("hidden"!==document.visibilityState&&!m),{"isSuspended":this._pageVisibilityIsHidden}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus")),window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{"parentHasFocus":g()}),this._mousePointerLastButtons=0}),window.addEventListener("focusin",e=>{var t;t=e.target,(d.has(t.tagName.toLowerCase())||r(t))&&this._PostRuntimeEvent("keyboard-blur")}),window.addEventListener("keydown",e=>this._OnKeyEvent("keydown",e)),window.addEventListener("keyup",e=>this._OnKeyEvent("keyup",e)),window.addEventListener("mousedown",e=>this._OnMouseEvent("mousedown",e,s)),window.addEventListener("mousemove",e=>this._OnMouseEvent("mousemove",e,s)),window.addEventListener("mouseup",e=>this._OnMouseEvent("mouseup",e,s)),window.addEventListener("dblclick",e=>this._OnMouseEvent("dblclick",e,n)),window.addEventListener("wheel",e=>this._OnMouseWheelEvent("wheel",e,n)),window.addEventListener("pointerdown",e=>{this._HandlePointerDownFocus(e),this._OnPointerEvent("pointerdown",e)}),this._iRuntime.UsesWorker()&&void 0!==window["onpointerrawupdate"]&&self===self.top?window.addEventListener("pointerrawupdate",e=>this._OnPointerRawUpdate(e)):window.addEventListener("pointermove",e=>this._OnPointerEvent("pointermove",e)),window.addEventListener("pointerup",e=>this._OnPointerEvent("pointerup",e)),window.addEventListener("pointercancel",e=>this._OnPointerEvent("pointercancel",e));const e=()=>this._PlayPendingMedia();window.addEventListener("pointerup",e,!0),window.addEventListener("touchend",e,!0),window.addEventListener("click",e,!0),window.addEventListener("keydown",e,!0),window.addEventListener("gamepadconnected",e,!0),this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator["virtualKeyboard"]&&(navigator["virtualKeyboard"]["overlaysContent"]=!0,navigator["virtualKeyboard"].addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator["virtualKeyboard"]["boundingRect"]["height"])})),this._iRuntime.IsiOSWebView()&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0)}_OnAndroidVirtualKeyboardChange(e,t){if(document.body.style.position="",document.body.style.overflow="",document.body.style.transform="",this._vkTranslateYOffset=0,t>0){const i=document.activeElement;if(i){const n=i.getBoundingClientRect();let s=(n.top+n.bottom)/2-(e-t)/2;s>t&&(s=t),s<0&&(s=0),s>0&&(document.body.style.position="absolute",document.body.style.overflow="visible",document.body.style.transform=`translateY(${-s}px)`,this._vkTranslateYOffset=s)}}}_PostRuntimeEvent(e,t){this.PostToRuntime(e,t||null,o)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_EnableWindowResizeEvent(){this._enableWindowResizeEvent=!0,this._lastWindowWidth=this._iRuntime._GetWindowInnerWidth(),this._lastWindowHeight=this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){if(this._isExportToVideo)return;if(!this._enableWindowResizeEvent)return;const t=this._GetWindowInnerWidth(),i=this._GetWindowInnerHeight();if(this._iRuntime.IsAndroidWebView())if(this._enableAndroidVKDetection){if(this._iRuntime.CanDoAndroidVirtualKeyboardDetection()&&this._lastWindowWidth===t&&i<this._lastWindowHeight)return this._virtualKeyboardHeight=this._lastWindowHeight-i,void this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);this._virtualKeyboardHeight>0&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(i,this._virtualKeyboardHeight)),this._lastWindowWidth=t,this._lastWindowHeight=i}else this._lastWindowWidth=t,this._lastWindowHeight=i;this.PostToRuntime("window-resize",{"innerWidth":t,"innerHeight":i,"devicePixelRatio":window.devicePixelRatio,"isFullscreen":e.IsDocumentFullscreen(),"cssDisplayMode":this._iRuntime.GetCssDisplayMode()}),this._iRuntime.IsiOSWebView()&&(-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(t,i,0))}_ScheduleSimulatedResize(e,t,i){-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(e,t,i),48)}_OnSimulatedResize(t,i,n){const s=this._GetWindowInnerWidth(),o=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1,s!=t||o!=i?this.PostToRuntime("window-resize",{"innerWidth":s,"innerHeight":o,"devicePixelRatio":window.devicePixelRatio,"isFullscreen":e.IsDocumentFullscreen(),"cssDisplayMode":this._iRuntime.GetCssDisplayMode()}):n<10&&this._ScheduleSimulatedResize(s,o,n+1)}_OnSetTargetOrientation(e){this._targetOrientation=e["targetOrientation"]}_TrySetTargetOrientation(){const e=this._targetOrientation;if(screen["orientation"]&&screen["orientation"]["lock"])screen["orientation"]["lock"](e).catch(e=>console.warn("[Construct] Failed to lock orientation: ",e));else try{let t=!1;screen["lockOrientation"]?t=screen["lockOrientation"](e):screen["webkitLockOrientation"]?t=screen["webkitLockOrientation"](e):screen["mozLockOrientation"]?t=screen["mozLockOrientation"](e):screen["msLockOrientation"]&&(t=screen["msLockOrientation"](e)),t||console.warn("[Construct] Failed to lock orientation")}catch(e){console.warn("[Construct] Failed to lock orientation: ",e)}}_OnFullscreenChange(){if(this._isExportToVideo)return;const t=e.IsDocumentFullscreen();t&&"any"!==this._targetOrientation&&this._TrySetTargetOrientation(),this.PostToRuntime("fullscreenchange",{"isFullscreen":t,"innerWidth":this._GetWindowInnerWidth(),"innerHeight":this._GetWindowInnerHeight()})}_OnFullscreenError(t){console.warn("[Construct] Fullscreen request failed: ",t),this.PostToRuntime("fullscreenerror",{"isFullscreen":e.IsDocumentFullscreen(),"innerWidth":this._GetWindowInnerWidth(),"innerHeight":this._GetWindowInnerHeight()})}_OnVisibilityChange(e){if(this._pageVisibilityIsHidden!==e&&(this._pageVisibilityIsHidden=e,e?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame(),this.PostToRuntime("visibilitychange",{"hidden":e}),!e&&this._iRuntime.IsiOSWebView())){const e=()=>{document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0};setTimeout(e,50),setTimeout(e,100),setTimeout(e,250),setTimeout(e,500)}}_OnKeyEvent(e,t){if(void 0===t.key)return;if("Backspace"===t.key&&c(t),"nwjs"===this._iRuntime.GetExportType()&&"u"===t.key&&(t.ctrlKey||t.metaKey)&&t.preventDefault(),this._isExportToVideo)return;const s=i.get(t.code)||t.code;this._PostToRuntimeMaybeSync(e,{"code":s,"key":t.key,"which":t.which,"repeat":t.repeat,"altKey":t.altKey,"ctrlKey":t.ctrlKey,"metaKey":t.metaKey,"shiftKey":t.shiftKey,"timeStamp":t.timeStamp},n)}_OnMouseWheelEvent(e,t,i){this._isExportToVideo||this.PostToRuntime(e,{"clientX":t.clientX,"clientY":t.clientY+this._vkTranslateYOffset,"pageX":t.pageX,"pageY":t.pageY+this._vkTranslateYOffset,"deltaX":t.deltaX,"deltaY":t.deltaY,"deltaZ":t.deltaZ,"deltaMode":t.deltaMode,"timeStamp":t.timeStamp},i)}_OnMouseEvent(e,i,n){this._isExportToVideo||t(i)||this._PostToRuntimeMaybeSync(e,{"button":i.button,"buttons":i.buttons,"clientX":i.clientX,"clientY":i.clientY+this._vkTranslateYOffset,"pageX":i.pageX,"pageY":i.pageY+this._vkTranslateYOffset,"movementX":i.movementX||0,"movementY":i.movementY||0,"timeStamp":i.timeStamp},n)}_OnPointerEvent(e,t){if(this._isExportToVideo)return;let i=0;"mouse"===t.pointerType&&(i=this._mousePointerLastButtons),this._PostToRuntimeMaybeSync(e,{"pointerId":t.pointerId,"pointerType":t.pointerType,"button":t.button,"buttons":t.buttons,"lastButtons":i,"clientX":t.clientX,"clientY":t.clientY+this._vkTranslateYOffset,"pageX":t.pageX,"pageY":t.pageY+this._vkTranslateYOffset,"movementX":t.movementX||0,"movementY":t.movementY||0,"width":t.width||0,"height":t.height||0,"pressure":t.pressure||0,"tangentialPressure":t["tangentialPressure"]||0,"tiltX":t.tiltX||0,"tiltY":t.tiltY||0,"twist":t["twist"]||0,"timeStamp":t.timeStamp},n),"mouse"===t.pointerType&&(this._mousePointerLastButtons=t.buttons)}_OnPointerRawUpdate(e){this._OnPointerEvent("pointermove",e)}_OnTouchEvent(e,t){if(!this._isExportToVideo)for(let i=0,s=t.changedTouches.length;i<s;++i){const s=t.changedTouches[i];this._PostToRuntimeMaybeSync(e,{"pointerId":s.identifier,"pointerType":"touch","button":0,"buttons":0,"lastButtons":0,"clientX":s.clientX,"clientY":s.clientY+this._vkTranslateYOffset,"pageX":s.pageX,"pageY":s.pageY+this._vkTranslateYOffset,"movementX":t.movementX||0,"movementY":t.movementY||0,"width":2*(s["radiusX"]||s["webkitRadiusX"]||0),"height":2*(s["radiusY"]||s["webkitRadiusY"]||0),"pressure":s["force"]||s["webkitForce"]||0,"tangentialPressure":0,"tiltX":0,"tiltY":0,"twist":s["rotationAngle"]||0,"timeStamp":t.timeStamp},n)}}_HandlePointerDownFocus(e){window!==window.top&&window.focus(),this._IsElementCanvasOrDocument(e.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(e){return!e||e===document||e===window||e===document.body||"canvas"===e.tagName.toLowerCase()}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",e=>this._OnDeviceOrientation(e)),window.addEventListener("deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",e=>this._OnDeviceMotion(e)))}_OnDeviceOrientation(e){this._isExportToVideo||this.PostToRuntime("deviceorientation",{"absolute":!!e["absolute"],"alpha":e["alpha"]||0,"beta":e["beta"]||0,"gamma":e["gamma"]||0,"timeStamp":e.timeStamp,"webkitCompassHeading":e["webkitCompassHeading"],"webkitCompassAccuracy":e["webkitCompassAccuracy"]},n)}_OnDeviceOrientationAbsolute(e){this._isExportToVideo||this.PostToRuntime("deviceorientationabsolute",{"absolute":!!e["absolute"],"alpha":e["alpha"]||0,"beta":e["beta"]||0,"gamma":e["gamma"]||0,"timeStamp":e.timeStamp},n)}_OnDeviceMotion(e){if(this._isExportToVideo)return;let t=null;const i=e["acceleration"];i&&(t={"x":i["x"]||0,"y":i["y"]||0,"z":i["z"]||0});let s=null;const o=e["accelerationIncludingGravity"];o&&(s={"x":o["x"]||0,"y":o["y"]||0,"z":o["z"]||0});let a=null;const r=e["rotationRate"];r&&(a={"alpha":r["alpha"]||0,"beta":r["beta"]||0,"gamma":r["gamma"]||0}),this.PostToRuntime("devicemotion",{"acceleration":t,"accelerationIncludingGravity":s,"rotationRate":a,"interval":e["interval"],"timeStamp":e.timeStamp},n)}_OnInvokeDownload(e){const t=e["url"],i=e["filename"],n=document.createElement("a"),s=document.body;n.textContent=i,n.href=t,n.download=i,s.appendChild(n),n.click(),s.removeChild(n)}async _OnLoadWebFonts(e){const t=e["webfonts"];await Promise.all(t.map(async e=>{const t=new FontFace(e.name,`url('${e.url}')`);document.fonts.add(t),await t.load()}))}async _OnRasterSvgImage(e){const t=e["blob"],i=e["imageWidth"],n=e["imageHeight"],s=e["surfaceWidth"],o=e["surfaceHeight"],a=e["imageBitmapOpts"],r=await self["C3_RasterSvgImageBlob"](t,i,n,s,o);let d;return d=a?await createImageBitmap(r,a):await createImageBitmap(r),{"imageBitmap":d,"transferables":[d]}}async _OnGetSvgImageSize(e){return await self["C3_GetSvgImageSize"](e["blob"])}async _OnAddStylesheet(e){var t;await(t=e["url"],new Promise((e,i)=>{const n=document.createElement("link");n.onload=()=>e(n),n.onerror=e=>i(e),n.rel="stylesheet",n.href=t,document.head.appendChild(n)}))}_PlayPendingMedia(){const e=[...this._mediaPendingPlay];if(this._mediaPendingPlay.clear(),!this._isSilent)for(const t of e){const e=t.play();e&&e.catch(e=>{this._mediaRemovedPendingPlay.has(t)||this._mediaPendingPlay.add(t)})}}TryPlayMedia(e){if("function"!=typeof e.play)throw new Error("missing play function");let t;this._mediaRemovedPendingPlay.delete(e);try{t=e.play()}catch(t){return void this._mediaPendingPlay.add(e)}t&&t.catch(t=>{this._mediaRemovedPendingPlay.has(e)||this._mediaPendingPlay.add(e)})}RemovePendingPlay(e){this._mediaPendingPlay.delete(e),this._mediaRemovedPendingPlay.add(e)}SetSilent(e){this._isSilent=!!e}_OnHideCordovaSplash(){navigator["splashscreen"]&&navigator["splashscreen"]["hide"]&&navigator["splashscreen"]["hide"]()}_OnDebugHighlight(e){if(!e["show"])return void(this._debugHighlightElem&&(this._debugHighlightElem.style.display="none"));this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));const t=this._debugHighlightElem;t.style.display="",t.style.left=e["left"]-1+"px",t.style.top=e["top"]-1+"px",t.style.width=e["width"]+2+"px",t.style.height=e["height"]+2+"px",t.textContent=e["name"]}_OnRegisterSW(){window["C3_RegisterSW"]&&window["C3_RegisterSW"]()}_OnPostToDebugger(e){window["c3_postToMessagePort"]&&(e["from"]="runtime",window["c3_postToMessagePort"](e))}_InvokeFunctionFromJS(e,t){return this.PostToRuntimeAsync("js-invoke-function",{"name":e,"params":t})}_OnScriptCreateWorker(e){const t=e["url"],i=e["opts"],n=e["port2"];new Worker(t,i).postMessage({"type":"construct-worker-init","port2":n},[n])}_OnAlert(e){alert(e["message"])}_OnScreenReaderTextEvent(e){const t=e["type"];if("create"===t){const t=document.createElement("p");t.id="c3-sr-"+e["id"],t.textContent=e["text"],this._screenReaderTextWrap.appendChild(t)}else if("update"===t){const t=document.getElementById("c3-sr-"+e["id"]);t?t.textContent=e["text"]:console.warn(`[Construct] Missing screen reader text with id ${e["id"]}`)}else if("release"===t){const t=document.getElementById("c3-sr-"+e["id"]);t?t.remove():console.warn(`[Construct] Missing screen reader text with id ${e["id"]}`)}else console.warn(`[Construct] Unknown screen reader text update '${t}'`)}_SetExportingToVideo(e){this._isExportToVideo=!0;const t=document.createElement("h1");t.id="exportToVideoMessage",t.textContent=e["message"],document.body.prepend(t),document.body.classList.add("exportingToVideo"),this.GetRuntimeInterface().GetMainCanvas().style.display="",this._iRuntime.SetIsExportingToVideo(e["duration"])}_OnExportVideoProgress(e){this._exportVideoProgressMessage=e["message"],-1===this._exportVideoUpdateTimerId&&(this._exportVideoUpdateTimerId=setTimeout(()=>this._DoUpdateExportVideoProgressMessage(),250))}_DoUpdateExportVideoProgressMessage(){this._exportVideoUpdateTimerId=-1;const e=document.getElementById("exportToVideoMessage");e&&(e.textContent=this._exportVideoProgressMessage)}_OnExportedToVideo(e){window.c3_postToMessagePort({"type":"exported-video","arrayBuffer":e["arrayBuffer"],"contentType":e["contentType"],"time":e["time"]})}_OnExportedToImageSequence(e){window.c3_postToMessagePort({"type":"exported-image-sequence","blobArr":e["blobArr"],"time":e["time"],"gif":e["gif"]})}};e.AddDOMHandlerClass(_)}

// workers/jobSchedulerDom.js
"use strict";{const t="dispatchworker.js",r="jobworker.js";self.JobSchedulerDOM=class{constructor(t){this._runtimeInterface=t,this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16),this._dispatchWorker=null,this._jobWorkers=[],this._inputPort=null,this._outputPort=null}async Init(){if(this._hasInitialised)throw new Error("already initialised");this._hasInitialised=!0;const r=this._runtimeInterface.GetScriptFolder()+t;this._dispatchWorker=await this._runtimeInterface.CreateWorker(r,{name:"DispatchWorker"});const e=new MessageChannel;this._inputPort=e.port1,this._dispatchWorker.postMessage({"type":"_init","in-port":e.port2},[e.port2]),this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const t=this._jobWorkers.length,e=this._runtimeInterface.GetScriptFolder()+r,o=await this._runtimeInterface.CreateWorker(e,{name:"JobWorker"+t}),s=new MessageChannel,i=new MessageChannel;return this._dispatchWorker.postMessage({"type":"_addJobWorker","port":s.port1},[s.port1]),o.postMessage({"type":"init","number":t,"dispatch-port":s.port2,"output-port":i.port2},[s.port2,i.port2]),this._jobWorkers.push(o),i.port1}GetPortData(){return{"inputPort":this._inputPort,"outputPort":this._outputPort,"maxNumWorkers":this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}}}

// scripts/plugins/List/dom/domSide.js
"use strict";{const e="list";function t(e){e.stopPropagation()}const n=class extends self.DOMElementHandler{constructor(t){super(t,e),this.AddDOMElementMessageHandler("set-selected-index",(e,t)=>this._OnSetSelectedIndex(e,t["selectedIndex"])),this.AddDOMElementMessageHandler("add-item",(e,t)=>this._OnAddItem(e,t)),this.AddDOMElementMessageHandler("remove-item",(e,t)=>this._OnRemoveItem(e,t)),this.AddDOMElementMessageHandler("set-item",(e,t)=>this._OnSetItem(e,t)),this.AddDOMElementMessageHandler("clear",e=>this._OnClear(e)),this.AddDOMElementMessageHandler("load-state",(e,t)=>this._OnLoadState(e,t))}CreateElement(e,n){const s=n["isDropdown"],d=n["isMultiSelect"],i=n["items"],l=document.createElement("select");l.style.position="absolute",l.style.userSelect="none",l.style.webkitUserSelect="none",l.multiple=d,s||(l.size=2);for(const e of i)l.add(this._CreateOption(e));return l.addEventListener("pointerdown",t),l.addEventListener("pointerrawupdate",t),l.addEventListener("pointerup",t),l.addEventListener("mousedown",t),l.addEventListener("mouseup",t),l.addEventListener("click",t=>{t.stopPropagation(),this._PostToRuntimeElementMaybeSync("click",e,this._GetSelectionState(l))}),l.addEventListener("dblclick",t=>{t.stopPropagation(),this._PostToRuntimeElementMaybeSync("dblclick",e,this._GetSelectionState(l))}),l.addEventListener("change",()=>this.PostToRuntimeElement("change",e,this._GetSelectionState(l))),n["id"]&&(l.id=n["id"]),n["className"]&&(l.className=n["className"]),this.UpdateState(l,n),l}_CreateOption(e){const t=document.createElement("option");return t.text=e,t}_GetSelectionState(e){const t=e.selectedIndex,n=[];for(let t=0,s=e.length;t<s;++t)e.options[t].selected&&n.push(t);return{"selectedIndex":t,"selectedIndices":n}}UpdateState(e,t){e.title=t["title"],e.disabled=!t["isEnabled"],e.multiple=!!t["isMultiSelect"]}_OnSetSelectedIndex(e,t){e.selectedIndex=t}_OnAddItem(e,t){const n=t["text"],s=t["index"],d=this._CreateOption(n);s<0?e.add(d):e.add(d,s)}_OnRemoveItem(e,t){e.remove(t["index"])}_OnSetItem(e,t){e.options[t["index"]].text=t["text"]}_OnClear(e){e.innerHTML=""}_OnLoadState(e,t){e.innerHTML="";for(const n of t["items"])e.add(this._CreateOption(n));e.selectedIndex=t["selectedIndex"];for(const n of t["selectedIndices"]){const t=e.options[n];t&&(t.selected=!0)}}};self.RuntimeInterface.AddDOMHandlerClass(n)}

// scripts/plugins/TextBox/dom/domSide.js
"use strict";{const e="text-input";function t(e){e.stopPropagation()}function n(e){13!==e.which&&27!==e.which&&e.stopPropagation()}const s=class extends self.DOMElementHandler{constructor(t){super(t,e),this.AddDOMElementMessageHandler("scroll-to-bottom",e=>this._OnScrollToBottom(e))}CreateElement(e,s){let o;const a=s["type"];return"textarea"===a?(o=document.createElement("textarea"),o.style.resize="none"):(o=document.createElement("input"),o.type=a),o.style.position="absolute",o.autocomplete="off",o.addEventListener("pointerdown",t),o.addEventListener("pointerrawupdate",t),o.addEventListener("pointerup",t),o.addEventListener("mousedown",t),o.addEventListener("mouseup",t),o.addEventListener("keydown",n),o.addEventListener("keyup",n),o.addEventListener("click",t=>{t.stopPropagation(),this._PostToRuntimeElementMaybeSync("click",e)}),o.addEventListener("dblclick",t=>{t.stopPropagation(),this._PostToRuntimeElementMaybeSync("dblclick",e)}),o.addEventListener("input",()=>this.PostToRuntimeElement("change",e,{"text":o.value})),s["id"]&&(o.id=s["id"]),s["className"]&&(o.className=s["className"]),this.UpdateState(o,s),o}UpdateState(e,t){e.value=t["text"],e.placeholder=t["placeholder"],e.title=t["title"],e.disabled=!t["isEnabled"],e.readOnly=t["isReadOnly"],e.spellcheck=t["spellCheck"];const n=t["maxLength"];n<0?e.removeAttribute("maxlength"):e.setAttribute("maxlength",n)}_OnScrollToBottom(e){e.scrollTop=e.scrollHeight}};self.RuntimeInterface.AddDOMHandlerClass(s)}

// scripts/plugins/sliderbar/dom/domSide.js
"use strict";{const e="sliderbar";function t(e){e.stopPropagation()}const n=class extends self.DOMElementHandler{constructor(t){super(t,e)}CreateElement(e,n){const s=document.createElement("input");return s.type="range",s.style.position="absolute",s.style.userSelect="none",s.style.webkitUserSelect="none",s.addEventListener("pointerdown",t),s.addEventListener("pointerrawupdate",t),s.addEventListener("pointerup",t),s.addEventListener("mousedown",t),s.addEventListener("mouseup",t),s.addEventListener("keydown",t),s.addEventListener("keyup",t),s.addEventListener("contextmenu",e=>e.preventDefault()),s.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",e)),s.addEventListener("change",()=>this.PostToRuntimeElement("change",e,{"value":parseFloat(s.value)})),s.addEventListener("input",()=>this.PostToRuntimeElement("input",e,{"value":parseFloat(s.value)})),n["id"]&&(s.id=n["id"]),n["className"]&&(s.className=n["className"]),this.UpdateState(s,n),s}UpdateState(e,t){e.max=t["max"],e.min=t["min"],e.step=t["step"],e.value=t["value"],e.disabled=!t["isEnabled"],e.title=t["title"]}};self.RuntimeInterface.AddDOMHandlerClass(n)}

// scripts/plugins/Keyboard/dom/domSide.js
"use strict";{const r="keyboard",o=class extends self.DOMHandler{constructor(o){super(o,r),this._isKeyboardLockSupported=!(!navigator["keyboard"]||!navigator["keyboard"]["lock"]),this.AddRuntimeMessageHandlers([["init",()=>this._OnInit()],["lock-keyboard",r=>this._OnLockKeyboard(r)],["unlock-keyboard",()=>this._OnUnlockKeyboard()]])}_OnInit(){return{"isKeyboardLockSupported":this._isKeyboardLockSupported}}async _OnLockKeyboard(r){const o=r["keysArr"];try{return 0===o.length?await navigator["keyboard"]["lock"]():await navigator["keyboard"]["lock"](o),{"isOk":!0}}catch(r){return console.error("Error locking keyboard:",r),{"isOk":!1}}}_OnUnlockKeyboard(){try{navigator["keyboard"]["unlock"]()}catch(r){console.error("Error unlocking keyboard:",r)}}};self.RuntimeInterface.AddDOMHandlerClass(o)}

// scripts/plugins/gamepad/dom/domSide.js
"use strict";{const e="gamepad";let t=!1;const a=class extends self.DOMHandler{constructor(t){super(t,e),this._isReady=!1,this._timerId=-1,this.AddRuntimeMessageHandler("ready",()=>this._OnReady()),this.AddRuntimeMessageHandler("vibrate-dual-rumble",e=>this._OnGamepadVibrateDualRumble(e)),this.AddRuntimeMessageHandler("vibrate-trigger-rumble",e=>this._OnGamepadVibrateTriggerRumble(e)),this.AddRuntimeMessageHandler("reset-vibrate",e=>this._OnGamepadResetVibrate(e)),this.AddRuntimeMessageHandler("suspend",()=>this._OnSuspend()),this.AddRuntimeMessageHandler("resume",()=>this._OnResume()),window.addEventListener("gamepadconnected",e=>this._OnGamepadConnected(e)),window.addEventListener("gamepaddisconnected",e=>this._OnGamepadDisconnected(e)),window.addEventListener("unload",()=>this._OnWindowUnload())}_GetActiveGamepads(){try{return Array.from(navigator["getGamepads"]()).filter(e=>e&&e["connected"])}catch(e){return t||(console.warn("[Construct] Failed to access gamepads: ",e),t=!0),[]}}_OnReady(){this._isReady=!0;for(const e of this._GetActiveGamepads())this._PostGamepadConnectedEvent(e);this._StartGamepadPollTimer()}_StartGamepadPollTimer(){-1===this._timerId&&(this._timerId=setInterval(()=>this._PollGamepadState(),4))}_StopGamepadPollTimer(){-1!==this._timerId&&(clearInterval(this._timerId),this._timerId=-1)}_OnSuspend(){this._StopGamepadPollTimer()}_OnResume(){this._StartGamepadPollTimer()}_OnGamepadConnected(e){this._isReady&&this._PostGamepadConnectedEvent(e["gamepad"])}_GetGamepadSupportedVibrationEffects(e){const t=e["vibrationActuator"];return t&&t["playEffect"]&&Array.isArray(t["effects"])?t["effects"]:[]}_GetGamepadInfoJSON(e){return{"index":e["index"],"id":e["id"],"vibrationEffects":this._GetGamepadSupportedVibrationEffects(e)}}_PostGamepadConnectedEvent(e){this.PostToRuntime("gamepad-connected",this._GetGamepadInfoJSON(e))}_OnGamepadDisconnected(e){if(!this._isReady)return;const t=e["gamepad"];this.PostToRuntime("gamepad-disconnected",{"index":t["index"]})}_PollGamepadState(){const e=this._GetActiveGamepads();if(!e.length)return;const t=e.map(e=>Object.assign(this._GetGamepadInfoJSON(e),{"buttons":e["buttons"].map(e=>({"pressed":e["pressed"],"value":e["value"]})),"axes":e["axes"]}));this.PostToRuntime("input-update",t)}_GetGamepadByIndex(e){for(const t of this._GetActiveGamepads())if(t["index"]===e)return t;return null}async _OnGamepadVibrateDualRumble(e){const t=this._GetGamepadByIndex(e["index"]);if(!t)return;const a=t["vibrationActuator"];if(a&&a["playEffect"])try{await a["playEffect"]("dual-rumble",{"duration":e["duration"],"startDelay":0,"weakMagnitude":e["weakMag"],"strongMagnitude":e["strongMag"]})}catch(e){console.warn("[Gamepad] Failed to vibrate gamepad (dual rumble): ",e)}}async _OnGamepadVibrateTriggerRumble(e){const t=this._GetGamepadByIndex(e["index"]);if(!t)return;const a=t["vibrationActuator"];if(a&&a["playEffect"])try{await a["playEffect"]("trigger-rumble",{"duration":e["duration"],"startDelay":0,"weakMagnitude":e["weakMag"],"strongMagnitude":e["strongMag"],"leftTrigger":e["leftMag"],"rightTrigger":e["rightMag"]})}catch(e){console.warn("[Gamepad] Failed to vibrate gamepad (trigger rumble): ",e)}}_OnGamepadResetVibrate(e){const t=this._GetGamepadByIndex(e["index"]);if(!t)return;const a=t["vibrationActuator"];a&&a["reset"]&&a["reset"]()}_OnWindowUnload(){for(const e of this._GetActiveGamepads()){const t=e["vibrationActuator"];t&&t["reset"]&&t["reset"]()}}};self.RuntimeInterface.AddDOMHandlerClass(a)}

// scripts/plugins/LocalStorage/dom/domSide.js
"use strict";{const t="localstorage",s=class extends self.DOMHandler{constructor(s){super(s,t),this.AddRuntimeMessageHandlers([["init",()=>this._Init()],["request-persistent",()=>this._OnRequestPersistent()]])}async _Init(){let t=!1;try{t=await navigator["storage"]["persisted"]()}catch(s){t=!1,console.warn("[Construct] Error checking storage persisted state: ",s)}return{"isPersistent":t}}async _OnRequestPersistent(){try{return{"isOk":!0,"isPersistent":await navigator["storage"]["persist"]()}}catch(t){return console.error("[Construct] Error requesting persistent storage: ",t),{"isOk":!1}}}};self.RuntimeInterface.AddDOMHandlerClass(s)}

// scripts/plugins/Multiplayer/dom/net.js
"use strict";{const t=[],e=2*Math.PI;function s(t){return(t%=e)<0&&(t+=e),t}function i(t,e,s){return t<e?e:t>s?s:t}function n(t,e,s){return t+s*(e-t)}function a(t,e,s){return t===e?0:(s-t)/(e-t)}function r(t,e){if(t===e)return 0;const s=Math.sin(t),i=Math.cos(t),n=s*Math.sin(e)+i*Math.cos(e);return n>=1?0:n<=-1?Math.PI:Math.acos(n)}function h(t,e){const s=Math.sin(t);return Math.cos(t)*Math.sin(e)-s*Math.cos(e)<=0}function d(t,e,i){const n=r(t,e);return h(e,t)?s(t+n*i):s(t-n*i)}class _{constructor(t,e,s,i,n,a){this._index=t,this._interp=e,this._precision=s,this._tag=i,this._userData=n,this._clientValueTag=a}GetRuntimeData(){return{"tag":this._tag,"interp":this._interp,"userData":this._userData,"cvt":this._clientValueTag}}GetIndex(){return this._index}GetInterp(){return this._interp}GetPrecision(){return this._precision}GetTag(){return this._tag}HasUserData(){return void 0!==this._userData}GetUserData(){return this._userData}GetClientValueTag(){return this._clientValueTag}Clamp(t){switch(this._precision){case 0:default:return t;case 1:return Math.fround(t);case 2:return 2===this._interp&&(t=s(t),t/=Math.PI,t-=1,t*=32767),i(0|t,-32768,32767);case 3:return 2===this._interp&&(t=s(t),t/=e,t*=255),i(0|t,0,255)}}Write(t,e,s){switch(this._precision){case 0:t.setFloat64(e,s),e+=8;break;case 1:default:t.setFloat32(e,s),e+=4;break;case 2:t.setInt16(e,s),e+=2;break;case 3:t.setUint8(e,s),e+=1}return e}MaybeUnpack(t){return 2!==this._interp?t:2===this._precision?(t/=32767,t+=1,t*=Math.PI):3===this._precision?(t/=255,t*=e):t}static InterpNetValue(t,e,s,i,a){switch(t){case 0:default:return a?s:e;case 1:return n(e,s,i);case 2:return d(e,s,i)}}}class o{constructor(t,e){this.timestamp=t,this.data=e}}class u{constructor(t,e,s){this._ro=t,this._domHandler=t.GetDOMHandler(),this._id=e,this._nid=s,this._data=[],this._data.length=this._ro.GetNetValues().length,this._lastChanged=0,this._lastTransmitted=0,this._transmitMe=!1,this._isAlive=!1,this._updates=[],this._priorUpdate2=null,this._priorUpdate=null,this._nextUpdate=null}GetRuntimeData(){const t=[];for(let e=0,s=this._ro.GetNetValues().length;e<s;++e)t.push(this.GetInterp(this._ro.GetSimTime(),e));const e={"id":this._id,"nid":this._nid,"isTimedOut":this.IsTimedOut(),"interpValues":t,"latestUpdate":null},s=this.GetLatestUpdate();return s&&(e["latestUpdate"]={"timestamp":s.timestamp,"data":s.data}),e}GetId(){return this._id}GetNid(){return this._nid}SetAlive(t){this._isAlive=!!t}IsAlive(){return this._isAlive}ShouldTransmit(){return this._transmitMe}UpdateData(t,e){const s=t["netValues"],i=this._ro.GetNetValues(),n=i.length;this._transmitMe=!1;for(let t=0;t<n;++t){const n=i[t].Clamp(s[t]);this._data[t]!==n&&(this._data[t]=n,this._lastChanged=e,this._ro.SetLastChanged(e))}const a=e-this._lastChanged,r=e-this._lastTransmitted,h=this._ro.GetBandwidth();this._transmitMe=a<100&&0===h||(a<1e3&&h<=1?r>=95:r>=495),this._transmitMe&&this._ro.IncNumberToTransmit()}WriteData(t,e,s){const i=this._ro.GetNetValues();this._lastTransmitted=s,t.setUint16(e,this._nid),e+=2;for(let s=0,n=this._data.length;s<n;++s)e=i[s].Write(t,e,this._data[s]);return e}AddUpdate(t,e){for(let s=0,i=this._updates.length;s<i;++s){const i=this._updates[s];if(i.timestamp===t)return;if(i.timestamp>t)return void this._updates.splice(s,0,new o(t,e))}this._updates.push(new o(t,e))}IsTimedOut(){return 0!==this._updates.length&&this._updates[this._updates.length-1].timestamp<this._ro.GetSimTime()-3e3}Tick(){for(;this._updates.length>2&&this._updates[0]!==this._priorUpdate2&&this._updates[0]!==this._priorUpdate&&this._updates[0]!==this._nextUpdate;)this._updates.shift();const t=this._ro.GetSimTime();if(!(this._nextUpdate&&this._nextUpdate.timestamp>t&&this._priorUpdate&&this._priorUpdate.timestamp<t)){this._nextUpdate=null;for(let e=0,s=this._updates.length;e<s;++e){const s=this._updates[e];if(!(s.timestamp<=t)){this._nextUpdate=s;break}(!this._priorUpdate||s.timestamp>this._priorUpdate.timestamp)&&(this._priorUpdate2=this._priorUpdate,this._priorUpdate=s)}}}GetLatestUpdate(){return 0===this._updates.length?null:this._updates[this._updates.length-1]}GetInterp(t,e,s){if(!this._nextUpdate&&!this._priorUpdate)return 0;if(this._nextUpdate&&!this._priorUpdate)return this._nextUpdate.data[e];const i=this._ro.GetNetValues();let n,r,h,d,o;if(!this._nextUpdate&&this._priorUpdate){if(this._priorUpdate2&&!s){n=this._priorUpdate2.timestamp,r=this._priorUpdate2.data[e],h=this._priorUpdate.timestamp,d=this._priorUpdate.data[e];let s=t;return s>this._priorUpdate.timestamp+this._ro.GetExtrapolateLimit()&&(s=this._priorUpdate.timestamp+this._ro.GetExtrapolateLimit()),o=a(n,h,s),_.InterpNetValue(i[e].GetInterp(),r,d,o,!0)}return this._priorUpdate.data[e]}return n=this._priorUpdate.timestamp,r=this._priorUpdate.data[e],h=this._nextUpdate.timestamp,d=this._nextUpdate.data[e],o=a(n,h,t),_.InterpNetValue(i[e].GetInterp(),r,d,o,!1)}}class p{constructor(t,e,s,i){switch(this._domHandler=t,this._roId=e,this._sid=s,this._nid=this._domHandler.GetNextObjectNid(),this._bandwidth=i,this._userData={},this._instanceByteSize=0,this._extrapolateLimit=250,this._bandwidth){case 1:this._extrapolateLimit=500;break;case 2:this._extrapolateLimit=2500}this._netValues=[],this._netInstances=[],this._idToNetInst=new Map,this._usedNids=new Set,this._nextNid=0,this._lastChanged=0,this._lastTransmitted=0,this._numberToTransmit=0,this._hasOverriddenNids=!1,this._deadNids=[],this._overrideNids=new Map,this._nidToNetInst=new Map,this._simTime=0,this._domHandler.AddRegisteredObject(this)}GetDOMHandler(){return this._domHandler}GetNetValues(){return this._netValues}GetRoId(){return this._roId}_SetNid(t){this._nid=t}GetNid(){return this._nid}SetLastChanged(t){this._lastChanged=t}GetBandwidth(){return this._bandwidth}IncNumberToTransmit(){this._numberToTransmit++}GetNumberToTransmit(){return this._numberToTransmit}GetSimTime(){return this._simTime}_SetHasOverriddenNids(t){this._hasOverriddenNids=!!t}HasOverriddenNids(){return this._hasOverriddenNids}GetExtrapolateLimit(){return this._extrapolateLimit}GetSid(){return this._sid}GetDeadNids(){return this._deadNids}AddValue(t,e,s,i,n){const a=new _(this._netValues.length,t,e,s,i,n);switch(e){case 0:this._instanceByteSize+=8;break;case 1:this._instanceByteSize+=4;break;case 2:this._instanceByteSize+=2;break;case 3:this._instanceByteSize+=1}this._netValues.push(a)}AddUpdate(t,e,s){this.GetNetInstForNid(e).AddUpdate(t,s)}Tick(){this._simTime=this._domHandler.GetSimulationTime();for(const t of this._netInstances)t.Tick()}GetCount(){return this._netInstances.length}GetNetInstAt(t){return(t=Math.floor(t))<0||t>=this._netInstances.length?null:this._netInstances[t]}GetNetInstByNid(t){for(const e of this._netInstances)if(e.GetNid()===t)return e;return null}GetNetValuesJson(){const t=[];for(const e of this._netValues){const s={"tag":e.GetTag(),"precision":e.GetPrecision(),"interp":e.GetInterp(),"clientvaluetag":e.GetClientValueTag()};e.HasUserData()&&(s["userdata"]=e.GetUserData()),t.push(s)}return t}SetNetValuesFrom(t){this._netValues.length=0,this._instanceByteSize=0;for(const e of t)this.AddValue(e["interp"],e["precision"],e["tag"],e["userdata"],e["clientvaluetag"])}GetNetInstForNid(t){let e=this._nidToNetInst.get(t);return e||(e=new u(this,-1,t),this._nidToNetInst.set(t,e),this._netInstances.push(e),e)}GetNetInstForId(t){let e=this._idToNetInst.get(t);return e||(e=new u(this,t,this.AllocateInstanceNid()),this._idToNetInst.set(t,e),this._netInstances.push(e),e)}AllocateInstanceNid(){do{this._nextNid++,this._nextNid>65535&&(this._nextNid=0)}while(this._usedNids.has(this._nextNid));const t=this._nextNid;return this._usedNids.add(t),t}RemoveNetInstance(t){const e=t.GetId(),s=t.GetNid();this._domHandler.IsHost()&&!this._hasOverriddenNids&&this._deadNids.push(s),this._idToNetInst.delete(e),this._nidToNetInst.delete(s),this._usedNids.delete(s);const i=this._netInstances.indexOf(t);i>-1&&this._netInstances.splice(i,1)}ClearAllNetInstances(){this._deadNids.length=0,this._idToNetInst.clear(),this._nidToNetInst.clear(),this._usedNids.clear(),this._netInstances.length=0}UpdateData(e,s){this._numberToTransmit=0;for(const t of this._netInstances)t.SetAlive(!1);for(let t=0,i=e.length;t<i;++t){const i=e[t],n=i["uid"],a=this.GetNetInstForId(n);a.SetAlive(!0),a.UpdateData(i,s)}for(const e of this._netInstances)e.IsAlive()||t.push(e);for(const e of t)this.RemoveNetInstance(e);t.length=0}WriteData(t,e,s){t.setUint16(e,this._nid),e+=2;let i=0;this._hasOverriddenNids&&(i=1),t.setUint8(e,i),e+=1,t.setUint16(e,this._numberToTransmit),e+=2,t.setUint16(e,this._instanceByteSize),e+=2;for(const i of this._netInstances)i.ShouldTransmit()&&(e=i.WriteData(t,e,s));return e}OverrideNid(t,e){if(this._idToNetInst.has(t))return void console.warn("OverrideNid passed id "+t+" which is already in use and cannot be overridden");if(this._usedNids.has(e))return void console.warn("OverrideNid passed nid "+e+" which is already in use and cannot be overridden");const s=new u(this,t,e);return this._idToNetInst.set(t,s),this._usedNids.add(e),this._netInstances.push(s),this._hasOverriddenNids=!0,s}RemoveObjectId(t){const e=this._idToNetInst.get(t);e&&this.RemoveNetInstance(e)}RemoveObjectNid(t){const e=this._nidToNetInst.get(t);e&&this.RemoveNetInstance(e)}GetRuntimeData(){return{"hasOverriddenNids":this.HasOverriddenNids(),"netValues":this._netValues.map(t=>t.GetRuntimeData()),"netInstances":this._netInstances.map(t=>t.GetRuntimeData())}}GetRuntimeInfoRequest(){return{"roId":this._roId,"sid":this._sid,"netValues":this._netValues.map(t=>t.GetRuntimeData())}}}self.C3NetValue=_,self.C3NetUpdate=o,self.C3RegisteredObject=p}

// scripts/plugins/Multiplayer/dom/peer.js
"use strict";{const e=self.C3NetUpdate,t=self.C3NetValue,s=window["RTCPeerConnection"]||window["webkitRTCPeerConnection"]||window["mozRTCPeerConnection"]||window["msRTCPeerConnection"],i=262144,n=524288,r=65536,a=16777216;function o(e){if(e)try{e.close()}catch(e){}}const d=[];function h(e,t,s){return e===t?0:(s-e)/(t-e)}function _(e){return new Promise(t=>setTimeout(t,e))}class l{constructor(e=1){this._maxParallel=e,this._queue=[],this._activeCount=0}Add(e){return new Promise((t,s)=>{this._queue.push({func:e,resolve:t,reject:s}),this._MaybeStartNext()})}async _MaybeStartNext(){if(!this._queue.length)return;if(this._activeCount>=this._maxParallel)return;this._activeCount++;const e=this._queue.shift();try{const t=await e.func();e.resolve(t)}catch(t){e.reject(t)}this._activeCount--,this._MaybeStartNext()}}class c{constructor(e,t,s,i,n,r,a,o,d){this._peer=e,this._transferId=t,this._toPeerId=s,this._blob=i,this._size=i.size,this._curOffset=0,this._dataType=n,this._mimeType=r,this._fileName=a,this._tag=o,this._contentMode=d,this._wasCancelled=!1}GetContentMode(){return this._contentMode}GetToPeerId(){return this._toPeerId}GetToPeer(){return this._toPeerId&&this._peer.GetDOMHandler().GetPeerById(this._toPeerId)||this._peer}async SendFragment(){if(this._wasCancelled)return;const e=r-12,t=Math.min(e,this._size-this._curOffset),s=this._blob.slice(this._curOffset,this._curOffset+t);this._curOffset+=t;const i=this._curOffset===this._size,n=await s.arrayBuffer();if(this._wasCancelled)return;const a=new ArrayBuffer(n.byteLength+4);new Uint8Array(a).set(new Uint8Array(n),4);return new DataView(a).setUint32(0,this._transferId),await this._peer.Send("o",a,f.FLAG_BINARY_TRANSFER),this._wasCancelled?void 0:(i?this._peer.GetDOMHandler()._OnPeerBinaryTransferComplete(this.GetToPeer(),"send",this._transferId,this._dataType,this._mimeType,this._fileName,this._contentMode,this._tag,null):this._peer.GetDOMHandler()._OnPeerBinaryTransferProgress(this.GetToPeer(),"send",this._contentMode,this._tag,this._curOffset/this._size),i)}FireCancelled(){this._wasCancelled=!0,this._peer.GetDOMHandler()._OnPeerBinaryTransferCancelled(this.GetToPeer(),"send",this._transferId,this._contentMode,this._tag)}}class m{constructor(e,t,s,i,n,r,a,o,d){this._peer=e,this._transferId=t,this._totalSize=s,this._receivedSize=0,this._bigChunks=[],this._smallChunks=[],this._totalSmallChunkSize=0,this._dataType=i,this._mimeType=n,this._fileName=r,this._tag=a,this._contentMode=o,this._fromPeerId=d,this._wasCancelled=!1}GetFromPeerId(){return this._fromPeerId}GetFromPeer(){return this._fromPeerId&&this._peer.GetDOMHandler().GetPeerById(this._fromPeerId)||this._peer}ReceiveFragment(e){if(this._wasCancelled)return;this._smallChunks.push(e),this._totalSmallChunkSize+=e.byteLength,this._receivedSize+=e.byteLength,this._totalSmallChunkSize>=a&&(this._bigChunks.push(new Blob(this._smallChunks)),this._smallChunks=[],this._totalSmallChunkSize=0);const t=this._receivedSize>=this._totalSize;if(t){const e=[...this._bigChunks,...this._smallChunks];let t;t="arraybuffer"!==this._dataType&&this._fileName?new File(e,this._fileName,{type:this._mimeType}):new Blob(e,{type:this._mimeType}),this._peer.GetDOMHandler()._OnPeerBinaryTransferComplete(this.GetFromPeer(),"receive",this._transferId,this._dataType,this._mimeType,this._fileName,this._contentMode,this._tag,t)}else this._peer.GetDOMHandler()._OnPeerBinaryTransferProgress(this.GetFromPeer(),"receive",this._contentMode,this._tag,this._receivedSize/this._totalSize);return t}FireCancelled(){this._wasCancelled=!0,this._peer.GetDOMHandler()._OnPeerBinaryTransferCancelled(this.GetFromPeer(),"receive",this._transferId,this._contentMode,this._tag)}}class p{constructor(e,t,s,i){this._toPeer=e,this._transferId=t,this._totalSize=s,this._relayedSize=0,this._contentMode=i,this._sendQueue=[]}GetContentMode(){return this._contentMode}QueueRelayFragment(e){return!!this._toPeer.WasRemoved()||(this._sendQueue.push(e),this._toPeer._SendSomeBinaryFragments(),!1)}HasData(){return this._sendQueue.length>0}async SendRelayFragment(){if(!this.HasData())return!1;if(this._toPeer.WasRemoved())return!0;const e=this._sendQueue.shift();this._relayedSize+=e.byteLength;const t=this._relayedSize>=this._totalSize,s=new ArrayBuffer(e.byteLength+4);new Uint8Array(s).set(new Uint8Array(e),4);return new DataView(s).setUint32(0,this._transferId),await this._toPeer.Send("o",s,f.FLAG_BINARY_TRANSFER),t}}class f{constructor(e,t,s){this._domHandler=e,this._id=t,this._nid=0,this._alias=s,this._pc=null,this._dco=null,this._isOOpen=!1,this._dcr=null,this._isROpen=!1,this._dcu=null,this._isUOpen=!1,this._sendThrottle=new l(1),this._receiveThrottle=new l(1),this._firedOpen=!1,this._firedClose=!1,this._wasRemoved=!1,this._hasConfirmed=!1,this._lastHeardFrom=0,this._connectTime=0,this._errorCount=0,this._availableCompressionFormats=[],this._localClientState=[],this._lastStateChange=0,this._lastStateTransmit=0,this._clientStateUpdates=[],this._priorUpdate2=null,this._priorUpdate=null,this._nextUpdate=null,this._lastPingSent=0,this._awaitingPong=!1,this._lastSentPingId=1,this._lastPingTimes=[],this._latency=0,this._pdv=0,this._isSendingBinaryFragments=!1,this._sendingBinaries=new Map,this._receivingBinaries=new Map,this._relayBinaries=new Map,this._domHandler._AddPeer(this)}GetId(){return this._id}GetNid(){return this._nid}_SetNid(e){this._nid=e}GetAlias(){return this._alias}IsHost(){return this===this._domHandler.GetHostPeer()}IsSelf(){return this===this._domHandler.GetSelfPeer()}GetLocalClientState(){return this._localClientState}_SetLastStateChange(e){this._lastStateChange=e}GetLastStateChange(){return this._lastStateChange}_SetLastStateTransmit(e){this._lastStateTransmit=e}GetLastStateTransmit(){return this._lastStateTransmit}GetLatency(){return this._latency}GetPdv(){return this._pdv}GetDOMHandler(){return this._domHandler}_AttachDataChannelHandlers(e,t){e.binaryType="arraybuffer",e.onopen=()=>{"o"===t?this._isOOpen=!0:"r"===t?this._isROpen=!0:"u"===t&&(this._isUOpen=!0),this._MaybeFireOpen()},e.onmessage=e=>{this._OnNetworkMessage(t,e)},e.onerror=e=>{console.error("Peer '"+this._id+"' datachannel '"+t+"' error: ",e),this._domHandler._OnPeerError(this,e),this._domHandler.IsHost()&&!this.IsHost()&&this.Remove("network error")},e.onclose=()=>{this.Remove("disconnect")},"o"===t&&(e.bufferedAmountLowThreshold=i,e.onbufferedamountlow=()=>this._OnBufferedAmountLow())}Connect(){if(this.IsSelf())return;const e=this._domHandler.IsHost();this._isOOpen=!1,this._isROpen=!1,this._isUOpen=!1,this._firedOpen=!1,this._firedClose=!1,this._connectTime=performance.now(),this._pc=new s({"iceServers":this._domHandler.GetICEServerList()}),this._pc.onicecandidate=e=>{e.candidate&&this._domHandler.SignallingSend({"message":"icecandidate","toclientid":this._id,"icecandidate":e.candidate})},this._pc.onsignalingstatechange=()=>{this._pc&&"closed"===this._pc.signalingState&&this.Remove("disconnect")},this._pc.oniceconnectionstatechange=()=>{this._pc&&("failed"!==this._pc.iceConnectionState&&"closed"!==this._pc.iceConnectionState||this.Remove("disconnect"))},this._pc["onconnectionstatechange"]=()=>{if(!this._pc)return;const e=this._pc["connectionState"];"failed"!==e&&"closed"!==e||this.Remove("disconnect")};const t=`c3mp_${this._domHandler.GetCurrentGame()}_${this._domHandler.GetCurrentGameInstance()}_${this._domHandler.GetCurrentRoom()}`;e?(this._nid=this._domHandler.AllocatePeerNid(),this._dco=this._pc.createDataChannel("o",{ordered:!0,protocol:t}),this._AttachDataChannelHandlers(this._dco,"o"),this._dcr=this._pc.createDataChannel("r",{ordered:!1,protocol:t}),this._AttachDataChannelHandlers(this._dcr,"r"),this._dcu=this._pc.createDataChannel("u",{ordered:!1,maxRetransmits:0,protocol:t}),this._AttachDataChannelHandlers(this._dcu,"u"),this._pc.createOffer().then(e=>{this._pc.setLocalDescription(e),this._domHandler.SignallingSend({"message":"offer","toclientid":this._id,"offer":e})}).catch(e=>{console.error("Host error creating offer for peer '"+this._id+"': ",e),this._domHandler._OnPeerError(this,"could not create offer for peer")})):this._pc.ondatachannel=e=>{if(e.channel.protocol!==t)return console.error("Unexpected datachannel protocol '"+e.channel.protocol+"', should be '"+t+"'"),this._domHandler._OnPeerError(this,"unexpected datachannel protocol '"+e.channel.protocol+"', should be '"+t+"'"),void(this._wasRemoved||(this.Remove("datachannel protocol error"),this._domHandler.OnWasKicked()));const s=e.channel.label;"o"===s?this._dco=e.channel:"r"===s?this._dcr=e.channel:"u"===s?this._dcu=e.channel:(console.error("Unknown datachannel label: "+e.channel.label),this._domHandler._OnPeerError(this,"unknown datachannel label '"+e.channel.label+"'")),this._AttachDataChannelHandlers(e.channel,s)}}async _AddICECandidate(e){if(this._pc)try{await this._pc.addIceCandidate(e)}catch(e){console.warn("[Multiplayer] Error adding ICE candidate: ",e)}}HasPeerConnection(){return!!this._pc}GetPeerConnection(){return this._pc}_MaybeFireOpen(){this._firedOpen||this._isROpen&&this._isUOpen&&this._isOOpen&&(this._OnOpen(),this._firedOpen=!0,this._firedClose=!1)}_OnOpen(){if(this._lastHeardFrom=performance.now(),this._domHandler.IsHost()){this._domHandler.HostBroadcast("o",JSON.stringify({"c":"j","i":this._id,"n":this._nid,"a":this._alias}),0,this),this.Send("o",JSON.stringify({"c":"hi","hn":this._domHandler.GetHostPeer().GetNid(),"n":this._nid,"d":this._domHandler.GetClientDelay(),"u":this._domHandler.GetPeerUpdateRateSec(),"objs":this._domHandler.GetRegisteredObjectsMap(),"cvs":this._domHandler.GetClientValuesJson(),"comp":this._domHandler.GetLocalSupportedCompressionFormats()}));for(const e of this._domHandler.peers())!e.IsHost()&&e!==this&&e.IsOpen()&&this.Send("o",JSON.stringify({"c":"j","i":e.GetId(),"n":e.GetNid(),"a":e.GetAlias()}))}else this._hasConfirmed=!0,this.IsHost()&&this.SendPing(performance.now(),!0),this.Send("o",JSON.stringify({"c":"comp","comp":this._domHandler.GetLocalSupportedCompressionFormats()}));this._domHandler._OnPeerOpen(this)}_MaybeFireClose(e){!this._firedClose&&this._firedOpen&&(this._OnClose(e),this._firedClose=!0,this._firedOpen=!1)}_OnClose(e){this._domHandler.IsHost()&&!this.IsSelf()&&this._domHandler.HostBroadcast("o",JSON.stringify({"c":"l","i":this._id,"a":this._alias,"r":e}),0,this),this.IsSelf()||this._domHandler._OnPeerClose(this,e)}IsOpen(){return this._firedOpen&&!this._firedClose}TransferBinary(e,t,s,i,n,r,a,o){this._sendingBinaries.set(e,new c(this,e,t,s,i,n,r,a,o));const d={"c":"start-binary-transfer","transferId":e,"toPeerId":t,"size":s.size,"dataType":i,"mimeType":n,"fileName":r,"tag":a,"contentMode":o},h="s"===o?f.FLAG_SCRIPT_DATA:0;this.Send("o",JSON.stringify(d),h),this._SendSomeBinaryFragments()}_OnBufferedAmountLow(){this._SendSomeBinaryFragments()}async _SendSomeBinaryFragments(){if(this._dco&&this._isOOpen&&!this._isSendingBinaryFragments){this._isSendingBinaryFragments=!0;try{for(;this._dco&&this._isOOpen&&(this._sendingBinaries.size>0||[...this._relayBinaries.values()].some(e=>e.HasData()))&&this._dco.bufferedAmount<n;){for(const[e,t]of this._sendingBinaries){await t.SendFragment()&&this._sendingBinaries.delete(e)}for(const[e,t]of this._relayBinaries){await t.SendRelayFragment()&&this._relayBinaries.delete(e)}}}finally{this._isSendingBinaryFragments=!1}}}_OnReceiveStartBinaryTransferMessage(e){const t=e["transferId"],s=e["toPeerId"],i=e["contentMode"],n=e["size"];if(this._domHandler.IsHost()&&s){const r=this._domHandler.GetPeerById(s);if(!r)return void console.warn(`[Multiplayer] Error in host binary transfer relay: peer ID '${s}' not found`);r._relayBinaries.set(t,new p(r,t,n,i)),e["fromPeerId"]=this.GetId();const a="s"===i?f.FLAG_SCRIPT_DATA:0;return void r.Send("o",JSON.stringify(e),a)}const r=e["dataType"],a=e["mimeType"],o=e["fileName"],d=e["tag"],h=e["fromPeerId"];if(this._receivingBinaries.has(t))return void console.error(`[Multiplayer] Error receiving binary: transfer ID ${t} already in use`);this._receivingBinaries.set(t,new m(this,t,n,r,a,o,d,i,h));let _=this;h&&(_=this._domHandler.GetPeerById(h)??this),this._domHandler._OnPeerBinaryTransferStart(_,t,a,o,n,i,d)}_OnBinaryTransferFragment(e,t){const s=new DataView(e,t).getUint32(0),i=e.slice(t+4);if(this._domHandler.IsHost()){const e=this._domHandler._GetRelayPeerForTransferId(s);if(e){return void e._relayBinaries.get(s).QueueRelayFragment(i)}}const n=this._receivingBinaries.get(s);if(!n)return void console.error(`[Multiplayer] Error receiving binary: received fragment for invalid transfer ID ${s}`);n.ReceiveFragment(i)&&this._receivingBinaries.delete(s)}_HasRelayTransferId(e){return this._relayBinaries.has(e)}CancelBinaryTransfer(e,t){const s=this._sendingBinaries.get(e);if(!s)return;const i={"c":"cancel-binary-transfer","transferId":e,"toPeerId":t},n="s"===s.GetContentMode()?f.FLAG_SCRIPT_DATA:0;this.Send("o",JSON.stringify(i),n),s.FireCancelled(),this._sendingBinaries.delete(e)}_OnReceiveCancelBinaryTransferMessage(e){const t=e["transferId"],s=e["toPeerId"];if(this._domHandler.IsHost()&&s){const i=this._domHandler.GetPeerById(s);if(!i)return;const n=i._relayBinaries.get(t);if(!n)return;const r="s"===n.GetContentMode()?f.FLAG_SCRIPT_DATA:0;return void i.Send("o",JSON.stringify(e),r)}const i=this._receivingBinaries.get(t);i&&(i.FireCancelled(),this._receivingBinaries.delete(t))}_DetermineSupportedCompressionFormats(e){const t=this._domHandler.GetLocalSupportedCompressionFormats();for(const s of e)t.includes(s)&&this._availableCompressionFormats.push(s)}async _MaybeCompress(e){if(0===this._availableCompressionFormats.length)return{compressionType:0,data:e};const t=new Blob([e]);if(t.size<64)return{compressionType:0,data:e};const s=this._availableCompressionFormats[0],i=new CompressionStream(s),n=t.stream().pipeThrough(i),r=await new Response(n).arrayBuffer();if(r.byteLength>=t.size)return{compressionType:0,data:e};{const e=f.COMPRESSION_TYPES.indexOf(s);if(e<0)throw new Error("invalid compression type");return{compressionType:e,data:r}}}async Send(e,t,s=0){this._domHandler.StatAddOutboundDecompressedBandwidthCount(t);const i=this._PrepareSend(e,t,s);let n=i;"o"===e&&(n=this._sendThrottle.Add(()=>i));const r=await n;r&&this._NetworkSend(e,r)}async _PrepareSend(e,t,s=0){const i="string"==typeof t,{compressionType:n,data:r}=await this._MaybeCompress(t);let a=r;if(r instanceof ArrayBuffer){0!==n&&(s|=n<<4,i&&(s|=f.FLAG_STRING_DATA));const e=new ArrayBuffer(r.byteLength+8),t=new DataView(e);t.setUint32(0,f.MAGIC_NUMBER),t.setUint32(4,s),new Uint8Array(e,8).set(new Uint8Array(r)),a=e}this._domHandler.StatIncOutboundCount(),this._domHandler.StatAddOutboundBandwidthCount(a);const o=this._domHandler.GetSimulatedPacketLoss(),d=this._domHandler.GetSimulatedLatency(),h=this._domHandler.GetSimulatedPdv();if(o>0&&"u"===e&&Math.random()<o)return null;if(0!==d||0!==h){let t=1;"u"!==e&&Math.random()<o&&(t=3),await _((d+Math.random()*h)*t)}return a}_NetworkSend(e,t){try{"o"===e?this._isOOpen&&this._dco&&this._dco.send(t):"r"===e?this._isROpen&&this._dcr&&this._dcr.send(t):"u"===e&&this._isUOpen&&this._dcu&&this._dcu.send(t)}catch(s){if(this._wasRemoved)return;this._domHandler.IsHost()?"o"===e||"r"===e?("string"==typeof t?(console.error("Error sending "+t.length+"-char string on '"+e+"' to '"+this._alias+"', host kicking: ",s),console.log("String that failed to send from previous error was: "+t)):console.error("Error sending "+(t.length||t.byteLength)+"-byte binary on '"+e+"' to '"+this._alias+"', host kicking: ",s),this.Remove("network error")):(this._errorCount++,this._errorCount>=10&&("string"==typeof t?(console.error("Too many errors ("+this._errorCount+") sending data on '"+e+"' to '"+this._alias+"', kicking; last error was for sending "+t.length+"-char string: ",s),console.log("String that failed to send from previous error was: "+t)):console.error("Too many errors ("+this._errorCount+") sending data on '"+e+"' to '"+this._alias+"', kicking; last error was for sending "+(t.length||t.byteLength)+"-byte binary: ",s),this.Remove("network error"))):console.error("Error sending data on '"+e+"': ",s)}}SendPing(e,t){if(!this._wasRemoved){if(!t&&!this.IsOpen()&&this._pc&&e-this._connectTime>25e3)return console.warn("Timed out '"+this._alias+"', could not establish connection after 25sec"),void this.Remove("timeout");if(!t&&this.IsOpen()&&e-this._lastHeardFrom>2e4)return console.warn("Timed out '"+this._alias+"', not heard from for 20sec"),void this.Remove("timeout");this._lastPingSent=e,this._awaitingPong=!0,this._lastSentPingId++,this.Send("u","ping:"+this._lastSentPingId)}}SendPong(e){let t="pong:"+e.substr(5);this._domHandler.IsHost()&&(t+="/",t+=Math.round(performance.now()).toString()),this.Send("u",t)}_OnPong(e){if(!this._awaitingPong)return;const t=e.indexOf(":");if(!(t>-1))return void console.warn("Cannot parse off ping ID from pong");if(parseFloat(e.substr(t+1))!==this._lastSentPingId)return;const s=performance.now();this._awaitingPong=!1;const i=(s-this._lastPingSent)/2;this._lastPingTimes.push(i),this._lastPingTimes.length>10&&this._lastPingTimes.shift(),d.push(...this._lastPingTimes),d.sort((e,t)=>e-t),this._pdv=d[d.length-1]-d[0];let n=0,r=d.length;d.length>=4&&d.length<=6?(++n,--r):d.length>6&&(n+=2,r-=2);let a=0;for(let e=n;e<r;++e)a+=d[e];if(this._latency=a/(r-n),d.length=0,!this._domHandler.IsHost()){const t=e.indexOf("/");if(t>-1){const n=parseFloat(e.substr(t+1));isFinite(n)?this._domHandler.AddHostTime(n,s,i,this._latency):console.warn("Invalid host time from pong response")}else console.warn("Cannot parse off host time from pong response")}}async _OnNetworkMessage(e,t){const s=this._PrepareReceive(e,t.data);let i=s;"o"===e&&(i=this._receiveThrottle.Add(()=>s));const n=await i;n&&this._HandleReceivedMessage(e,n)}async _PrepareReceive(e,t){this._domHandler.StatIncInboundCount(),this._domHandler.StatAddInboundBandwidthCount(t);const s=this._domHandler.GetSimulatedPacketLoss(),i=this._domHandler.GetSimulatedLatency(),n=this._domHandler.GetSimulatedPdv();if(s>0&&"u"===e&&Math.random()<s)return null;if(0!==i||0!==n){let t=1;"u"!==e&&Math.random()<s&&(t=3),await _(i*t+Math.random()*n*t)}return t instanceof ArrayBuffer?await this._ReadBinaryHeaderAndMaybeDecompress(t):t}async _ReadBinaryHeaderAndMaybeDecompress(e){if(e.byteLength<8)return console.warn(`Rejected binary message as too small (only ${e.byteLength} bytes)`),null;const t=new DataView(e),s=t.getUint32(0),i=t.getUint32(4);if(s!==f.MAGIC_NUMBER)return console.warn(`Rejected binary message with invalid magic number (0x${s.toString(16)})`),null;const n=(i&f.FLAG_COMPRESSION_MASK)>>4;if(0===n)return{data:e,offset:8,flags:i};{if(n>=f.COMPRESSION_TYPES.length)throw new Error("invalid compression type");const t=f.COMPRESSION_TYPES[n],s=new Blob([new Uint8Array(e,8)]),r=new DecompressionStream(t),a=s.stream().pipeThrough(r),o=await new Response(a).arrayBuffer();return 0===(i&f.FLAG_STRING_DATA)?{data:o,offset:0,flags:i}:(new TextDecoder).decode(o)}}_HandleReceivedMessage(e,t){if(!this._wasRemoved){if(this._lastHeardFrom=performance.now(),"string"==typeof t){if(this._domHandler.StatAddInboundDecompressedBandwidthCount(t),""===t.trim()||t.length<4)return;const i=t.substr(0,4);if("ping"===i)return void this.SendPong(t);if("pong"===i)return void this._OnPong(t);var s;try{s=JSON.parse(t)}catch(e){return this._domHandler._OnPeerError(this,e),this._domHandler.IsHost()?(console.error("Error parsing message as JSON for peer '"+this._id+"', host kicking: ",e),this.Remove("data error")):console.error("Error parsing message as JSON for peer '"+this._id+"': ",e),void console.log("String that failed to parse from previous error: "+t)}if(!s)return;try{s["c"]&&"m"!==s["c"]?this._OnControlMessage(s):this._domHandler._OnPeerMessage(this,s,e)}catch(e){this._domHandler._OnPeerError(this,e),this._domHandler.IsHost()?(console.error("Error handling message for peer '"+this._id+"', host kicking: ",e),this.Remove("data error")):console.error("Error handling message for peer '"+this._id+"': ",e)}return}this._domHandler.StatAddInboundDecompressedBandwidthCount(t.data),!this._hasConfirmed&&this._domHandler.IsHost()&&"u"===e&&(this._hasConfirmed=!0,this._domHandler.SignallingConfirmPeer(this._id));try{const s=t.data,i=t.offset,n=t.flags;this._OnBinaryMessage(s,i,n,e)}catch(e){return this._domHandler._OnPeerError(this,e),void(this._domHandler.IsHost()?(console.error("Error handling binary update for peer '"+this._id+"', host kicking: ",e),this.Remove("data error")):console.error("Error handling binary update for peer '"+this._id+"': ",e))}}}_OnControlMessage(e){let t,s;switch(e["c"]){case"disconnect":e["k"]&&this._domHandler.OnWasKicked(),s=!this._domHandler.IsHost()&&!this.IsHost(),this.Remove(e["r"]),s&&this._domHandler.SignallingLeaveRoom();break;case"hi":this._domHandler.IsHost()||(this._domHandler.GetHostPeer()._SetNid(e["hn"]),this._domHandler.GetSelfPeer()._SetNid(e["n"]),this._domHandler.SetClientDelay(e["d"]),this._domHandler.SetPeerUpdateRateSec(e["u"]),this._domHandler.MapObjectNids(e["objs"]),this._domHandler.MapClientValues(e["cvs"]),e.hasOwnProperty("comp")&&this._DetermineSupportedCompressionFormats(e["comp"]));break;case"comp":this._DetermineSupportedCompressionFormats(e["comp"]);break;case"j":this._domHandler.IsHost()||(t=new f(this._domHandler,e["i"],e["a"]),t._SetNid(e["n"]),this._domHandler._OnPeerOpen(t));break;case"l":this._domHandler.IsHost()||(t=this._domHandler.GetPeerById(e["i"]),t&&(t.IsSelf()||this._domHandler._OnPeerClose(t,e["r"]),t.Remove(e["r"])));break;case"start-binary-transfer":this._OnReceiveStartBinaryTransferMessage(e);break;case"cancel-binary-transfer":this._OnReceiveCancelBinaryTransferMessage(e);break;default:console.error("Unknown control message from peer '"+this._id+"': "+e["c"]),this._domHandler._OnPeerError(this,"unknown control message '"+e["c"]+"'")}}_OnBinaryMessage(e,t,s,i){if(0!==(s&f.FLAG_BINARY_TRANSFER))this._OnBinaryTransferFragment(e,t);else if(0!==(s&(f.FLAG_SCRIPT_DATA|f.FLAG_EVENT_DATA))){const n=0!==(s&f.FLAG_EVENT_DATA)?"e":"s";this._domHandler._OnPeerBinaryMessage(this,0===t?e:e.slice(t),i,n)}else{const i=new DataView(e,t);this._domHandler.IsHost()?this._OnHostUpdate(i,s):this._OnPeerUpdate(i,s)}}_OnHostUpdate(e,t){let s=0,i=e.getFloat64(s);if(s+=8,i+=this._latency,Math.abs(i-performance.now())>=3e3)return;const n=e.getUint8(s);s+=1;const r=[],a=this._domHandler.GetClientValues();for(let t=0;t<n;++t){if(t>=a.length){r.push(0);continue}const i=a[t];let n=0;switch(i.GetPrecision()){case 0:n=e.getFloat64(s),s+=8;break;case 1:default:n=e.getFloat32(s),s+=4;break;case 2:n=i.MaybeUnpack(e.getInt16(s)),s+=2;break;case 3:n=i.MaybeUnpack(e.getUint8(s)),s+=1}r.push(n)}this._AddClientUpdate(i,r)}_AddClientUpdate(t,s){for(let i=0,n=this._clientStateUpdates.length;i<n;++i){const n=this._clientStateUpdates[i];if(n.timestamp===t)return;if(n.timestamp>t)return void this._clientStateUpdates.splice(i,0,new e(t,s))}this._clientStateUpdates.push(new e(t,s))}Tick(e){if(0!==this._clientStateUpdates.length){for(;this._clientStateUpdates.length>2&&this._clientStateUpdates[0]!==this._priorUpdate2&&this._clientStateUpdates[0]!==this._priorUpdate&&this._clientStateUpdates[0]!==this._nextUpdate;)this._clientStateUpdates.shift();if(!(this._nextUpdate&&this._nextUpdate.timestamp>e&&this._priorUpdate&&this._priorUpdate.timestamp<e)){this._nextUpdate=null;for(let t=0,s=this._clientStateUpdates.length;t<s;++t){const s=this._clientStateUpdates[t];if(!(s.timestamp<=e)){this._nextUpdate=s;break}(!this._priorUpdate||s.timestamp>this._priorUpdate.timestamp)&&(this._priorUpdate2=this._priorUpdate,this._priorUpdate=s)}}}}_OnPeerUpdate(e,t){0===(t&f.FLAG_HOST_UPDATE_TYPE)?this._HandlePeerUpdate(e):this._HandlePeerEvents(e)}_HandlePeerUpdate(e){let t=0;const s=e.getFloat64(t);t+=8;const i=e.getUint16(t);t+=2;for(let n=0;n<i;++n){const i=e.getUint16(t);t+=2;const n=e.getUint8(t);t+=1;let r=null,a=0;const o=this._domHandler.GetRegisteredObjectByNid(i);o?(r=o.GetNetValues(),a=r.length,1===n&&o._SetHasOverriddenNids(!0)):console.warn("Don't know which object corresponds to NID "+i);const d=e.getUint16(t);t+=2;const h=e.getUint16(t);t+=2;for(let i=0;i<d;++i){const i=e.getUint16(t);if(t+=2,o){const n=[];let d=t;for(let t=0;t<a;++t){const s=r[t];let i=0;switch(s.GetPrecision()){case 0:i=e.getFloat64(d),d+=8;break;case 1:default:i=e.getFloat32(d),d+=4;break;case 2:i=s.MaybeUnpack(e.getInt16(d)),d+=2;break;case 3:i=s.MaybeUnpack(e.getUint8(d)),d+=1}n.push(i)}o.AddUpdate(s,i,n)}t+=h}}}_HandlePeerEvents(e){let t=0;const s=e.getFloat64(t);t+=8;const i=e.getUint16(t);t+=2;for(let n=0;n<i;++n){const i=e.getUint16(t);t+=2;const n=this._domHandler.GetRegisteredObjectByNid(i);n||console.warn("Don't know which object corresponds to NID "+i);const r=e.getUint16(t);t+=2;for(let i=0;i<r;++i){const i=e.getUint16(t);t+=2,n&&(n.HasOverriddenNids()||(this._domHandler._OnInstanceDestroyed(n,i,s),n.RemoveObjectNid(i)))}}}Remove(e,t){if(!this._wasRemoved){this._wasRemoved=!0;for(const e of this._sendingBinaries.values())e.FireCancelled();this._sendingBinaries.clear();for(const e of this._receivingBinaries.values())e.FireCancelled();this._receivingBinaries.clear(),this._relayBinaries.clear(),this._MaybeFireClose(e),this.Send("o",JSON.stringify({"c":"disconnect","r":e,"k":!!t})).then(()=>{const e=this._dco,t=this._dcr,s=this._dcu,i=this._pc;setTimeout(()=>{o(e),o(t),o(s),o(i)},1),this._dco=null,this._dcr=null,this._dcu=null,this._pc=null,this._isOOpen=!1,this._isROpen=!1,this._isUOpen=!1}),this._domHandler._RemovePeer(this)}}_OnPeerRemoved(e){for(const[t,s]of this._sendingBinaries)s.GetToPeerId()===e.GetId()&&(s.FireCancelled(),this._sendingBinaries.delete(t));for(const[t,s]of this._receivingBinaries)s.GetFromPeerId()===e.GetId()&&(s.FireCancelled(),this._receivingBinaries.delete(t))}WasRemoved(){return this._wasRemoved}HasClientState(e){return this._domHandler.HasClientValueTag(e)}GetClientState(e){const t=this._domHandler.GetClientValueByTag(e);if(!t)return 0;const s=t.GetIndex();if(0===this._clientStateUpdates.length)return 0;const i=this._clientStateUpdates[this._clientStateUpdates.length-1].data;return s<0||s>=i.length?0:i[s]}GetInterpClientState(e){const s=e.GetIndex();if(!this._nextUpdate&&!this._priorUpdate)return 0;if(this._nextUpdate&&!this._priorUpdate){const e=this._nextUpdate.data;return s<0||s>=e.length?0:e[s]}const i=this._domHandler.GetSimulationTime();let n,r,a,o,d;if(!this._nextUpdate&&this._priorUpdate){if(this._priorUpdate2){n=this._priorUpdate2.timestamp,r=this._priorUpdate2.data[s],a=this._priorUpdate.timestamp,o=this._priorUpdate.data[s];let e=i;return e>this._priorUpdate.timestamp+250&&(e=this._priorUpdate.timestamp+250),d=h(n,a,e),t.InterpNetValue(this._domHandler.GetClientValues()[s].GetInterp(),r,o,d,!0)}{const e=this._priorUpdate.data;return s<0||s>=e.length?0:e[s]}}return n=this._priorUpdate.timestamp,r=this._priorUpdate.data[s],a=this._nextUpdate.timestamp,o=this._nextUpdate.data[s],d=h(n,a,i),t.InterpNetValue(this._domHandler.GetClientValues()[s].GetInterp(),r,o,d,!1)}}f.MAGIC_NUMBER=1664314736,f.FLAG_HOST_UPDATE_TYPE=1,f.FLAG_STRING_DATA=2,f.FLAG_SCRIPT_DATA=4,f.FLAG_BINARY_TRANSFER=8,f.FLAG_COMPRESSION_MASK=240,f.FLAG_EVENT_DATA=256,f.COMPRESSION_TYPES=["none","deflate","gzip"],self.C3Peer=f}

// scripts/plugins/Multiplayer/dom/domSide.js
"use strict";{const e=self.C3NetValue,t=self.C3Peer,s="multiplayer",i=window["RTCPeerConnection"]||window["webkitRTCPeerConnection"]||window["mozRTCPeerConnection"]||window["msRTCPeerConnection"],n=window["RTCSessionDescription"]||window["webkitRTCSessionDescription"]||window["mozRTCSessionDescription"]||window["msRTCSessionDescription"],o=window["RTCIceCandidate"]||window["webkitRTCIceCandidate"]||window["mozRTCIceCandidate"]||window["msRTCIceCandidate"],r=window["RTCDataChannel"]||window["webkitRTCDataChannel"]||window["mozRTCDataChannel"]||window["msRTCDataChannel"],a="c2multiplayer",l=1,d=2,h=[{"urls":"stun:stun.l.google.com:19302"}];function g(e){if("undefined"==typeof CompressionStream||"function"!=typeof Blob.prototype.stream)return!1;try{return new CompressionStream(e),!0}catch(e){return!1}}function c(e){return"number"==typeof e.byteLength?e.byteLength:"number"==typeof e.length?e.length:(console.warn("[Construct] Multiplayer: don't know how to measure size of data: ",e),0)}const m=[];g("deflate")&&m.push("deflate"),g("gzip")&&m.push("gzip");const _=1,u=2;let f=!1;const S=[],P=class extends self.DOMHandler{constructor(e){super(e,s),this._iceServers=[],this._sigWs=null,this._isSignallingConnected=!1,this._isSignallingLoggedIn=!1,this._sigservInfo={protocolrev:0,version:0,name:"",operator:"",motd:""},this._myId="",this._myAlias="",this._game="",this._gameInstance="",this._room="",this._allPeers=[],this._peersById=new Map,this._nextPeerNid=0,this._usedPeerNids=new Set,this._selfPeer=null,this._hostPeer=null,this._clientDelay=80,this._hostUpdateRateSec=30,this._peerUpdateRateSec=30,this._lastUpdateTime=0,this._stats={lastSecondTime:0,outboundPerSec:0,outboundCount:0,outboundBandwidthPerSec:0,outboundDecompressedBandwidthPerSec:0,outboundBandwidthCount:0,outboundDecompressedBandwidthCount:0,inboundPerSec:0,inboundCount:0,inboundBandwidthPerSec:0,inboundDecompressedBandwidthPerSec:0,inboundBandwidthCount:0,inboundDecompressedBandwidthCount:0},this._dataBuffer=new ArrayBuffer(262144),this._dataView=new DataView(this._dataBuffer),this._allRegisteredObjects=[],this._nextObjectNid=1,this._registeredObjectsByNid=new Map,this._registeredObjectsByRoId=new Map,this._simLatency=0,this._simPdv=0,this._simPacketLoss=0,this._lastTimeDiffs=[],this._targetHostTimeDiff=0,this._hostTimeDiff=0,this._targetSimDelay=this._clientDelay,this._simDelay=this._clientDelay,this._allClientValues=[],this._clientValuesByTag=new Map,this._receivedClientValues=!1,this._signallingPromises={connect:{resolve:null,reject:null},login:{resolve:null,reject:null},joinRoom:{resolve:null,reject:null},leaveRoom:{resolve:null,reject:null},listGameInstances:{resolve:null,reject:null},listRooms:{resolve:null,reject:null}},this._MergeICEServerList(h),setInterval(()=>this._DoPings(),2e3),window.addEventListener("unload",()=>this.RemoveAllPeers("quit")),this.AddRuntimeMessageHandler("get-supported",()=>this._OnGetSupported()),this.AddRuntimeMessageHandler("add-ice-servers",e=>this._MergeICEServerList(e["list"])),this.AddRuntimeMessageHandler("simulate-latency",e=>this.SetLatencySimulation(e["latency"],e["pdv"],e["loss"])),this.AddRuntimeMessageHandler("set-bandwidth-profile",e=>this.SetBandwidthSettings(e["updateRate"],e["delay"])),this.AddRuntimeMessageHandler("tick",e=>this.Tick(e)),this.AddRuntimeMessageHandler("alert",e=>this.Alert(e)),this.AddRuntimeMessageHandler("signalling-connect",e=>this.SignallingConnect(e["url"])),this.AddRuntimeMessageHandler("signalling-disconnect",()=>this.SignallingDisconnect()),this.AddRuntimeMessageHandler("signalling-login",e=>this.SignallingLogin(e["alias"])),this.AddRuntimeMessageHandler("signalling-join-room",e=>this.SignallingJoinGameRoom(e["game"],e["instance"],e["room"],e["maxClients"])),this.AddRuntimeMessageHandler("signalling-auto-join-room",e=>this.SignallingAutoJoinGameRoom(e["game"],e["instance"],e["room"],e["maxClients"],e["lock"])),this.AddRuntimeMessageHandler("signalling-leave-room",()=>this.SignallingLeaveRoom()),this.AddRuntimeMessageHandler("signalling-list-game-instances",e=>this.SignallingRequestGameInstanceList(e["game"])),this.AddRuntimeMessageHandler("signalling-list-rooms",e=>this.SignallingRequestRoomList(e["game"],e["instance"],e["which"])),this.AddRuntimeMessageHandler("disconnect-room",()=>this.DisconnectRoom(!0)),this.AddRuntimeMessageHandler("peer-send-message",e=>this.OnPeerSendMessage(e)),this.AddRuntimeMessageHandler("host-broadcast",e=>this.OnHostBroadcast(e)),this.AddRuntimeMessageHandler("peer-transfer-binary",e=>this.OnPeerTransferBinary(e)),this.AddRuntimeMessageHandler("peer-cancel-binary-transfer",e=>this.OnCancelBinaryTransfer(e)),this.AddRuntimeMessageHandler("kick-peer",e=>this.OnKickPeer(e)),this.AddRuntimeMessageHandler("sync-object",e=>this.OnSyncObject(e)),this.AddRuntimeMessageHandler("sync-inst-var",e=>this.OnSyncInstVar(e)),this.AddRuntimeMessageHandler("associate-object",e=>this.OnAssociateObject(e)),this.AddRuntimeMessageHandler("remove-object-id",e=>this.RemoveObjectId(e["uid"])),this.AddRuntimeMessageHandler("remove-net-insts",e=>this.OnRemoveNetInsts(e)),this.AddRuntimeMessageHandler("remove-object-nid",e=>this.OnRemoveObjectNid(e)),this.AddRuntimeMessageHandler("set-client-state",e=>this.SetClientState(e["tag"],e["value"])),this.AddRuntimeMessageHandler("add-client-input-value",e=>this.AddClientInputValue(e["tag"],e["precision"],e["interp"]))}_GetErrorMessage(e){return e?"string"==typeof e?e:"string"==typeof e["message"]?e["message"]:"string"==typeof e["details"]?e["details"]:"string"==typeof e["data"]?e["data"]:"string"==typeof e["type"]?e["type"]:"unknown error":"unknown error"}IsConnected(){return this._isSignallingConnected}IsLoggedIn(){return this.IsConnected()&&this._isSignallingLoggedIn}IsInRoom(){return!!this._room}IsHost(){return this.IsInRoom()&&this._selfPeer&&this._hostPeer===this._selfPeer}GetMyId(){return this._myId}GetMyAlias(){return this._myAlias}GetCurrentGame(){return this._game}GetCurrentGameInstance(){return this._gameInstance}GetCurrentRoom(){return this._room}GetHostId(){return this._hostPeer?this._hostPeer.GetId():""}GetHostAlias(){return this._hostPeer?this._hostPeer.GetAlias():""}GetHostPeer(){return this._hostPeer}GetSelfPeer(){return this._selfPeer}SetLatencySimulation(e,t,s){this._simLatency=Math.max(e,0),this._simPdv=Math.max(t,0),this._simPacketLoss=Math.max(s,0)}GetSimulatedPacketLoss(){return this._simPacketLoss}GetSimulatedLatency(){return this._simLatency}GetSimulatedPdv(){return this._simPdv}_OnGetSupported(){return{"isSupported":!(!i||!r)}}_CreateSignallingPromise(e){return e.reject&&e.reject("overlapping signalling operation"),new Promise((t,s)=>{e.resolve=t,e.reject=s})}_ResolveSignallingPromise(e,t){e.resolve&&e.resolve(t),e.resolve=null,e.reject=null}_RejectSignallingPromises(e){for(const t of Object.values(this._signallingPromises))t.reject&&t.reject(e),t.resolve=null,t.reject=null}SignallingConnect(e){if(this._sigWs||this._isSignallingConnected)return Promise.resolve();const t=this._CreateSignallingPromise(this._signallingPromises.connect);try{this._sigWs=new WebSocket(e,a)}catch(e){return this._sigWs=null,this._OnSignallingError(e),t}return this._sigWs.onopen=()=>{if(-1===this._sigWs.protocol.indexOf(a))return this._OnSignallingError("server does not support '"+a+"' protocol"),this._sigWs.close(1002,"'"+a+"' protocol required"),this._sigWs=null,void(this._isSignallingConnected=!1);this._isSignallingConnected=!0},this._sigWs.onclose=e=>{this._OnSignallingClose(),this._isSignallingConnected=!1,this._isSignallingLoggedIn=!1,this._sigWs=null},this._sigWs.onerror=e=>{console.error("Signalling server error: ",e),this._OnSignallingError(e)},this._sigWs.onmessage=e=>{this._OnSignallingMessage(e)},t}SignallingDisconnect(){this._sigWs&&this._isSignallingConnected&&(this._sigWs.close(),this._sigWs=null,this._isSignallingConnected=!1)}_OnSignallingMessage(e){let t;try{t=JSON.parse(e.data)}catch(e){return void this._OnSignallingError(e)}switch(t["message"]){case"welcome":this._OnSignallingReceiveWelcome(t);break;case"login-ok":this._OnSignallingReceiveLoginOK(t);break;case"join-ok":this._OnSignallingReceiveJoinOK(t);break;case"leave-ok":this._OnSignallingReceiveLeaveOK(t);break;case"kicked":this._OnSignallingReceiveKicked(t);break;case"peer-joined":this._OnSignallingReceivePeerJoined(t);break;case"peer-quit":this._OnSignallingReceivePeerQuit(t);break;case"icecandidate":this._OnSignallingReceiveIceCandidate(t);break;case"offer":this._OnSignallingReceiveOffer(t);break;case"answer":this._OnSignallingReceiveAnswer(t);break;case"instance-list":this._OnSignallingReceiveInstanceList(t);break;case"room-list":this._OnSignallingReceiveRoomList(t);break;case"error":this._OnSignallingError(t["details"]);break;default:this._OnSignallingError("received unknown signalling message")}}HasICEServerUrl(e){for(const t of this._iceServers)if(t["urls"]===e["urls"])return!0;return!1}_MergeICEServerList(e){if(e)for(let t of e)"string"==typeof t&&(t={"urls":t}),this.HasICEServerUrl(t)||(t.hasOwnProperty("url")||(t["url"]=t["urls"]),this._iceServers.push(t))}GetICEServerList(){return this._iceServers}_OnSignallingError(e){this.PostToRuntime("signalling-error",{"message":this._GetErrorMessage(e)}),this._RejectSignallingPromises(e)}_OnSignallingClose(){this.PostToRuntime("signalling-close")}_OnSignallingReceiveWelcome(e){if(e["protocolrev"]<1||e["protocolrev"]>l)return this._OnSignallingError("signalling server protocol revision not supported"),void this.SignallingDisconnect();this._myId=e["clientid"],this._room="";const t=this._sigservInfo;t.protocolrev=e["protocolrev"],t.version=e["version"],t.name=e["name"],t.operator=e["operator"],t.motd=e["motd"],this._MergeICEServerList(e["ice_servers"]),this.PostToRuntime("signalling-welcome",{"myid":this._myId,"sigservinfo":{"protocolrev":t.protocolrev,"version":t.version,"name":t.name,"operator":t.operator,"motd":t.motd}}),this._ResolveSignallingPromise(this._signallingPromises.connect)}_OnSignallingReceiveLoginOK(e){this._myAlias=e["alias"],this._isSignallingLoggedIn=!0,this.PostToRuntime("signalling-login-ok",{"myalias":this._myAlias}),this._ResolveSignallingPromise(this._signallingPromises.login)}GetNextObjectNid(){return this._nextObjectNid++}AllocatePeerNid(){if(!this.IsHost())return;do{this._nextPeerNid++,this._nextPeerNid>65535&&(this._nextPeerNid=0)}while(this._usedPeerNids.has(this._nextPeerNid));const e=this._nextPeerNid;return this._usedPeerNids.add(e),e}FreePeerNid(e){this.IsHost()&&this._usedPeerNids.delete(e)}_OnSignallingReceiveJoinOK(e){this.RemoveAllPeers("disconnect"),this._game=e["game"],this._gameInstance=e["instance"],this._room=e["room"],this._selfPeer=new t(this,this._myId,this._myAlias),e["host"]?(this._hostPeer=this._selfPeer,this._nextPeerNid=0,this._usedPeerNids.clear(),this._hostPeer._SetNid(this.AllocatePeerNid())):(this._lastTimeDiffs.length=0,this._targetHostTimeDiff=0,this._hostTimeDiff=0,this._clientDelay=80,this._hostUpdateRateSec=30,this._peerUpdateRateSec=30,this._targetSimDelay=this._clientDelay,this._simDelay=this._clientDelay,this._hostPeer=new t(this,e["hostid"],e["hostalias"]),this._hostPeer.Connect()),this.PostToRuntime("signalling-join-ok",{"isHost":!!e["host"],"hostId":this._hostPeer.GetId(),"hostAlias":this._hostPeer.GetAlias(),"game":this._game,"gameInstance":this._gameInstance,"room":this._room}),this._ResolveSignallingPromise(this._signallingPromises.joinRoom)}_OnSignallingReceiveLeaveOK(e){this._room="",this.PostToRuntime("signalling-leave-ok"),this._ResolveSignallingPromise(this._signallingPromises.leaveRoom)}_OnSignallingReceiveKicked(e){"host-left"===e["reason"]?this.SignallingDisconnect():(this.DisconnectRoom(),this._room="",this.PostToRuntime("signalling-kicked"))}_OnSignallingReceivePeerJoined(e){if(!this._isSignallingLoggedIn||!this._room||!this.IsHost())return;const s=this._peersById.get(e["peerid"]);s&&s.Remove("rejoin");new t(this,e["peerid"],e["peeralias"]).Connect()}_OnSignallingReceivePeerQuit(e){if(!this._isSignallingLoggedIn||!this._room||!this.IsHost())return;const t=this._peersById.get(e["id"]);t&&t.Remove(e["reason"])}_OnSignallingReceiveIceCandidate(e){if(!this._isSignallingLoggedIn||!this._room)return;const t=this._peersById.get(e["from"]);t&&t._AddICECandidate(new o(e["icecandidate"]))}_OnSignallingReceiveOffer(e){if(!this._isSignallingLoggedIn||!this._room||this.IsHost()||!this._selfPeer||!this._hostPeer||!this._hostPeer.HasPeerConnection())return;if(e["from"]!==this._hostPeer.GetId())return;const t=this._hostPeer.GetPeerConnection();t.setRemoteDescription(new n(e["offer"])).then(()=>{t.createAnswer().then(e=>{t.setLocalDescription(e),this.SignallingSend({"message":"answer","toclientid":this._hostPeer.GetId(),"answer":e})}).catch(e=>{console.error("Peer error creating answer: ",e),this._OnPeerError(this._selfPeer,"could not create answer to host offer")})}).catch(e=>{console.error("Peer error setting remote description: ",e),this._OnPeerError(this._selfPeer,"could not set remote description")})}_OnSignallingReceiveAnswer(e){if(!this._isSignallingLoggedIn||!this._room||!this.IsHost())return;const t=this._peersById.get(e["from"]);t&&t.GetPeerConnection().setRemoteDescription(new n(e["answer"])).catch(e=>{console.error("Host error setting remote description: ",e)})}_OnSignallingReceiveInstanceList(e){this.PostToRuntime("signalling-instance-list",{"list":e["list"]}),this._ResolveSignallingPromise(this._signallingPromises.listGameInstances)}_OnSignallingReceiveRoomList(e){this.PostToRuntime("signalling-room-list",{"list":e["list"]}),this._ResolveSignallingPromise(this._signallingPromises.listRooms)}SignallingSend(e){this._sigWs&&this._isSignallingConnected&&this._sigWs.send(JSON.stringify(e))}SignallingLogin(e){if(this._isSignallingLoggedIn)return;const t=this._CreateSignallingPromise(this._signallingPromises.login);return this.SignallingSend({"message":"login","protocolrev":l,"datachannelrev":d,"compressionformats":this.GetLocalSupportedCompressionFormats(),"alias":e}),t}SignallingJoinGameRoom(e,t,s,i){if(!this._isSignallingLoggedIn||this._room)return;const n=this._CreateSignallingPromise(this._signallingPromises.joinRoom);return this.SignallingSend({"message":"join","game":e,"instance":t,"room":s,"max_clients":i}),n}SignallingAutoJoinGameRoom(e,t,s,i,n){if(!this._isSignallingLoggedIn||this._room)return;const o=this._CreateSignallingPromise(this._signallingPromises.joinRoom);return this.SignallingSend({"message":"auto-join","game":e,"instance":t,"room":s,"max_clients":i,"lock_when_full":n}),o}SignallingLeaveRoom(){if(!this._isSignallingLoggedIn)return;const e=this._CreateSignallingPromise(this._signallingPromises.leaveRoom);return this.SignallingSend({"message":"leave"}),e}SignallingConfirmPeer(e){this._isSignallingLoggedIn&&this.IsHost()&&this.SignallingSend({"message":"confirm-peer","id":e})}SignallingRequestGameInstanceList(e){if(!this._sigWs||!this._isSignallingConnected)return;const t=this._CreateSignallingPromise(this._signallingPromises.listGameInstances);return this.SignallingSend({"message":"list-instances","game":e}),t}SignallingRequestRoomList(e,t,s){if(!this._sigWs||!this._isSignallingConnected)return;const i=this._CreateSignallingPromise(this._signallingPromises.listRooms);return this.SignallingSend({"message":"list-rooms","game":e,"instance":t,"which":s}),i}DisconnectRoom(e){this._lastTimeDiffs.length=0,this._targetHostTimeDiff=0,this._hostTimeDiff=0,this.RemoveAllPeers("disconnect");for(const e of this._allRegisteredObjects)e.ClearAllNetInstances();e&&this.SignallingLeaveRoom()}_AddPeer(e){this._allPeers.push(e),this._peersById.set(e.GetId(),e),this.PostToRuntime("add-peer",{"id":e.GetId(),"alias":e.GetAlias()})}_RemovePeer(e){this.PostToRuntime("remove-peer",{"id":e.GetId()}),this.IsHost()&&this.FreePeerNid(e.GetNid());const t=this._allPeers.indexOf(e);t>-1&&this._allPeers.splice(t,1),this._peersById.delete(e.GetId());for(const t of this._allPeers)t._OnPeerRemoved(e);this._hostPeer===e&&(this._hostPeer=null,this.RemoveAllPeers("host quit")),this._selfPeer===e&&(this._selfPeer=null,this._room="",this.RemoveAllPeers("disconnect"))}RemoveAllPeers(e){if(!f){for(f=!0;this._allPeers.length;)this._allPeers[0].Remove(e);f=!1}}GetPeerById(e){return this._peersById.get(e)||null}GetAliasFromId(e){const t=this._peersById.get(e);return t?t.GetAlias():""}GetPeerByNid(e){for(const t of this._allPeers)if(t.GetNid()===e)return t;return null}OnHostBroadcast(e){const s=e["fromId"],i=e["tag"],n=e["message"],o=e["transmissionMode"],r=e["contentMode"],a=this.GetPeerById(s);if("s"===r&&n instanceof ArrayBuffer)this.HostBroadcast(o,n,t.FLAG_SCRIPT_DATA,a);else{const e={"c":"m","cm":r,"f":s,"m":n};"e"===r&&(e["t"]=i),this.HostBroadcast(o,JSON.stringify(e),0,a)}}HostBroadcast(e,t,s=0,i=null){if(!this.IsHost())return;const n=this._allPeers.slice(0);for(const o of n)o&&o!==this._selfPeer&&o!==i&&o.Send(e,t,s)}_DoPings(){const e=performance.now();if(this.IsHost()){S.push(...this._allPeers);for(const t of S)t&&t!==this._selfPeer&&t.SendPing(e,!1);S.length=0}else this._hostPeer&&this._hostPeer.SendPing(e,!1)}AddRegisteredObject(e){this._allRegisteredObjects.push(e),this._registeredObjectsByRoId.set(e.GetRoId(),e),this._registeredObjectsByNid.set(e.GetNid(),e)}GetRegisteredObjectsMap(){const e={};for(const[t,s]of this._registeredObjectsByNid.entries())e[s.GetSid()]={"nid":t,"nvs":s.GetNetValuesJson()};return e}MapObjectNids(e){this._registeredObjectsByNid.clear();for(const t of this._allRegisteredObjects)if(e.hasOwnProperty(t.GetSid().toString())){const s=e[t.GetSid().toString()];t._SetNid(s["nid"]),this._registeredObjectsByNid.set(s["nid"],t),t.SetNetValuesFrom(s["nvs"])}else console.warn("Could not map object SID '"+t.GetSid()+"' - host did not send NID for it"),t._SetNid(-1)}GetRegisteredObjectByNid(e){return this._registeredObjectsByNid.get(e)||null}Tick(e){if(!this.IsInRoom())return null;const t=e["dt"],s=performance.now(),i=this.IsHost()?this._hostUpdateRateSec:this._peerUpdateRateSec;s-this._lastUpdateTime>=1e3/i-5&&(this.SendUpdate(s),this._lastUpdateTime=s);const n=this._stats;s-n.lastSecondTime>=1e3&&(n.outboundPerSec=n.outboundCount,n.outboundBandwidthPerSec=n.outboundBandwidthCount,n.outboundDecompressedBandwidthPerSec=n.outboundDecompressedBandwidthCount,n.inboundPerSec=n.inboundCount,n.inboundBandwidthPerSec=n.inboundBandwidthCount,n.inboundDecompressedBandwidthPerSec=n.inboundDecompressedBandwidthCount,n.outboundCount=0,n.outboundBandwidthCount=0,n.outboundDecompressedBandwidthCount=0,n.inboundCount=0,n.inboundBandwidthCount=0,n.inboundDecompressedBandwidthCount=0,n.lastSecondTime+=1e3,s-n.lastSecondTime>500&&(n.lastSecondTime=s),this.PostToRuntime("stats",{"stats":{"outboundPerSec":n.outboundPerSec,"outboundBandwidthPerSec":n.outboundBandwidthPerSec,"outboundDecompressedBandwidthPerSec":n.outboundDecompressedBandwidthPerSec,"inboundPerSec":n.inboundPerSec,"inboundBandwidthPerSec":n.inboundBandwidthPerSec,"inboundDecompressedBandwidthPerSec":n.inboundDecompressedBandwidthPerSec}})),this.IsHost()||(this._hostTimeDiff<this._targetHostTimeDiff?(this._hostTimeDiff+=10*t,this._hostTimeDiff>this._targetHostTimeDiff&&(this._hostTimeDiff=this._targetHostTimeDiff)):this._hostTimeDiff>this._targetHostTimeDiff&&(this._hostTimeDiff-=10*t,this._hostTimeDiff<this._targetHostTimeDiff&&(this._hostTimeDiff=this._targetHostTimeDiff)),this._simDelay<this._targetSimDelay?(this._simDelay+=30*t,this._simDelay>this._targetSimDelay&&(this._simDelay=this._targetSimDelay)):this._simDelay>this._targetSimDelay&&(this._simDelay-=30*t,this._simDelay<this._targetSimDelay&&(this._simDelay=this._targetSimDelay)));const o=this.GetSimulationTime();for(const e of this._allPeers)e.Tick(o);for(const e of this._allRegisteredObjects)e.Tick();return{"simulationTime":this.GetSimulationTime(),"hostInputArrivalTime":this.GetHostInputArrivalTime(),"clientDelay":this._clientDelay,"peerData":this._GetPeerRuntimeData(),"roData":this._GetRegisteredObjectRuntimeData(),"isReadyForInput":this.IsReadyForInput()}}_GetPeerRuntimeData(){const e={};for(const t of this._allPeers){const s={};for(const e of this._allClientValues)s[e.GetTag()]=t.GetInterpClientState(e);e[t.GetId()]={"nid":t.GetNid(),"latency":t.GetLatency(),"pdv":t.GetPdv(),"clientState":s}}return e}_GetRegisteredObjectRuntimeData(){const e={};for(const t of this._allRegisteredObjects)e[t.GetRoId()]=t.GetRuntimeData();return e}async SendUpdate(e){this.IsHost()?(await this._SendHostUpdate(e),this._SendHostEvents(e)):await this._SendClientUpdate(e)}async _OnBeforeClientUpdate(){const e=await this.PostToRuntimeAsync("before-client-update");for(const t of e["clientStateUpdates"])this.SetClientState(t["tag"],t["value"])}async _SendClientUpdate(e){if(this.IsReadyForInput()&&await this._OnBeforeClientUpdate(),!this._selfPeer||!this._receivedClientValues)return;const t=this._dataView;let s=0;const i=this._allClientValues,n=this._selfPeer.GetLocalClientState(),o=e-this._selfPeer.GetLastStateChange(),r=e-this._selfPeer.GetLastStateTransmit();let a=!1;if(a=o<100||(o<1e3?r>=95:r>=495),a){t.setFloat64(s,e+this._hostTimeDiff),s+=8,t.setUint8(s,i.length),s+=1;for(let e=0,o=i.length;e<o;++e){const o=i[e];let r=0;e<n.length&&(r=o.Clamp(n[e])),s=o.Write(t,s,r)}this._selfPeer._SetLastStateTransmit(e),this._hostPeer.Send("u",this._dataBuffer.slice(0,s))}}async _SendHostUpdate(e){const t=this._dataView;let s=0,i=0;const n=await this.PostToRuntimeAsync("get-object-info",{"ros":this._allRegisteredObjects.map(e=>e.GetRuntimeInfoRequest())});for(const t of this._allRegisteredObjects){const s=t.GetRoId();if(!n.hasOwnProperty(s))continue;const o=n[s];t.UpdateData(o,e),t.GetNumberToTransmit()>0&&i++}if(0!==i){t.setFloat64(s,e),s+=8,t.setUint16(s,i),s+=2;for(const i of this._allRegisteredObjects)i.GetNumberToTransmit()>0&&(s=i.WriteData(t,s,e));this.HostBroadcast("u",this._dataBuffer.slice(0,s),0)}}_SendHostEvents(e){const s=this._dataView;let i=0,n=0;for(const e of this._allRegisteredObjects)e.GetDeadNids().length&&n++;if(0!==n){s.setFloat64(i,e),i+=8,s.setUint16(i,n),i+=2;for(const e of this._allRegisteredObjects){const t=e.GetDeadNids();if(t.length){s.setUint16(i,e.GetNid()),i+=2,s.setUint16(i,t.length),i+=2;for(const e of t)s.setUint16(i,e),i+=2;t.length=0}}this.HostBroadcast("r",this._dataBuffer.slice(0,i),t.FLAG_HOST_UPDATE_TYPE)}}AddHostTime(e,t,s,i){if(this.IsHost())return;this._targetSimDelay=i+this._clientDelay;var n=e+s-t;0===this._lastTimeDiffs.length&&(this._hostTimeDiff=n,this._simDelay=this._targetSimDelay),this._lastTimeDiffs.push(n),this._lastTimeDiffs.length>30&&this._lastTimeDiffs.shift(),S.push(...this._lastTimeDiffs),S.sort((e,t)=>e-t);let o=0,r=S.length;S.length>=4&&S.length<=6?(++o,--r):S.length>6&&S.length<=19?(o+=2,r-=2):S.length>19&&(o+=5,r-=5);let a=0;for(let e=o;e<r;++e)a+=S[e];this._targetHostTimeDiff=a/(r-o),S.length=0}GetSimulationTime(){return this.IsHost()?performance.now()-this._clientDelay:performance.now()+this._hostTimeDiff-this._simDelay}GetHostTime(){return this.IsHost()?performance.now():performance.now()+this._hostTimeDiff}GetHostInputArrivalTime(){return this.IsHost()?performance.now():performance.now()+this._hostTimeDiff+this._simDelay}SetClientState(e,t){if(this.IsHost()||!this._selfPeer||!this._receivedClientValues)return;const s=this._clientValuesByTag.get(e);if(!s)return;const i=s.GetIndex(),n=this._selfPeer.GetLocalClientState();n.length<i+1&&(n.length=i+1),n[i]!==t&&(n[i]=t,this._selfPeer._SetLastStateChange(performance.now()))}AddClientInputValue(t,s,i){const n=new e(this._allClientValues.length,i,s,t,null);this._clientValuesByTag.set(t,n),this._allClientValues.push(n)}GetClientValues(){return this._allClientValues}GetClientValuesJson(){const e=[];for(const t of this._allClientValues)e.push({"tag":t.GetTag(),"precision":t.GetPrecision(),"interp":t.GetInterp()});return e}MapClientValues(t){this._clientValuesByTag.clear(),this._allClientValues.length=0;for(let s=0,i=t.length;s<i;++s){const i=t[s],n=new e(s,i["interp"],i["precision"],i["tag"],null);this._clientValuesByTag.set(n.GetTag(),n),this._allClientValues.push(n)}this._receivedClientValues=!0}RemoveObjectId(e){for(const t of this._allRegisteredObjects)t.RemoveObjectId(e)}peers(){return this._allPeers}GetPeerCount(){return this.IsInRoom()?this._allPeers.length:0}GetPeerAt(e){return e=Math.floor(e),!this.IsInRoom()||e<0||e>=this._allPeers.length?null:this._allPeers[e]}IsReadyForInput(){return!!this.IsInRoom()&&(!!this.IsHost()||0!==this._targetHostTimeDiff)}SetBandwidthSettings(e,t){this.IsInRoom()||(this._hostUpdateRateSec=e,this._peerUpdateRateSec=e,this._clientDelay=t)}_OnPeerOpen(e){this.PostToRuntime("peer-open",{"id":e.GetId(),"alias":e.GetAlias()})}OnPeerSendMessage(e){const s=e["id"],i=e["tag"],n=e["message"],o=e["transmissionMode"],r=e["contentMode"],a=this.GetPeerById(s);if(a)if(n instanceof ArrayBuffer)a.Send(o,n,"e"===r?t.FLAG_EVENT_DATA:t.FLAG_SCRIPT_DATA);else{const e={"c":"m","cm":r,"m":n};"e"===r&&(e["t"]=i),a.Send(o,JSON.stringify(e))}}_GetTransferDetailsForPeerId(e){let t,s;return this.IsHost()?t=this.GetPeerById(e):(t=this.GetPeerById(e),t&&!t.IsHost()&&(t=this.GetHostPeer(),s=e)),{peer:t,toPeerId:s}}OnPeerTransferBinary(e){const t=e["id"],s=e["transferId"],i=e["blob"],n=e["dataType"],o=e["mimeType"],r=e["fileName"],a=e["tag"],l=e["contentMode"],{peer:d,toPeerId:h}=this._GetTransferDetailsForPeerId(t);d&&d.TransferBinary(s,h,i,n,o,r,a,l)}_OnPeerBinaryTransferStart(e,t,s,i,n,o,r){this.PostToRuntime("peer-binary-transfer-start",{"id":e.GetId(),"alias":e.GetAlias(),"transferId":t,"mimeType":s,"fileName":i,"totalSize":n,"contentMode":o,"tag":r})}_GetRelayPeerForTransferId(e){for(const t of this._allPeers)if(t._HasRelayTransferId(e))return t;return null}OnCancelBinaryTransfer(e){const t=e["id"],s=e["transferId"],{peer:i,toPeerId:n}=this._GetTransferDetailsForPeerId(t);i&&i.CancelBinaryTransfer(s,n)}_OnPeerBinaryTransferProgress(e,t,s,i,n){this.PostToRuntime("peer-binary-transfer-progress",{"id":e.GetId(),"alias":e.GetAlias(),"direction":t,"contentMode":s,"tag":i,"progress":n})}_OnPeerBinaryTransferCancelled(e,t,s,i,n){this.PostToRuntime("peer-binary-transfer-cancelled",{"id":e.GetId(),"alias":e.GetAlias(),"direction":t,"transferId":s,"contentMode":i,"tag":n})}_OnPeerBinaryTransferComplete(e,t,s,i,n,o,r,a,l){this.PostToRuntime("peer-binary-transfer-complete",{"id":e.GetId(),"alias":e.GetAlias(),"direction":t,"transferId":s,"dataType":i,"mimeType":n,"fileName":o,"contentMode":r,"tag":a,"blob":l})}_OnPeerClose(e,t){this.PostToRuntime("peer-close",{"id":e.GetId(),"alias":e.GetAlias(),"reason":t||"unknown"})}_OnPeerError(e,t){console.error(`[Multiplayer] Peer '${e.GetAlias()}' (${e.GetId()}) error: `,t)}_OnPeerMessage(e,t,s){const i=t["f"]||e.GetId();this.PostToRuntime("peer-message",{"tag":t["t"],"fromId":i,"fromAlias":this.GetAliasFromId(i),"transmissionMode":s,"content":t["m"],"contentMode":t["cm"]||"e"})}_OnPeerBinaryMessage(e,t,s,i){const n=e.GetId();this.PostToRuntime("peer-message",{"fromId":n,"fromAlias":this.GetAliasFromId(n),"transmissionMode":s,"content":t,"contentMode":i})}_OnInstanceDestroyed(e,t,s){this.PostToRuntime("instance-destroyed",{"roId":e.GetRoId(),"nid":t,"timestamp":s})}OnKickPeer(e){if(!this.IsHost())return;const t=e["id"],s=e["reason"],i=this.GetPeerById(t);i&&i.Remove(s,!0)}OnWasKicked(){this.PostToRuntime("peer-kicked")}StatIncOutboundCount(){this._stats.outboundCount++}StatAddOutboundBandwidthCount(e){this._stats.outboundBandwidthCount+=c(e)}StatAddOutboundDecompressedBandwidthCount(e){this._stats.outboundDecompressedBandwidthCount+=c(e)}StatIncInboundCount(){this._stats.inboundCount++}StatAddInboundBandwidthCount(e){this._stats.inboundBandwidthCount+=c(e)}StatAddInboundDecompressedBandwidthCount(e){this._stats.inboundDecompressedBandwidthCount+=c(e)}SetClientDelay(e){this._clientDelay=e}GetClientDelay(){return this._clientDelay}SetPeerUpdateRateSec(e){this._peerUpdateRateSec=e}GetPeerUpdateRateSec(){return this._peerUpdateRateSec}OnSyncObject(e){const t=e["x"],s=e["y"],i=e["angle"],n=e["precision"],o=e["bandwidth"];for(const r of e["objectClasses"]){const e=new self.C3RegisteredObject(this,r["roId"],r["sid"],o);t&&e.AddValue(_,n,"x"),s&&e.AddValue(_,n,"y"),i&&e.AddValue(u,n,"a")}}Alert(e){alert(e["message"])}OnSyncInstVar(e){const t=e["precision"],s=e["interp"],i=e["cvt"];for(const n of e["syncData"]){this._registeredObjectsByRoId.get(n["roId"]).AddValue(s,t,"iv",n["varIndex"],i)}}OnAssociateObject(e){const t=e["roId"],s=e["peerId"],i=e["instUid"],n=this._registeredObjectsByRoId.get(t),o=this._peersById.get(s);n&&o&&this.IsHost()&&n.OverrideNid(i,o.GetNid())}OnRemoveNetInsts(e){for(const[t,s]of Object.entries(e)){const e=this._registeredObjectsByRoId.get(parseInt(t,10));if(e)for(const t of s)e.RemoveObjectNid(t)}}OnRemoveObjectNid(e){const t=e["roId"],s=e["nid"],i=this._registeredObjectsByRoId.get(t);i&&i.RemoveObjectNid(s)}GetLocalSupportedCompressionFormats(){return m}};self.RuntimeInterface.AddDOMHandlerClass(P)}

// scripts/plugins/Audio/dom/domSide.js
"use strict";{const t=180/Math.PI,e="audio";self.AudioDOMHandler=class extends self.DOMHandler{constructor(t){super(t,e),this._audioContext=null,this._destinationNode=null,this._hasAttachedUnblockEvents=!1,this._unblockFunc=()=>this._UnblockAudioContext(),this._audioBuffers=[],this._audioInstances=[],this._lastAudioInstance=null,this._lastPlayedTags=[],this._loadedAudioUrls=new Set,this._lastTickCount=-1,this._pendingTags=new Map,this._masterVolume=1,this._isSilent=!1,this._timeScaleMode=0,this._timeScale=1,this._gameTime=0,this._panningModel="HRTF",this._distanceModel="inverse",this._refDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._lastListenerPos=[0,0,0],this._lastListenerOrientation=[0,0,-1,0,1,0],this._playMusicAsSound=!1,this._lastMusicBuffer=null,this._effects=new Map,this._analysers=new Set,this._isPendingPostFxState=!1,this._hasStartedOfflineRender=!1,this._microphoneTag="",this._microphoneSource=null,self["C3Audio_OnMicrophoneStream"]=(t,e)=>this._OnMicrophoneStream(t,e),this._destMediaStreamNode=null,self["C3Audio_GetOutputStream"]=()=>this._OnGetOutputStream(),self["C3Audio_DOMInterface"]=this,this.AddRuntimeMessageHandlers([["create-audio-context",t=>this._CreateAudioContext(t)],["play",t=>this._Play(t)],["stop",t=>this._Stop(t)],["stop-all",()=>this._StopAll()],["set-paused",t=>this._SetPaused(t)],["set-volume",t=>this._SetVolume(t)],["fade-volume",t=>this._FadeVolume(t)],["set-master-volume",t=>this._SetMasterVolume(t)],["set-muted",t=>this._SetMuted(t)],["set-silent",t=>this._SetSilent(t)],["set-looping",t=>this._SetLooping(t)],["set-playback-rate",t=>this._SetPlaybackRate(t)],["set-stereo-pan",t=>this._SetStereoPan(t)],["seek",t=>this._Seek(t)],["preload",t=>this._Preload(t)],["unload",t=>this._Unload(t)],["unload-all",()=>this._UnloadAll()],["set-suspended",t=>this._SetSuspended(t)],["add-effect",t=>this._AddEffect(t)],["set-effect-param",t=>this._SetEffectParam(t)],["remove-effects",t=>this._RemoveEffects(t)],["tick",t=>this._OnTick(t)],["load-state",t=>this._OnLoadState(t)],["offline-render-audio",t=>this._OnOfflineRenderAudio(t)],["offline-render-finish",()=>this._OnOfflineRenderFinish()]])}async _CreateAudioContext(t){if(t["usePlayMusicAsSoundWorkaround"]&&(this._playMusicAsSound=!0),this._timeScaleMode=t["timeScaleMode"],this._panningModel=["equalpower","HRTF","soundfield"][t["panningModel"]],this._distanceModel=["linear","inverse","exponential"][t["distanceModel"]],this._refDistance=t["refDistance"],this._maxDistance=t["maxDistance"],this._rolloffFactor=t["rolloffFactor"],this._iRuntime.IsExportingToVideo()){this._playMusicAsSound=!0;const t=48e3;this._audioContext=new OfflineAudioContext({"numberOfChannels":2,"sampleRate":t,"length":Math.ceil(this._iRuntime.GetExportToVideoDuration()*t)})}else this._audioContext=new AudioContext({"latencyHint":t["latencyHint"]}),"running"!==this._audioContext.state&&this._AttachUnblockEvents(),this._audioContext.onstatechange=()=>{"running"===this._audioContext.state?this._DetachUnblockEvents():this._AttachUnblockEvents(),this.PostToRuntime("audiocontext-state",{"audioContextState":this._audioContext.state})};this._destinationNode=this._audioContext["createGain"](),this._destinationNode["connect"](this._audioContext["destination"]);const e=t["listenerPos"];this._lastListenerPos[0]=e[0],this._lastListenerPos[1]=e[1],this._lastListenerPos[2]=e[2],this._audioContext["listener"]["setPosition"](e[0],e[1],e[2]),this._audioContext["listener"]["setOrientation"](...this._lastListenerOrientation),self["C3_GetAudioContextCurrentTime"]=()=>this.GetAudioCurrentTime();try{await Promise.all(t["preloadList"].map(t=>this._GetAudioBuffer(t["originalUrl"],t["url"],t["type"],!1)))}catch(t){console.error("[Construct] Preloading sounds failed: ",t)}return{"sampleRate":this._audioContext["sampleRate"],"audioContextState":this._audioContext.state,"outputLatency":this._audioContext["outputLatency"]||0}}_AttachUnblockEvents(){this._hasAttachedUnblockEvents||(window.addEventListener("pointerup",this._unblockFunc,!0),window.addEventListener("touchend",this._unblockFunc,!0),window.addEventListener("click",this._unblockFunc,!0),window.addEventListener("keydown",this._unblockFunc,!0),this._iRuntime.IsiOSWebView()||document.addEventListener("visibilitychange",this._unblockFunc),this._hasAttachedUnblockEvents=!0)}_DetachUnblockEvents(){this._hasAttachedUnblockEvents&&(window.removeEventListener("pointerup",this._unblockFunc,!0),window.removeEventListener("touchend",this._unblockFunc,!0),window.removeEventListener("click",this._unblockFunc,!0),window.removeEventListener("keydown",this._unblockFunc,!0),this._iRuntime.IsiOSWebView()||document.removeEventListener("visibilitychange",this._unblockFunc),this._hasAttachedUnblockEvents=!1)}_UnblockAudioContext(){"running"!==this._audioContext["state"]&&this._audioContext["resume"]()}_MatchTagLists(t,e){for(const s of e){let e=!1;for(const i of t)if(self.AudioDOMHandler.EqualsNoCase(i,s)){e=!0;break}if(!e)return!1}return!0}GetAudioContext(){return this._audioContext}GetAudioCurrentTime(){return this._audioContext["currentTime"]}GetDestinationNode(){return this._destinationNode}"GetAudioContextExtern"(){return this.GetAudioContext()}"GetDestinationNodeExtern"(){return this.GetDestinationNode()}GetDestinationForTag(t){const e=this._effects.get(t.toLowerCase());return e?e[0].GetInputNode():this.GetDestinationNode()}AddEffectForTag(t,e){t=t.toLowerCase();let s=this._effects.get(t);s||(s=[],this._effects.set(t,s)),e._SetIndex(s.length),e._SetTag(t),s.push(e),this._ReconnectEffects(t)}_ReconnectEffects(t){t=t.toLowerCase();let e=this.GetDestinationNode();const s=this._effects.get(t);if(s&&s.length){e=s[0].GetInputNode();for(let t=0,e=s.length;t<e;++t){const i=s[t];t+1===e?i.ConnectTo(this.GetDestinationNode()):i.ConnectTo(s[t+1].GetInputNode())}}for(const s of this.audioInstancesByEffectTag(t))s.Reconnect(e);this._microphoneSource&&this._microphoneTag===t&&(this._microphoneSource["disconnect"](),this._microphoneSource["connect"](e))}GetMasterVolume(){return this._masterVolume}IsSilent(){return this._isSilent}GetTimeScaleMode(){return this._timeScaleMode}GetTimeScale(){return this._timeScale}GetGameTime(){return this._gameTime}IsPlayMusicAsSound(){return this._playMusicAsSound}GetPanningModel(){return this._panningModel}GetDistanceModel(){return this._distanceModel}GetReferenceDistance(){return this._refDistance}GetMaxDistance(){return this._maxDistance}GetRolloffFactor(){return this._rolloffFactor}TryPlayMedia(t){this._iRuntime.TryPlayMedia(t)}RemovePendingPlay(t){this._iRuntime.RemovePendingPlay(t)}ReleaseInstancesForBuffer(t){let e=0;for(let s=0,i=this._audioInstances.length;s<i;++s){const i=this._audioInstances[s];this._audioInstances[e]=i,i.GetBuffer()===t?i.Release():++e}this._audioInstances.length=e}ReleaseAllMusicBuffersExceptLast(){let t=0;for(let e=0,s=this._audioBuffers.length;e<s;++e){const s=this._audioBuffers[e];this._audioBuffers[t]=s,s.IsMusic()&&s!==this._lastMusicBuffer?s.Release():++t}this._audioBuffers.length=t}*audioInstancesMatchingTags(t){if(t.length>0)for(const e of this._audioInstances)this._MatchTagLists(e.GetTags(),t)&&(yield e);else this._lastAudioInstance&&!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}*audioInstancesByEffectTag(t){if(t)for(const e of this._audioInstances)self.AudioDOMHandler.EqualsNoCase(e.GetEffectTag(),t)&&(yield e);else this._lastAudioInstance&&!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}async _GetAudioBuffer(t,e,s,i,n){for(const t of this._audioBuffers)if(t.GetUrl()===e)return i&&this._playMusicAsSound&&(this._lastMusicBuffer=t),await t.Load(),t;if(n)return null;i&&this._playMusicAsSound&&this.ReleaseAllMusicBuffersExceptLast();const o=self.C3AudioBuffer.Create(this,t,e,s,i);return this._audioBuffers.push(o),i&&this._playMusicAsSound&&(this._lastMusicBuffer=o),await o.Load(),this._loadedAudioUrls.has(t)||(this.PostToRuntime("buffer-metadata",{"originalUrl":t,"duration":o.GetDuration()}),this._loadedAudioUrls.add(t)),o}async _GetAudioInstance(t,e,s,i,n){for(const t of this._audioInstances)if(t.GetUrl()===e&&(t.CanBeRecycled()||n))return n&&this._playMusicAsSound&&(this._lastMusicBuffer=t.GetBuffer()),t.SetTags(i),t;const o=await this._GetAudioBuffer(t,e,s,n);if(o.WasReleased())throw new Error(`buffer '${t}' unloaded while loading`);const a=o.CreateInstance(i);return this._audioInstances.push(a),a}_AddPendingTags(t){const e=t.join(" ");let s=this._pendingTags.get(e);if(!s){let t=null;s={pendingCount:0,promise:new Promise(e=>t=e),resolve:t},this._pendingTags.set(e,s)}s.pendingCount++}_RemovePendingTags(t){const e=t.join(" "),s=this._pendingTags.get(e);if(!s)throw new Error("expected pending tag");s.pendingCount--,0===s.pendingCount&&(s.resolve(),this._pendingTags.delete(e))}TagsReady(t){const e=(0===t.length?this._lastPlayedTags:t).join(" "),s=this._pendingTags.get(e);return s?s.promise:Promise.resolve()}_MaybeStartTicking(){if(this._analysers.size>0)this._StartTicking();else for(const t of this._audioInstances)if(t.IsActive())return void this._StartTicking()}Tick(){for(const t of this._analysers)t.Tick();const t=this.GetAudioCurrentTime();for(const e of this._audioInstances)e.Tick(t);const e=this._audioInstances.filter(t=>t.IsActive()).map(t=>t.GetState());this.PostToRuntime("state",{"tickCount":this._lastTickCount,"outputLatency":this._audioContext["outputLatency"]||0,"audioInstances":e,"analysers":[...this._analysers].map(t=>t.GetData())}),0===e.length&&0===this._analysers.size&&this._StopTicking()}PostTrigger(t,e,s){this.PostToRuntime("trigger",{"type":t,"tags":e,"aiid":s})}async _Play(t){const e=t["originalUrl"],s=t["url"],i=t["type"],n=t["isMusic"],o=t["tags"],a=t["isLooping"],r=t["vol"],l=t["pos"],u=t["panning"],d=t["stereoPan"];let h=t["off"];h>0&&!t["trueClock"]&&(h+=this.GetAudioCurrentTime()),this._lastPlayedTags=o.slice(0),this._AddPendingTags(o);try{this._lastAudioInstance=await this._GetAudioInstance(e,s,i,o,n),u?(this._lastAudioInstance.SetPannerEnabled(!0),this._lastAudioInstance.SetPan(u["x"],u["y"],u["z"],u["angle"],u["innerAngle"],u["outerAngle"],u["outerGain"]),u.hasOwnProperty("uid")&&this._lastAudioInstance.SetUID(u["uid"])):"number"==typeof d&&0!==d?(this._lastAudioInstance.SetStereoPannerEnabled(!0),this._lastAudioInstance.SetStereoPan(d)):(this._lastAudioInstance.SetPannerEnabled(!1),this._lastAudioInstance.SetStereoPannerEnabled(!1)),this._lastAudioInstance.Play(a,r,l,h)}catch(t){return void console.error("[Construct] Audio: error starting playback: ",t)}finally{this._RemovePendingTags(o)}this._StartTicking()}_Stop(t){const e=t["tags"];for(const t of this.audioInstancesMatchingTags(e))t.Stop()}_StopAll(){for(const t of this._audioInstances)t.Stop()}_SetPaused(t){const e=t["tags"],s=t["paused"];for(const t of this.audioInstancesMatchingTags(e))s?t.Pause():t.Resume();this._MaybeStartTicking()}_SetVolume(t){const e=t["tags"],s=t["vol"];for(const t of this.audioInstancesMatchingTags(e))t.SetVolume(s)}_SetStereoPan(t){const e=t["tags"],s=t["p"];for(const t of this.audioInstancesMatchingTags(e))t.SetStereoPannerEnabled(!0),t.SetStereoPan(s)}async _FadeVolume(t){const e=t["tags"],s=t["vol"],i=t["duration"],n=t["stopOnEnd"];await this.TagsReady(e);for(const t of this.audioInstancesMatchingTags(e))t.FadeVolume(s,i,n);this._MaybeStartTicking()}_SetMasterVolume(t){this._masterVolume=t["vol"],this._destinationNode["gain"]["value"]=this._masterVolume}_SetMuted(t){const e=t["tags"],s=t["isMuted"];for(const t of this.audioInstancesMatchingTags(e))t.SetMuted(s)}_SetSilent(t){this._isSilent=t["isSilent"],this._iRuntime.SetSilent(this._isSilent);for(const t of this._audioInstances)t._UpdateMuted()}_SetLooping(t){const e=t["tags"],s=t["isLooping"];for(const t of this.audioInstancesMatchingTags(e))t.SetLooping(s)}async _SetPlaybackRate(t){const e=t["tags"],s=t["rate"];await this.TagsReady(e);for(const t of this.audioInstancesMatchingTags(e))t.SetPlaybackRate(s)}async _Seek(t){const e=t["tags"],s=t["pos"];await this.TagsReady(e);for(const t of this.audioInstancesMatchingTags(e))t.Seek(s)}async _Preload(t){const e=t["originalUrl"],s=t["url"],i=t["type"],n=t["isMusic"];try{await this._GetAudioInstance(e,s,i,"",n)}catch(t){console.error("[Construct] Audio: error preloading: ",t)}}async _Unload(t){const e=t["url"],s=t["type"],i=t["isMusic"],n=await this._GetAudioBuffer("",e,s,i,!0);if(!n)return;n.Release(),this._lastMusicBuffer===n&&(this._lastMusicBuffer=null);const o=this._audioBuffers.indexOf(n);-1!==o&&this._audioBuffers.splice(o,1)}_UnloadAll(){for(const t of this._audioBuffers)t.Release(),this._lastMusicBuffer===t&&(this._lastMusicBuffer=null);this._audioBuffers.length=0}_SetSuspended(t){const e=t["isSuspended"];!e&&this._audioContext["resume"]&&this._audioContext["resume"]();for(const t of this._audioInstances)t.SetSuspended(e);e&&this._audioContext["suspend"]&&this._audioContext["suspend"]()}_OnTick(t){if(this._timeScale=t["timeScale"],this._gameTime=t["gameTime"],this._lastTickCount=t["tickCount"],0!==this._timeScaleMode)for(const t of this._audioInstances)t._UpdatePlaybackRate();const e=t["listenerPos"];!e||this._lastListenerPos[0]===e[0]&&this._lastListenerPos[1]===e[1]&&this._lastListenerPos[2]===e[2]||(this._lastListenerPos[0]=e[0],this._lastListenerPos[1]=e[1],this._lastListenerPos[2]=e[2],this._audioContext["listener"]["setPosition"](e[0],e[1],e[2]));const s=t["listenerOrientation"];if(s&&(this._lastListenerOrientation[0]!==s[0]||this._lastListenerOrientation[1]!==s[1]||this._lastListenerOrientation[2]!==s[2]||this._lastListenerOrientation[3]!==s[3]||this._lastListenerOrientation[4]!==s[4]||this._lastListenerOrientation[5]!==s[5])){for(let t=0;t<6;++t)this._lastListenerOrientation[t]=s[t];this._audioContext["listener"]["setOrientation"](...this._lastListenerOrientation)}for(const e of t["instPans"]){const t=e["uid"];for(const s of this._audioInstances)s.GetUID()===t&&s.SetPanXYZA(e["x"],e["y"],e["z"],e["angle"])}}async _AddEffect(t){const e=t["type"],s=t.hasOwnProperty("tags")?t["tags"]:[t["tag"]],i=t["params"];let n,o;if("convolution"===e)try{o=await this._GetAudioBuffer(t["bufferOriginalUrl"],t["bufferUrl"],t["bufferType"],!1)}catch(t){return void console.log("[Construct] Audio: error loading convolution: ",t)}for(const a of s){if("filter"===e)n=new self.C3AudioFilterFX(this,...i);else if("delay"===e)n=new self.C3AudioDelayFX(this,...i);else if("convolution"===e)n=new self.C3AudioConvolveFX(this,o.GetAudioBuffer(),...i),n._SetBufferInfo(t["bufferOriginalUrl"],t["bufferUrl"],t["bufferType"]);else if("flanger"===e)n=new self.C3AudioFlangerFX(this,...i);else if("phaser"===e)n=new self.C3AudioPhaserFX(this,...i);else if("gain"===e)n=new self.C3AudioGainFX(this,...i);else if("stereopan"===e)n=new self.C3AudioStereoPanFX(this,...i);else if("tremolo"===e)n=new self.C3AudioTremoloFX(this,...i);else if("ringmod"===e)n=new self.C3AudioRingModFX(this,...i);else if("distortion"===e)n=new self.C3AudioDistortionFX(this,...i);else if("compressor"===e)n=new self.C3AudioCompressorFX(this,...i);else{if("analyser"!==e)throw new Error("invalid effect type");n=new self.C3AudioAnalyserFX(this,...i)}this.AddEffectForTag(a,n)}this._PostUpdatedFxState()}_SetEffectParam(t){const e=t["tags"],s=t["index"],i=t["param"],n=t["value"],o=t["ramp"],a=t["time"];for(const t of e){const e=this._effects.get(t.toLowerCase());!e||s<0||s>=e.length||e[s].SetParam(i,n,o,a)}this._PostUpdatedFxState()}_RemoveEffects(t){const e=t["tags"];for(const t of e){const e=t.toLowerCase(),s=this._effects.get(e);if(!s||!s.length)return;for(const t of s)t.Release();this._effects.delete(e),this._ReconnectEffects(e)}}_AddAnalyser(t){this._analysers.add(t),this._MaybeStartTicking()}_RemoveAnalyser(t){this._analysers.delete(t)}_PostUpdatedFxState(){this._isPendingPostFxState||(this._isPendingPostFxState=!0,Promise.resolve().then(()=>this._DoPostUpdatedFxState()))}_DoPostUpdatedFxState(){const t={};for(const[e,s]of this._effects)t[e]=s.map(t=>t.GetState());this.PostToRuntime("fxstate",{"fxstate":t}),this._isPendingPostFxState=!1}async _OnLoadState(t){const e=t["saveLoadMode"];if(3!==e){const t=[];for(const s of this._audioInstances)s.IsMusic()&&1===e||!s.IsMusic()&&2===e?t.push(s):s.Release();this._audioInstances=t}for(const t of this._effects.values())for(const e of t)e.Release();this._effects.clear(),this._timeScale=t["timeScale"],this._gameTime=t["gameTime"];const s=t["listenerPos"];this._lastListenerPos[0]=s[0],this._lastListenerPos[1]=s[1],this._lastListenerPos[2]=s[2],this._audioContext["listener"]["setPosition"](s[0],s[1],s[2]);const i=t["listenerOrientation"];if(Array.isArray(i)){for(let t=0;t<6;++t)this._lastListenerOrientation[t]=i[t];this._audioContext["listener"]["setOrientation"](...this._lastListenerOrientation)}this._isSilent=t["isSilent"],this._iRuntime.SetSilent(this._isSilent),this._masterVolume=t["masterVolume"],this._destinationNode["gain"]["value"]=this._masterVolume;const n=[];for(const e of Object.values(t["effects"]))n.push(Promise.all(e.map(t=>this._AddEffect(t))));await Promise.all(n),await Promise.all(t["playing"].map(t=>this._LoadAudioInstance(t,e))),this._MaybeStartTicking()}async _LoadAudioInstance(t,e){if(3===e)return;const s=t["bufferOriginalUrl"],i=t["bufferUrl"],n=t["bufferType"],o=t["isMusic"],a=t["tags"],r=t["isLooping"],l=t["volume"],u=t["playbackTime"];if(o&&1===e)return;if(!o&&2===e)return;let d=null;try{d=await this._GetAudioInstance(s,i,n,a,o)}catch(t){return void console.error("[Construct] Audio: error loading audio state: ",t)}d.LoadPanState(t["pan"]),d.LoadStereoPanState(t["stereoPan"]),d.Play(r,l,u,0),t["isPlaying"]||d.Pause(),d._LoadAdditionalState(t)}_OnMicrophoneStream(t,e){this._microphoneSource&&this._microphoneSource["disconnect"](),this._microphoneTag=e.toLowerCase(),this._microphoneSource=this._audioContext["createMediaStreamSource"](t),this._microphoneSource["connect"](this.GetDestinationForTag(this._microphoneTag))}_OnGetOutputStream(){return this._destMediaStreamNode||(this._destMediaStreamNode=this._audioContext["createMediaStreamDestination"](),this._destinationNode["connect"](this._destMediaStreamNode)),this._destMediaStreamNode["stream"]}async _OnOfflineRenderAudio(t){try{const e=t["time"],s=this._audioContext["suspend"](e);this._hasStartedOfflineRender?this._audioContext["resume"]():(this._audioContext["startRendering"]().then(t=>this._OnOfflineRenderCompleted(t)).catch(t=>this._OnOfflineRenderError(t)),this._hasStartedOfflineRender=!0),await s}catch(t){this._OnOfflineRenderError(t)}}_OnOfflineRenderFinish(){this._audioContext["resume"]()}_OnOfflineRenderCompleted(t){const e=[];for(let s=0,i=t["numberOfChannels"];s<i;++s){const i=t["getChannelData"](s);e.push(i.buffer)}this._iRuntime.PostToRuntimeComponent("runtime","offline-audio-render-completed",{"duration":t["duration"],"length":t["length"],"numberOfChannels":t["numberOfChannels"],"sampleRate":t["sampleRate"],"channelData":e},null,e)}_OnOfflineRenderError(t){console.error("[Audio] Offline rendering error: ",t)}static EqualsNoCase(t,e){return t===e||t.normalize().toLowerCase()===e.normalize().toLowerCase()}static ToDegrees(e){return e*t}static DbToLinearNoCap(t){return Math.pow(10,t/20)}static DbToLinear(t){return Math.max(Math.min(self.AudioDOMHandler.DbToLinearNoCap(t),1),0)}static LinearToDbNoCap(t){return Math.log(t)/Math.log(10)*20}static LinearToDb(t){return self.AudioDOMHandler.LinearToDbNoCap(Math.max(Math.min(t,1),0))}static e4(t,e){return 1-Math.exp(-e*t)}},self.RuntimeInterface.AddDOMHandlerClass(self.AudioDOMHandler)}

// scripts/plugins/Audio/dom/audioBuffer.js
"use strict";self.C3AudioBuffer=class{constructor(t,e,i,s,o){this._audioDomHandler=t,this._originalUrl=e,this._url=i,this._type=s,this._isMusic=o,this._api="",this._loadState="not-loaded",this._loadPromise=null}Release(){this._loadState="not-loaded",this._audioDomHandler=null,this._loadPromise=null}WasReleased(){return!this._audioDomHandler}static Create(t,e,i,s,o){return!o||t.IsPlayMusicAsSound()?new self.C3WebAudioBuffer(t,e,i,s,o):new self.C3Html5AudioBuffer(t,e,i,s,o)}CreateInstance(t){return"html5"===this._api?new self.C3Html5AudioInstance(this._audioDomHandler,this,t):new self.C3WebAudioInstance(this._audioDomHandler,this,t)}_Load(){}Load(){return this._loadPromise||(this._loadPromise=this._Load()),this._loadPromise}IsLoaded(){}IsLoadedAndDecoded(){}HasFailedToLoad(){return"failed"===this._loadState}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetApi(){return this._api}GetOriginalUrl(){return this._originalUrl}GetUrl(){return this._url}GetContentType(){return this._type}IsMusic(){return this._isMusic}GetDuration(){}};

// scripts/plugins/Audio/dom/html5AudioBuffer.js
"use strict";self.C3Html5AudioBuffer=class extends self.C3AudioBuffer{constructor(e,t,o,i,d){super(e,t,o,i,d),this._api="html5",this._audioElem=new Audio,this._audioElem.crossOrigin="anonymous",this._audioElem.autoplay=!1,this._audioElem.preload="auto",this._loadResolve=null,this._loadReject=null,this._reachedCanPlayThrough=!1,this._audioElem.addEventListener("canplaythrough",()=>this._reachedCanPlayThrough=!0),this._outNode=this.GetAudioContext()["createGain"](),this._mediaSourceNode=null,this._audioElem.addEventListener("canplay",()=>{this._loadResolve&&(this._loadState="loaded",this._loadResolve(),this._loadResolve=null,this._loadReject=null),!this._mediaSourceNode&&this._audioElem&&(this._mediaSourceNode=this.GetAudioContext()["createMediaElementSource"](this._audioElem),this._mediaSourceNode["connect"](this._outNode))}),this.onended=null,this._audioElem.addEventListener("ended",()=>{this.onended&&this.onended()}),this._audioElem.addEventListener("error",e=>this._OnError(e))}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this),this._outNode["disconnect"](),this._outNode=null,this._mediaSourceNode["disconnect"](),this._mediaSourceNode=null,this._audioElem&&!this._audioElem.paused&&this._audioElem.pause(),this.onended=null,this._audioElem=null,super.Release()}_Load(){return this._loadState="loading",new Promise((e,t)=>{this._loadResolve=e,this._loadReject=t,this._audioElem.src=this._url})}_OnError(e){console.error(`[Construct] Audio '${this._url}' error: `,e),this._loadReject&&(this._loadState="failed",this._loadReject(e),this._loadResolve=null,this._loadReject=null)}IsLoaded(){const e=this._audioElem["readyState"]>=4;return e&&(this._reachedCanPlayThrough=!0),e||this._reachedCanPlayThrough}IsLoadedAndDecoded(){return this.IsLoaded()}GetAudioElement(){return this._audioElem}GetOutputNode(){return this._outNode}GetDuration(){return this._audioElem["duration"]}};

// scripts/plugins/Audio/dom/webAudioBuffer.js
"use strict";self.C3WebAudioBuffer=class extends self.C3AudioBuffer{constructor(a,t,e,i,o){super(a,t,e,i,o),this._api="webaudio",this._audioData=null,this._audioBuffer=null}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this),this._audioData=null,this._audioBuffer=null,super.Release()}async _Fetch(){if(this._audioData)return this._audioData;const a=this._audioDomHandler.GetRuntimeInterface();if("cordova"===a.GetExportType()&&a.IsRelativeURL(this._url)&&a.IsFileProtocol())this._audioData=await a.CordovaFetchLocalFileAsArrayBuffer(this._url);else if("playable-ad-single-file"===a.GetExportType()&&a.IsRelativeURL(this._url)){const t=a["_PlayableAdFetchBlob"](this._url);this._audioData=await t.arrayBuffer()}else{const a=await fetch(this._url);if(!a.ok)throw new Error(`error fetching audio data: ${a.status} ${a.statusText}`);this._audioData=await a.arrayBuffer()}}async _Decode(){if(this._audioBuffer)return this._audioBuffer;const a=this._audioDomHandler.GetAudioContext();this._audioBuffer=await a["decodeAudioData"](this._audioData),this._audioData=null}async _Load(){try{if(this._loadState="loading",await this._Fetch(),this.WasReleased())return;await this._Decode(),this._loadState="loaded"}catch(a){this._loadState="failed",console.error(`[Construct] Failed to load audio '${this._url}': `,a)}}IsLoaded(){return!(!this._audioData&&!this._audioBuffer)}IsLoadedAndDecoded(){return!!this._audioBuffer}GetAudioBuffer(){return this._audioBuffer}GetDuration(){return this._audioBuffer?this._audioBuffer["duration"]:0}};

// scripts/plugins/Audio/dom/audioInstance.js
"use strict";{let e=0;self.C3AudioInstance=class{constructor(t,n,i){this._audioDomHandler=t,this._buffer=n,this._tags=i,this._lastEffectTag=this.GetEffectTag(),this._aiId=e++,this._gainNode=this.GetAudioContext()["createGain"](),this._gainNode["connect"](this.GetDestinationNode()),this._pannerNode=null,this._isPannerEnabled=!1,this._pannerPosition=[0,0,0],this._pannerOrientation=[0,0,0],this._pannerConeParams=[0,0,0],this._stereoPannerNode=null,this._isStereoPannerEnabled=!1,this._stereoPan=0,this._isStopped=!0,this._isPaused=!1,this._resumeMe=!1,this._isLooping=!1,this._volume=1,this._isMuted=!1,this._playbackRate=1;const s=this._audioDomHandler.GetTimeScaleMode();this._isTimescaled=1===s&&!this.IsMusic()||2===s,this._instUid=-1,this._fadeEndTime=-1,this._stopOnFadeEnd=!1}Release(){this._audioDomHandler=null,this._buffer=null,this._pannerNode&&(this._pannerNode["disconnect"](),this._pannerNode=null),this._stereoPannerNode&&(this._stereoPannerNode["disconnect"](),this._stereoPannerNode=null),this._gainNode["disconnect"](),this._gainNode=null}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}SetTags(e){this._tags=e;const t=this.GetEffectTag();this._lastEffectTag!==t&&(this._lastEffectTag=t,this.Reconnect(this.GetDestinationNode()))}GetTags(){return this._tags}GetEffectTag(){return this._tags.length>0?this._tags[0]:""}GetDestinationNode(){return this._audioDomHandler.GetDestinationForTag(this.GetEffectTag())}GetCurrentTime(){return this._isTimescaled?this._audioDomHandler.GetGameTime():performance.now()/1e3}GetOriginalUrl(){return this._buffer.GetOriginalUrl()}GetUrl(){return this._buffer.GetUrl()}GetContentType(){return this._buffer.GetContentType()}GetBuffer(){return this._buffer}IsMusic(){return this._buffer.IsMusic()}GetAiId(){return this._aiId}HasEnded(){}CanBeRecycled(){}IsPlaying(){return!this._isStopped&&!this._isPaused&&!this.HasEnded()}IsActive(){return!this._isStopped&&!this.HasEnded()}GetPlaybackTime(){}GetDuration(e){let t=this._buffer.GetDuration();return e&&(t/=this._playbackRate||.001),t}Play(e,t,n,i){}Stop(){}Pause(){}IsPaused(){return this._isPaused}Resume(){}SetVolume(e){this._volume=e,this._gainNode["gain"]["cancelScheduledValues"](0),this._fadeEndTime=-1,this._gainNode["gain"]["value"]=this.GetOutputVolume()}FadeVolume(e,t,n){if(this.IsMuted())return;const i=this._gainNode["gain"];i["cancelScheduledValues"](0);const s=this._audioDomHandler.GetAudioCurrentTime(),a=s+t;i["setValueAtTime"](i["value"],s),i["linearRampToValueAtTime"](e,a),this._volume=e,this._fadeEndTime=a,this._stopOnFadeEnd=n}_UpdateVolume(){this.SetVolume(this._volume)}Tick(e){-1!==this._fadeEndTime&&e>=this._fadeEndTime&&(this._fadeEndTime=-1,this._stopOnFadeEnd&&this.Stop(),this._audioDomHandler.PostTrigger("fade-ended",this._tags,this._aiId))}GetOutputVolume(){const e=this._volume;return isFinite(e)?e:0}SetMuted(e){e=!!e,this._isMuted!==e&&(this._isMuted=e,this._UpdateMuted())}IsMuted(){return this._isMuted}IsSilent(){return this._audioDomHandler.IsSilent()}_UpdateMuted(){}SetLooping(e){}IsLooping(){return this._isLooping}SetPlaybackRate(e){this._playbackRate!==e&&(this._playbackRate=e,this._UpdatePlaybackRate())}_UpdatePlaybackRate(){}GetPlaybackRate(){return this._playbackRate}Seek(e){}SetSuspended(e){}SetPannerEnabled(e){e=!!e,this._isPannerEnabled!==e&&(this._isPannerEnabled=e,this._isPannerEnabled?(this.SetStereoPannerEnabled(!1),this._pannerNode||(this._pannerNode=this.GetAudioContext()["createPanner"](),this._pannerNode["panningModel"]=this._audioDomHandler.GetPanningModel(),this._pannerNode["distanceModel"]=this._audioDomHandler.GetDistanceModel(),this._pannerNode["refDistance"]=this._audioDomHandler.GetReferenceDistance(),this._pannerNode["maxDistance"]=this._audioDomHandler.GetMaxDistance(),this._pannerNode["rolloffFactor"]=this._audioDomHandler.GetRolloffFactor()),this._gainNode["disconnect"](),this._gainNode["connect"](this._pannerNode),this._pannerNode["connect"](this.GetDestinationNode())):(this._pannerNode["disconnect"](),this._gainNode["disconnect"](),this._gainNode["connect"](this.GetDestinationNode())))}SetPan(e,t,n,i,s,a,o){if(!this._isPannerEnabled)return;this.SetPanXYZA(e,t,n,i);const r=self.AudioDOMHandler.ToDegrees;this._pannerConeParams[0]!==r(s)&&(this._pannerConeParams[0]=r(s),this._pannerNode["coneInnerAngle"]=r(s)),this._pannerConeParams[1]!==r(a)&&(this._pannerConeParams[1]=r(a),this._pannerNode["coneOuterAngle"]=r(a)),this._pannerConeParams[2]!==o&&(this._pannerConeParams[2]=o,this._pannerNode["coneOuterGain"]=o)}SetPanXYZA(e,t,n,i){if(!this._isPannerEnabled)return;const s=this._pannerPosition,a=this._pannerOrientation,o=Math.cos(i),r=Math.sin(i);s[0]===e&&s[1]===t&&s[2]===n||(s[0]=e,s[1]=t,s[2]=n,this._pannerNode["setPosition"](...s)),a[0]===o&&a[1]===r&&0===a[2]||(a[0]=o,a[1]=r,a[2]=0,this._pannerNode["setOrientation"](...a))}SetStereoPannerEnabled(e){e=!!e,this._isStereoPannerEnabled!==e&&(this._isStereoPannerEnabled=e,this._isStereoPannerEnabled?(this.SetPannerEnabled(!1),this._stereoPannerNode=this.GetAudioContext()["createStereoPanner"](),this._gainNode["disconnect"](),this._gainNode["connect"](this._stereoPannerNode),this._stereoPannerNode["connect"](this.GetDestinationNode())):(this._stereoPannerNode["disconnect"](),this._stereoPannerNode=null,this._gainNode["disconnect"](),this._gainNode["connect"](this.GetDestinationNode())))}SetStereoPan(e){this._isStereoPannerEnabled&&this._stereoPan!==e&&(this._stereoPannerNode["pan"]["value"]=e,this._stereoPan=e)}SetUID(e){this._instUid=e}GetUID(){return this._instUid}GetResumePosition(){}Reconnect(e){const t=this._stereoPannerNode||this._pannerNode||this._gainNode;t["disconnect"](),t["connect"](e)}GetState(){return{"aiid":this.GetAiId(),"tags":this._tags,"duration":this.GetDuration(),"volume":-1===this._fadeEndTime?this._volume:this._gainNode["gain"]["value"],"isPlaying":this.IsPlaying(),"playbackTime":this.GetPlaybackTime(),"playbackRate":this.GetPlaybackRate(),"uid":this._instUid,"bufferOriginalUrl":this.GetOriginalUrl(),"bufferUrl":"","bufferType":this.GetContentType(),"isMusic":this.IsMusic(),"isLooping":this.IsLooping(),"isMuted":this.IsMuted(),"resumePosition":this.GetResumePosition(),"pan":this.GetPanState(),"stereoPan":this.GetStereoPanState()}}_LoadAdditionalState(e){this.SetPlaybackRate(e["playbackRate"]),this.SetMuted(e["isMuted"])}GetPanState(){if(!this._pannerNode)return null;const e=this._pannerNode;return{"pos":this._pannerPosition,"orient":this._pannerOrientation,"cia":e["coneInnerAngle"],"coa":e["coneOuterAngle"],"cog":e["coneOuterGain"],"uid":this._instUid}}LoadPanState(e){if(!e)return void this.SetPannerEnabled(!1);this.SetPannerEnabled(!0);const t=this._pannerNode,n=e["pos"];this._pannerPosition[0]=n[0],this._pannerPosition[1]=n[1],this._pannerPosition[2]=n[2];const i=e["orient"];this._pannerOrientation[0]=i[0],this._pannerOrientation[1]=i[1],this._pannerOrientation[2]=i[2],t["setPosition"](...this._pannerPosition),t["setOrientation"](...this._pannerOrientation),this._pannerConeParams[0]=e["cia"],this._pannerConeParams[1]=e["coa"],this._pannerConeParams[2]=e["cog"],t["coneInnerAngle"]=e["cia"],t["coneOuterAngle"]=e["coa"],t["coneOuterGain"]=e["cog"],this._instUid=e["uid"]}GetStereoPanState(){return this._stereoPannerNode?this._stereoPan:null}LoadStereoPanState(e){"number"==typeof e?(this.SetStereoPannerEnabled(!0),this.SetStereoPan(e)):this.SetStereoPannerEnabled(!1)}}}

// scripts/plugins/Audio/dom/html5AudioInstance.js
"use strict";self.C3Html5AudioInstance=class extends self.C3AudioInstance{constructor(e,t,i){super(e,t,i),this._buffer.GetOutputNode()["connect"](this._gainNode),this._buffer.onended=()=>this._OnEnded()}Release(){this.Stop(),this._buffer.GetOutputNode()["disconnect"](),super.Release()}GetAudioElement(){return this._buffer.GetAudioElement()}_OnEnded(){this._isStopped=!0,this._instUid=-1,this._audioDomHandler.PostTrigger("ended",this._tags,this._aiId)}HasEnded(){return this.GetAudioElement()["ended"]}CanBeRecycled(){return!!this._isStopped||this.HasEnded()}GetPlaybackTime(){let e=this.GetAudioElement()["currentTime"];return this._isLooping||(e=Math.min(e,this.GetDuration())),e}Play(e,t,i,s){const d=this.GetAudioElement();if(1!==d.playbackRate&&(d.playbackRate=1),d.loop!==e&&(d.loop=e),this.SetVolume(t),this._isMuted=!1,d.muted&&(d.muted=!1),d.currentTime!==i)try{d.currentTime=i}catch(e){console.warn(`[Construct] Exception seeking audio '${this._buffer.GetUrl()}' to position '${i}': `,e)}this._audioDomHandler.TryPlayMedia(d),this._isStopped=!1,this._isPaused=!1,this._isLooping=e,this._playbackRate=1}Stop(){const e=this.GetAudioElement();e.paused||e.pause(),this._audioDomHandler.RemovePendingPlay(e),this._isStopped=!0,this._isPaused=!1,this._instUid=-1}Pause(){if(this._isPaused||this._isStopped||this.HasEnded())return;const e=this.GetAudioElement();e.paused||e.pause(),this._audioDomHandler.RemovePendingPlay(e),this._isPaused=!0}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._isPaused=!1)}_UpdateMuted(){this.GetAudioElement().muted=this._isMuted||this.IsSilent()}SetLooping(e){e=!!e,this._isLooping!==e&&(this._isLooping=e,this.GetAudioElement().loop=e)}_UpdatePlaybackRate(){let e=this._playbackRate;this._isTimescaled&&(e*=this._audioDomHandler.GetTimeScale());try{this.GetAudioElement()["playbackRate"]=e}catch(t){console.warn(`[Construct] Unable to set playback rate '${e}':`,t)}}Seek(e){if(!this._isStopped&&!this.HasEnded())try{this.GetAudioElement()["currentTime"]=e}catch(t){console.warn(`[Construct] Error seeking audio to '${e}': `,t)}}GetResumePosition(){return this.GetPlaybackTime()}SetSuspended(e){e?this.IsPlaying()?(this.GetAudioElement()["pause"](),this._resumeMe=!0):this._resumeMe=!1:this._resumeMe&&(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._resumeMe=!1)}};

// scripts/plugins/Audio/dom/webAudioInstance.js
"use strict";self.C3WebAudioInstance=class extends self.C3AudioInstance{constructor(e,t,s){super(e,t,s),this._bufferSource=null,this._onended_handler=e=>this._OnEnded(e),this._hasPlaybackEnded=!0,this._activeSource=null,this._playStartTime=0,this._playFromSeekPos=0,this._resumePosition=0,this._muteVol=1}Release(){this.Stop(),this._ReleaseBufferSource(),this._onended_handler=null,super.Release()}_ReleaseBufferSource(){this._bufferSource&&(this._bufferSource["onended"]=null,this._bufferSource["disconnect"](),this._bufferSource["buffer"]=null),this._bufferSource=null,this._activeSource=null}_OnEnded(e){this._isPaused||this._resumeMe||e.target===this._activeSource&&(this._hasPlaybackEnded=!0,this._isStopped=!0,this._instUid=-1,this._ReleaseBufferSource(),this._audioDomHandler.PostTrigger("ended",this._tags,this._aiId))}HasEnded(){return!(!this._isStopped&&this._bufferSource&&this._bufferSource["loop"])&&(!this._isPaused&&this._hasPlaybackEnded)}CanBeRecycled(){return!(this._bufferSource&&!this._isStopped)||this.HasEnded()}GetPlaybackTime(){let e=0;return e=this._isPaused?this._resumePosition:this._playFromSeekPos+(this.GetCurrentTime()-this._playStartTime)*this._playbackRate,this._isLooping||(e=Math.min(e,this.GetDuration())),e}Play(e,t,s,i){this._isMuted=!1,this._muteVol=1,this.SetVolume(t),this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext()["createBufferSource"](),this._bufferSource["buffer"]=this._buffer.GetAudioBuffer(),this._bufferSource["connect"](this._gainNode),this._activeSource=this._bufferSource,this._bufferSource["onended"]=this._onended_handler,this._bufferSource["loop"]=e,this._bufferSource["start"](i,s),this._hasPlaybackEnded=!1,this._isStopped=!1,this._isPaused=!1,this._isLooping=e,this._playbackRate=1,this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=s}Stop(){if(this._bufferSource)try{this._bufferSource["stop"](0)}catch(e){}this._isStopped=!0,this._isPaused=!1,this._instUid=-1}Pause(){this._isPaused||this._isStopped||this.HasEnded()||(this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._isPaused=!0,this._bufferSource["stop"](0))}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext()["createBufferSource"](),this._bufferSource["buffer"]=this._buffer.GetAudioBuffer(),this._bufferSource["connect"](this._gainNode),this._activeSource=this._bufferSource,this._bufferSource["onended"]=this._onended_handler,this._bufferSource["loop"]=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource["start"](0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._isPaused=!1)}GetOutputVolume(){return super.GetOutputVolume()*this._muteVol}_UpdateMuted(){this._muteVol=this._isMuted||this.IsSilent()?0:1,this._UpdateVolume()}SetLooping(e){e=!!e,this._isLooping!==e&&(this._isLooping=e,this._bufferSource&&(this._bufferSource["loop"]=e))}_UpdatePlaybackRate(){let e=this._playbackRate;this._isTimescaled&&(e*=this._audioDomHandler.GetTimeScale()),this._bufferSource&&(this._bufferSource["playbackRate"]["value"]=e)}Seek(e){this._isStopped||this.HasEnded()||(this._isPaused?this._resumePosition=e:(this.Pause(),this._resumePosition=e,this.Resume()))}GetResumePosition(){return this._resumePosition}SetSuspended(e){e?this.IsPlaying()?(this._resumeMe=!0,this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._bufferSource["stop"](0)):this._resumeMe=!1:this._resumeMe&&(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext()["createBufferSource"](),this._bufferSource["buffer"]=this._buffer.GetAudioBuffer(),this._bufferSource["connect"](this._gainNode),this._activeSource=this._bufferSource,this._bufferSource["onended"]=this._onended_handler,this._bufferSource["loop"]=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource["start"](0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._resumeMe=!1)}_LoadAdditionalState(e){super._LoadAdditionalState(e),this._resumePosition=e["resumePosition"]}};

// scripts/plugins/Audio/dom/effects.js
"use strict";{class e{constructor(e){this._audioDomHandler=e,this._audioContext=e.GetAudioContext(),this._index=-1,this._tag="",this._type="",this._params=null}Release(){this._audioContext=null}_SetIndex(e){this._index=e}GetIndex(){return this._index}_SetTag(e){this._tag=e}GetTag(){return this._tag}CreateGain(){return this._audioContext["createGain"]()}GetInputNode(){}ConnectTo(e){}SetAudioParam(e,t,i,s){if(e["cancelScheduledValues"](0),0===s)return void(e["value"]=t);const o=this._audioContext["currentTime"];switch(s+=o,i){case 0:e["setValueAtTime"](t,s);break;case 1:e["setValueAtTime"](e["value"],o),e["linearRampToValueAtTime"](t,s);break;case 2:e["setValueAtTime"](e["value"],o),e["exponentialRampToValueAtTime"](t,s)}}GetState(){return{"type":this._type,"tag":this._tag,"params":this._params}}}self.C3AudioFilterFX=class extends e{constructor(e,t,i,s,o,a,n){super(e),this._type="filter",this._params=[t,i,s,o,a,n],this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=n,this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-n,this._filterNode=this._audioContext["createBiquadFilter"](),this._filterNode["type"]=t,this._filterNode["frequency"]["value"]=i,this._filterNode["detune"]["value"]=s,this._filterNode["Q"]["value"]=o,this._filterNode["gain"]["vlaue"]=a,this._inputNode["connect"](this._filterNode),this._inputNode["connect"](this._dryNode),this._filterNode["connect"](this._wetNode)}Release(){this._inputNode["disconnect"](),this._filterNode["disconnect"](),this._wetNode["disconnect"](),this._dryNode["disconnect"](),super.Release()}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){switch(e){case 0:t=Math.max(Math.min(t/100,1),0),this._params[5]=t,this.SetAudioParam(this._wetNode["gain"],t,i,s),this.SetAudioParam(this._dryNode["gain"],1-t,i,s);break;case 1:this._params[1]=t,this.SetAudioParam(this._filterNode["frequency"],t,i,s);break;case 2:this._params[2]=t,this.SetAudioParam(this._filterNode["detune"],t,i,s);break;case 3:this._params[3]=t,this.SetAudioParam(this._filterNode["Q"],t,i,s);break;case 4:this._params[4]=t,this.SetAudioParam(this._filterNode["gain"],t,i,s)}}},self.C3AudioDelayFX=class extends e{constructor(e,t,i,s){super(e),this._type="delay",this._params=[t,i,s],this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=s,this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-s,this._mainNode=this.CreateGain(),this._delayNode=this._audioContext["createDelay"](t),this._delayNode["delayTime"]["value"]=t,this._delayGainNode=this.CreateGain(),this._delayGainNode["gain"]["value"]=i,this._inputNode["connect"](this._mainNode),this._inputNode["connect"](this._dryNode),this._mainNode["connect"](this._wetNode),this._mainNode["connect"](this._delayNode),this._delayNode["connect"](this._delayGainNode),this._delayGainNode["connect"](this._mainNode)}Release(){this._inputNode["disconnect"](),this._wetNode["disconnect"](),this._dryNode["disconnect"](),this._mainNode["disconnect"](),this._delayNode["disconnect"](),this._delayGainNode["disconnect"](),super.Release()}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){const o=self.AudioDOMHandler.DbToLinear;switch(e){case 0:t=Math.max(Math.min(t/100,1),0),this._params[2]=t,this.SetAudioParam(this._wetNode["gain"],t,i,s),this.SetAudioParam(this._dryNode["gain"],1-t,i,s);break;case 4:this._params[1]=o(t),this.SetAudioParam(this._delayGainNode["gain"],o(t),i,s);break;case 5:this._params[0]=t,this.SetAudioParam(this._delayNode["delayTime"],t,i,s)}}},self.C3AudioConvolveFX=class extends e{constructor(e,t,i,s){super(e),this._type="convolution",this._params=[i,s],this._bufferOriginalUrl="",this._bufferUrl="",this._bufferType="",this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=s,this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-s,this._convolveNode=this._audioContext["createConvolver"](),this._convolveNode["normalize"]=i,this._convolveNode["buffer"]=t,this._inputNode["connect"](this._convolveNode),this._inputNode["connect"](this._dryNode),this._convolveNode["connect"](this._wetNode)}Release(){this._inputNode["disconnect"](),this._convolveNode["disconnect"](),this._wetNode["disconnect"](),this._dryNode["disconnect"](),super.Release()}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){if(0===e)t=Math.max(Math.min(t/100,1),0),this._params[1]=t,this.SetAudioParam(this._wetNode["gain"],t,i,s),this.SetAudioParam(this._dryNode["gain"],1-t,i,s)}_SetBufferInfo(e,t,i){this._bufferOriginalUrl=e,this._bufferUrl=t,this._bufferType=i}GetState(){const e=super.GetState();return e["bufferOriginalUrl"]=this._bufferOriginalUrl,e["bufferUrl"]="",e["bufferType"]=this._bufferType,e}},self.C3AudioFlangerFX=class extends e{constructor(e,t,i,s,o,a){super(e),this._type="flanger",this._params=[t,i,s,o,a],this._inputNode=this.CreateGain(),this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-a/2,this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=a/2,this._feedbackNode=this.CreateGain(),this._feedbackNode["gain"]["value"]=o,this._delayNode=this._audioContext["createDelay"](t+i),this._delayNode["delayTime"]["value"]=t,this._oscNode=this._audioContext["createOscillator"](),this._oscNode["frequency"]["value"]=s,this._oscGainNode=this.CreateGain(),this._oscGainNode["gain"]["value"]=i,this._inputNode["connect"](this._delayNode),this._inputNode["connect"](this._dryNode),this._delayNode["connect"](this._wetNode),this._delayNode["connect"](this._feedbackNode),this._feedbackNode["connect"](this._delayNode),this._oscNode["connect"](this._oscGainNode),this._oscGainNode["connect"](this._delayNode["delayTime"]),this._oscNode["start"](0)}Release(){this._oscNode["stop"](0),this._inputNode["disconnect"](),this._delayNode["disconnect"](),this._oscNode["disconnect"](),this._oscGainNode["disconnect"](),this._dryNode["disconnect"](),this._wetNode["disconnect"](),this._feedbackNode["disconnect"](),super.Release()}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){switch(e){case 0:t=Math.max(Math.min(t/100,1),0),this._params[4]=t,this.SetAudioParam(this._wetNode["gain"],t/2,i,s),this.SetAudioParam(this._dryNode["gain"],1-t/2,i,s);break;case 6:this._params[1]=t/1e3,this.SetAudioParam(this._oscGainNode["gain"],t/1e3,i,s);break;case 7:this._params[2]=t,this.SetAudioParam(this._oscNode["frequency"],t,i,s);break;case 8:this._params[3]=t/100,this.SetAudioParam(this._feedbackNode["gain"],t/100,i,s)}}},self.C3AudioPhaserFX=class extends e{constructor(e,t,i,s,o,a,n){super(e),this._type="phaser",this._params=[t,i,s,o,a,n],this._inputNode=this.CreateGain(),this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-n/2,this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=n/2,this._filterNode=this._audioContext["createBiquadFilter"](),this._filterNode["type"]="allpass",this._filterNode["frequency"]["value"]=t,this._filterNode["detune"]["value"]=i,this._filterNode["Q"]["value"]=s,this._oscNode=this._audioContext["createOscillator"](),this._oscNode["frequency"]["value"]=a,this._oscGainNode=this.CreateGain(),this._oscGainNode["gain"]["value"]=o,this._inputNode["connect"](this._filterNode),this._inputNode["connect"](this._dryNode),this._filterNode["connect"](this._wetNode),this._oscNode["connect"](this._oscGainNode),this._oscGainNode["connect"](this._filterNode["frequency"]),this._oscNode["start"](0)}Release(){this._oscNode["stop"](0),this._inputNode["disconnect"](),this._filterNode["disconnect"](),this._oscNode["disconnect"](),this._oscGainNode["disconnect"](),this._dryNode["disconnect"](),this._wetNode["disconnect"](),super.Release()}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){switch(e){case 0:t=Math.max(Math.min(t/100,1),0),this._params[5]=t,this.SetAudioParam(this._wetNode["gain"],t/2,i,s),this.SetAudioParam(this._dryNode["gain"],1-t/2,i,s);break;case 1:this._params[0]=t,this.SetAudioParam(this._filterNode["frequency"],t,i,s);break;case 2:this._params[1]=t,this.SetAudioParam(this._filterNode["detune"],t,i,s);break;case 3:this._params[2]=t,this.SetAudioParam(this._filterNode["Q"],t,i,s);break;case 6:this._params[3]=t,this.SetAudioParam(this._oscGainNode["gain"],t,i,s);break;case 7:this._params[4]=t,this.SetAudioParam(this._oscNode["frequency"],t,i,s)}}},self.C3AudioGainFX=class extends e{constructor(e,t){super(e),this._type="gain",this._params=[t],this._node=this.CreateGain(),this._node["gain"]["value"]=t}Release(){this._node["disconnect"](),super.Release()}ConnectTo(e){this._node["disconnect"](),this._node["connect"](e)}GetInputNode(){return this._node}SetParam(e,t,i,s){const o=self.AudioDOMHandler.DbToLinear;if(4===e)this._params[0]=o(t),this.SetAudioParam(this._node["gain"],o(t),i,s)}},self.C3AudioStereoPanFX=class extends e{constructor(e,t){super(e),this._type="stereopan",this._params=[t],this._node=this._audioContext["createStereoPanner"](),this._node["pan"]["value"]=t}Release(){this._node["disconnect"](),super.Release()}ConnectTo(e){this._node["disconnect"](),this._node["connect"](e)}GetInputNode(){return this._node}SetParam(e,t,i,s){if(t=Math.min(Math.max(t/100,-1),1),9===e)this._params[0]=t,this.SetAudioParam(this._node["pan"],t,i,s)}},self.C3AudioTremoloFX=class extends e{constructor(e,t,i){super(e),this._type="tremolo",this._params=[t,i],this._node=this.CreateGain(),this._node["gain"]["value"]=1-i/2,this._oscNode=this._audioContext["createOscillator"](),this._oscNode["frequency"]["value"]=t,this._oscGainNode=this.CreateGain(),this._oscGainNode["gain"]["value"]=i/2,this._oscNode["connect"](this._oscGainNode),this._oscGainNode["connect"](this._node["gain"]),this._oscNode["start"](0)}Release(){this._oscNode["stop"](0),this._oscNode["disconnect"](),this._oscGainNode["disconnect"](),this._node["disconnect"](),super.Release()}ConnectTo(e){this._node["disconnect"](),this._node["connect"](e)}GetInputNode(){return this._node}SetParam(e,t,i,s){switch(e){case 0:t=Math.max(Math.min(t/100,1),0),this._params[1]=t,this.SetAudioParam(this._node["gain"],1-t/2,i,s),this.SetAudioParam(this._oscGainNode["gain"],t/2,i,s);break;case 7:this._params[0]=t,this.SetAudioParam(this._oscNode["frequency"],t,i,s)}}},self.C3AudioRingModFX=class extends e{constructor(e,t,i){super(e),this._type="ringmod",this._params=[t,i],this._inputNode=this.CreateGain(),this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=i,this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-i,this._ringNode=this.CreateGain(),this._ringNode["gain"]["value"]=0,this._oscNode=this._audioContext["createOscillator"](),this._oscNode["frequency"]["value"]=t,this._oscNode["connect"](this._ringNode["gain"]),this._oscNode["start"](0),this._inputNode["connect"](this._ringNode),this._inputNode["connect"](this._dryNode),this._ringNode["connect"](this._wetNode)}Release(){this._oscNode["stop"](0),this._oscNode["disconnect"](),this._ringNode["disconnect"](),this._inputNode["disconnect"](),this._wetNode["disconnect"](),this._dryNode["disconnect"](),super.Release()}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){switch(e){case 0:t=Math.max(Math.min(t/100,1),0),this._params[1]=t,this.SetAudioParam(this._wetNode["gain"],t,i,s),this.SetAudioParam(this._dryNode["gain"],1-t,i,s);break;case 7:this._params[0]=t,this.SetAudioParam(this._oscNode["frequency"],t,i,s)}}},self.C3AudioDistortionFX=class extends e{constructor(e,t,i,s,o,a){super(e),this._type="distortion",this._params=[t,i,s,o,a],this._inputNode=this.CreateGain(),this._preGain=this.CreateGain(),this._postGain=this.CreateGain(),this._SetDrive(s,o),this._wetNode=this.CreateGain(),this._wetNode["gain"]["value"]=a,this._dryNode=this.CreateGain(),this._dryNode["gain"]["value"]=1-a,this._waveShaper=this._audioContext["createWaveShaper"](),this._curve=new Float32Array(65536),this._GenerateColortouchCurve(t,i),this._waveShaper.curve=this._curve,this._inputNode["connect"](this._preGain),this._inputNode["connect"](this._dryNode),this._preGain["connect"](this._waveShaper),this._waveShaper["connect"](this._postGain),this._postGain["connect"](this._wetNode)}Release(){this._inputNode["disconnect"](),this._preGain["disconnect"](),this._waveShaper["disconnect"](),this._postGain["disconnect"](),this._wetNode["disconnect"](),this._dryNode["disconnect"](),super.Release()}_SetDrive(e,t){e<.01&&(e=.01),this._preGain["gain"]["value"]=e,this._postGain["gain"]["value"]=Math.pow(1/e,.6)*t}_GenerateColortouchCurve(e,t){const i=32768;for(let s=0;s<i;++s){let o=s/i;o=this._Shape(o,e,t),this._curve[i+s]=o,this._curve[i-s-1]=-o}}_Shape(e,t,i){const s=1.05*i*t-t,o=e<0?-1:1,a=e<0?-e:e;let n=a<t?a:t+s*self.AudioDOMHandler.e4(a-t,1/s);return n*=o,n}ConnectTo(e){this._wetNode["disconnect"](),this._wetNode["connect"](e),this._dryNode["disconnect"](),this._dryNode["connect"](e)}GetInputNode(){return this._inputNode}SetParam(e,t,i,s){if(0===e)t=Math.max(Math.min(t/100,1),0),this._params[4]=t,this.SetAudioParam(this._wetNode["gain"],t,i,s),this.SetAudioParam(this._dryNode["gain"],1-t,i,s)}},self.C3AudioCompressorFX=class extends e{constructor(e,t,i,s,o,a){super(e),this._type="compressor",this._params=[t,i,s,o,a],this._node=this._audioContext["createDynamicsCompressor"](),this._node["threshold"]["value"]=t,this._node["knee"]["value"]=i,this._node["ratio"]["value"]=s,this._node["attack"]["value"]=o,this._node["release"]["value"]=a}Release(){this._node["disconnect"](),super.Release()}ConnectTo(e){this._node["disconnect"](),this._node["connect"](e)}GetInputNode(){return this._node}SetParam(e,t,i,s){}},self.C3AudioAnalyserFX=class extends e{constructor(e,t,i){super(e),this._type="analyser",this._params=[t,i],this._node=this._audioContext["createAnalyser"](),this._node["fftSize"]=t,this._node["smoothingTimeConstant"]=i,this._freqBins=new Float32Array(this._node["frequencyBinCount"]),this._signal=new Uint8Array(t),this._peak=0,this._rms=0,this._audioDomHandler._AddAnalyser(this)}Release(){this._audioDomHandler._RemoveAnalyser(this),this._node["disconnect"](),super.Release()}Tick(){this._node["getFloatFrequencyData"](this._freqBins),this._node["getByteTimeDomainData"](this._signal);const e=this._node["fftSize"];this._peak=0;let t=0;for(let i=0;i<e;++i){let e=(this._signal[i]-128)/128;e<0&&(e=-e),this._peak<e&&(this._peak=e),t+=e*e}const i=self.AudioDOMHandler.LinearToDb;this._peak=i(this._peak),this._rms=i(Math.sqrt(t/e))}ConnectTo(e){this._node["disconnect"](),this._node["connect"](e)}GetInputNode(){return this._node}SetParam(e,t,i,s){}GetData(){return{"tag":this.GetTag(),"index":this.GetIndex(),"peak":this._peak,"rms":this._rms,"binCount":this._node["frequencyBinCount"],"freqBins":this._freqBins}}}}

// scripts/plugins/Touch/dom/domSide.js
"use strict";{const e="touch",t=class extends self.DOMHandler{constructor(t){super(t,e),this.AddRuntimeMessageHandler("request-permission",e=>this._OnRequestPermission(e))}async _OnRequestPermission(e){const t=e["type"];let s=!0;0===t?s=await this._RequestOrientationPermission():1===t&&(s=await this._RequestMotionPermission()),this.PostToRuntime("permission-result",{"type":t,"result":s})}async _RequestOrientationPermission(){if(!self["DeviceOrientationEvent"]||!self["DeviceOrientationEvent"]["requestPermission"])return!0;try{return"granted"===await self["DeviceOrientationEvent"]["requestPermission"]()}catch(e){return console.warn("[Touch] Failed to request orientation permission: ",e),!1}}async _RequestMotionPermission(){if(!self["DeviceMotionEvent"]||!self["DeviceMotionEvent"]["requestPermission"])return!0;try{return"granted"===await self["DeviceMotionEvent"]["requestPermission"]()}catch(e){return console.warn("[Touch] Failed to request motion permission: ",e),!1}}};self.RuntimeInterface.AddDOMHandlerClass(t)}

// scripts/plugins/PlatformInfo/dom/domSide.js
"use strict";{const e="platform-info";function t(e){return new Promise((t,s)=>{e["getInsetTop"](t,s)})}function s(e){return new Promise((t,s)=>{e["getInsetRight"](t,s)})}function r(e){return new Promise((t,s)=>{e["getInsetBottom"](t,s)})}function n(e){return new Promise((t,s)=>{e["getInsetLeft"](t,s)})}const o=class extends self.DOMHandler{constructor(t){super(t,e),this.AddRuntimeMessageHandlers([["get-initial-state",()=>this._OnGetInitialState()],["request-wake-lock",()=>this._OnRequestWakeLock()],["release-wake-lock",()=>this._OnReleaseWakeLock()]]),window.addEventListener("resize",()=>this._OnResize()),this._screenWakeLock=null}async _OnGetInitialState(){const e=await this._GetSafeAreaInset();return{"screenWidth":screen.width,"screenHeight":screen.height,"windowOuterWidth":window.outerWidth,"windowOuterHeight":window.outerHeight,"safeAreaInset":e,"supportsWakeLock":!!navigator["wakeLock"]}}async _GetSafeAreaInset(){const e=self["AndroidNotch"];if(!e){const e=document.body,t=e.style;t.setProperty("--temp-sai-top","env(safe-area-inset-top)"),t.setProperty("--temp-sai-right","env(safe-area-inset-right)"),t.setProperty("--temp-sai-bottom","env(safe-area-inset-bottom)"),t.setProperty("--temp-sai-left","env(safe-area-inset-left)");const s=getComputedStyle(e),r=[s.getPropertyValue("--temp-sai-top"),s.getPropertyValue("--temp-sai-right"),s.getPropertyValue("--temp-sai-bottom"),s.getPropertyValue("--temp-sai-left")].map(e=>{const t=parseInt(e,10);return isFinite(t)?t:0});return t.removeProperty("--temp-sai-top"),t.removeProperty("--temp-sai-right"),t.removeProperty("--temp-sai-bottom"),t.removeProperty("--temp-sai-left"),r}try{return await Promise.all([t(e),s(e),r(e),n(e)])}catch(e){return console.error("[Construct] Failed to get Android safe area inset: ",e),[0,0,0,0]}}async _OnResize(){const e=await this._GetSafeAreaInset();this.PostToRuntime("window-resize",{"windowOuterWidth":window.outerWidth,"windowOuterHeight":window.outerHeight,"safeAreaInset":e})}async _OnRequestWakeLock(){if(!this._screenWakeLock)try{this._screenWakeLock=await navigator["wakeLock"]["request"]("screen"),this._screenWakeLock.addEventListener("release",()=>this._OnWakeLockReleased()),console.log("[Construct] Screen wake lock acquired"),this.PostToRuntime("wake-lock-acquired")}catch(e){console.warn("[Construct] Failed to acquire screen wake lock: ",e),this.PostToRuntime("wake-lock-error")}}_OnReleaseWakeLock(){this._screenWakeLock&&(this._screenWakeLock["release"](),this._screenWakeLock=null)}_OnWakeLockReleased(){console.log("[Construct] Screen wake lock released"),this._screenWakeLock=null,this.PostToRuntime("wake-lock-released")}};self.RuntimeInterface.AddDOMHandlerClass(o)}

// scripts/plugins/Browser/dom/domSide.js
"use strict";{let e=null,t=null;function n(e,t){if(e){if(t)return Array.from(document.querySelectorAll(e));{const t=document.querySelector(e);return t?[t]:[]}}return[document.documentElement]}function o(){}window.addEventListener("beforeinstallprompt",n=>(n.preventDefault(),e=n,t&&t._OnBeforeInstallPrompt(),!1));const i="browser",s=class extends self.DOMHandler{constructor(e){super(e,i),this._exportType="",this.AddRuntimeMessageHandlers([["get-initial-state",e=>this._OnGetInitialState(e)],["ready-for-sw-messages",()=>this._OnReadyForSWMessages()],["alert",e=>this._OnAlert(e)],["close",()=>this._OnClose()],["set-focus",e=>this._OnSetFocus(e)],["vibrate",e=>this._OnVibrate(e)],["lock-orientation",e=>this._OnLockOrientation(e)],["unlock-orientation",()=>this._OnUnlockOrientation()],["navigate",e=>this._OnNavigate(e)],["request-fullscreen",e=>this._OnRequestFullscreen(e)],["exit-fullscreen",()=>this._OnExitFullscreen()],["set-hash",e=>this._OnSetHash(e)],["set-document-css-style",e=>this._OnSetDocumentCSSStyle(e)],["get-document-css-style",e=>this._OnGetDocumentCSSStyle(e)],["set-window-size",e=>this._OnSetWindowSize(e)],["set-window-position",e=>this._OnSetWindowPosition(e)],["request-install",()=>this._OnRequestInstall()],["set-warn-on-close",e=>this._OnSetWarnOnClose(e)]]),window.addEventListener("online",()=>this._OnOnlineStateChanged(!0)),window.addEventListener("offline",()=>this._OnOnlineStateChanged(!1)),window.addEventListener("hashchange",()=>this._OnHashChange()),this._beforeunload_handler=e=>e.preventDefault(),document.addEventListener("backbutton",()=>this._OnCordovaBackButton())}Attach(){e?this._OnBeforeInstallPrompt():t=this,window.addEventListener("appinstalled",()=>this._OnAppInstalled())}_OnGetInitialState(e){return this._exportType=e["exportType"],{"location":location.toString(),"isOnline":!!navigator.onLine,"referrer":document.referrer,"title":document.title,"isCookieEnabled":!!navigator.cookieEnabled,"screenWidth":screen.width,"screenHeight":screen.height,"windowOuterWidth":window.outerWidth,"windowOuterHeight":window.outerHeight,"isConstructArcade":void 0!==window["is_scirra_arcade"],"windowHasFocus":document.hasFocus()}}_OnReadyForSWMessages(){window["C3_RegisterSW"]&&window["OfflineClientInfo"]&&window["OfflineClientInfo"]["SetMessageCallback"](e=>this.PostToRuntime("sw-message",e["data"]))}_OnBeforeInstallPrompt(){this.PostToRuntime("install-available")}async _OnRequestInstall(){if(!e)return{"result":"unavailable"};try{e["prompt"]();return{"result":(await e["userChoice"])["outcome"]}}catch(e){return console.error("[Construct] Requesting install failed: ",e),{"result":"failed"}}}_OnAppInstalled(){this.PostToRuntime("app-installed")}_OnOnlineStateChanged(e){this.PostToRuntime("online-state",{"isOnline":e})}_OnCordovaBackButton(){this.PostToRuntime("backbutton")}GetNWjsWindow(){return"nwjs"===this._exportType?nw["Window"]["get"]():null}_OnAlert(e){alert(e["message"])}_OnClose(){navigator["app"]&&navigator["app"]["exitApp"]?navigator["app"]["exitApp"]():navigator["device"]&&navigator["device"]["exitApp"]?navigator["device"]["exitApp"]():self["nw"]?self["nw"]["App"]["quit"]():window.close()}_OnSetFocus(e){const t=e["isFocus"];if("nwjs"===this._exportType){const e=this.GetNWjsWindow();t?e["focus"]():e["blur"]()}else t?window.focus():window.blur()}_OnVibrate(e){navigator["vibrate"]&&navigator["vibrate"](e["pattern"])}_OnLockOrientation(e){const t=e["orientation"];if(screen["orientation"]&&screen["orientation"]["lock"])screen["orientation"]["lock"](t).catch(e=>console.warn("[Construct] Failed to lock orientation: ",e));else try{let e=!1;screen["lockOrientation"]?e=screen["lockOrientation"](t):screen["webkitLockOrientation"]?e=screen["webkitLockOrientation"](t):screen["mozLockOrientation"]?e=screen["mozLockOrientation"](t):screen["msLockOrientation"]&&(e=screen["msLockOrientation"](t)),e||console.warn("[Construct] Failed to lock orientation")}catch(e){console.warn("[Construct] Failed to lock orientation: ",e)}}_OnUnlockOrientation(){try{screen["orientation"]&&screen["orientation"]["unlock"]?screen["orientation"]["unlock"]():screen["unlockOrientation"]?screen["unlockOrientation"]():screen["webkitUnlockOrientation"]?screen["webkitUnlockOrientation"]():screen["mozUnlockOrientation"]?screen["mozUnlockOrientation"]():screen["msUnlockOrientation"]&&screen["msUnlockOrientation"]()}catch(e){}}_OnNavigate(e){const t=e["type"];if("back"===t)navigator["app"]&&navigator["app"]["backHistory"]?navigator["app"]["backHistory"]():window.history.back();else if("forward"===t)window.history.forward();else if("reload"===t)location.reload();else if("url"===t){const t=e["url"],n=e["target"],o=e["exportType"];self["cordova"]&&self["cordova"]["InAppBrowser"]?self["cordova"]["InAppBrowser"]["open"](t,"_system"):"preview"===o||"macos-wkwebiew"===o||"linux-cef"===o||this._iRuntime.IsAnyWebView2Wrapper()?window.open(t,"_blank"):this._isConstructArcade||(2===n?window.top.location=t:1===n?window.parent.location=t:window.location=t)}else if("new-window"===t){const t=e["url"],n=e["tag"];self["cordova"]&&self["cordova"]["InAppBrowser"]?self["cordova"]["InAppBrowser"]["open"](t,"_system"):window.open(t,n)}}_OnRequestFullscreen(e){if(this._iRuntime.IsAnyWebView2Wrapper()||"macos-wkwebview"===this._exportType||"linux-cef"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!0),this._iRuntime._SendWrapperMessage({"type":"set-fullscreen","fullscreen":!0});else{const t={"navigationUI":"auto"},n=e["navUI"];1===n?t["navigationUI"]="hide":2===n&&(t["navigationUI"]="show");const i=document.documentElement;let s;i["requestFullscreen"]?s=i["requestFullscreen"](t):i["mozRequestFullScreen"]?s=i["mozRequestFullScreen"](t):i["msRequestFullscreen"]?s=i["msRequestFullscreen"](t):i["webkitRequestFullScreen"]&&(s=void 0!==Element["ALLOW_KEYBOARD_INPUT"]?i["webkitRequestFullScreen"](Element["ALLOW_KEYBOARD_INPUT"]):i["webkitRequestFullScreen"]()),s instanceof Promise&&s.catch(o)}}_OnExitFullscreen(){if(this._iRuntime.IsAnyWebView2Wrapper()||"macos-wkwebview"===this._exportType||"linux-cef"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!1),this._iRuntime._SendWrapperMessage({"type":"set-fullscreen","fullscreen":!1});else{let e;document["exitFullscreen"]?e=document["exitFullscreen"]():document["mozCancelFullScreen"]?e=document["mozCancelFullScreen"]():document["msExitFullscreen"]?e=document["msExitFullscreen"]():document["webkitCancelFullScreen"]&&(e=document["webkitCancelFullScreen"]()),e instanceof Promise&&e.catch(o)}}_OnSetHash(e){location.hash=e["hash"]}_OnHashChange(){this.PostToRuntime("hashchange",{"location":location.toString()})}_OnSetDocumentCSSStyle(e){const t=e["prop"],o=e["value"],i=e["selector"],s=e["is-all"];try{const e=n(i,s);for(const n of e)t.startsWith("--")?n.style.setProperty(t,o):n.style[t]=o}catch(e){console.warn("[Browser] Failed to set style: ",e)}}_OnGetDocumentCSSStyle(e){const t=e["prop"],n=e["selector"];try{const e=document.querySelector(n);if(e){return{"isOk":!0,"result":window.getComputedStyle(e).getPropertyValue(t)}}return{"isOk":!1}}catch(e){return console.warn("[Browser] Failed to get style: ",e),{"isOk":!1}}}_OnSetWindowSize(e){window.resizeTo(e["windowWidth"],e["windowHeight"])}_OnSetWindowPosition(e){window.moveTo(e["windowX"],e["windowY"])}_OnSetWarnOnClose(e){e["enabled"]?window.addEventListener("beforeunload",this._beforeunload_handler):window.removeEventListener("beforeunload",this._beforeunload_handler)}};self.RuntimeInterface.AddDOMHandlerClass(s)}

// scripts/plugins/Photon/c3runtime/domSide.js
"use strict";

{
	const RuntimeInterface = self.RuntimeInterface;

	const DOM_COMPONENT_ID = "cv-photon-realtime";

	const HANDLER_CLASS = class Photon_Handler extends self.DOMElementHandler
	{
		constructor(iRuntime)
		{
			super(iRuntime, DOM_COMPONENT_ID);

			this.AddRuntimeMessageHandlers([
				["get-photon-auth-token", e => this._GetPhotonAuthToken(...e)]
			]);

			this.Initialize();
		}

		//////////////////////////////////////
		///// Main Methods
		Initialize()
		{
			const self = this;

			this.GetPhotonAuthToken = (...args) => {
			
				const k = "get-photon-auth-token";
				self.PostToRuntime(k, args);
			}
		}

		//////////////////////////////////////
        ///// DOM Methods
		_GetPhotonAuthToken(data)
		{
			window["PlayFab"]["ClientApi"]["GetPhotonAuthenticationToken"](data, this.GetPhotonAuthToken);
		}

		//////////////////////////////////////
	};
	
	RuntimeInterface.AddDOMHandlerClass(HANDLER_CLASS);
}

// scripts/plugins/progressbar/dom/domSide.js
"use strict";{const e="progress-bar";function t(e){e.stopPropagation()}const s=class extends self.DOMElementHandler{constructor(t){super(t,e)}CreateElement(e,s){const n=document.createElement("progress");return n.style.position="absolute",n.style.userSelect="none",n.style.webkitUserSelect="none",n.addEventListener("pointerdown",t),n.addEventListener("pointerrawupdate",t),n.addEventListener("pointerup",t),n.addEventListener("mousedown",t),n.addEventListener("mouseup",t),n.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",e)),s["id"]&&(n.id=s["id"]),s["className"]&&(n.className=s["className"]),this.UpdateState(n,s),n}UpdateState(e,t){e.title=t["title"];const s=t["value"],n=t["max"];n>0&&s>=0?(e.max=n,e.value=s):(e.removeAttribute("value"),e.removeAttribute("max"))}};self.RuntimeInterface.AddDOMHandlerClass(s)}

// scripts/plugins/advert/dom/utils.js
"use strict";{const t={};let e=null,i=null;const n={"banner":"ca-app-pub-3940256099942544/2934735716","interstitial":"ca-app-pub-3940256099942544/4411468910","rewarded":"ca-app-pub-3940256099942544/1712485313","rewardedInterstitial":"ca-app-pub-3940256099942544/6978759866"},o=5e3;let a=!1;function r(t,e){t(null,e)}function s(t,e){t(e,null)}function u(e,i){t[e]=i,self["admob"]["configRequest"](t)}async function d(t,n){return n=void 0!==n?n:e.debug,i||(i=new Promise((e,i)=>{document.addEventListener("deviceready",async()=>{try{const i=setTimeout(()=>{e(!1),s(t,"failure to initialize")},o);if(await self["admob"]["start"](),clearTimeout(i),n){u("testDeviceIds",[await f()])}e(!0)}catch(i){e(!1),s(t,"Initialization failure")}})}),i)}function c(){return!!e}function l(t,i,n,o,a,r,s){e||(e={id:t,pubID:i,privacyPolicy:n,showFree:o,showConsent:a,debug:r,debugLocation:s},Object.freeze(e))}async function f(){if("android"===self["cordova"]["platformId"])return self.C3AdUtilsMD5(self["device"]["uuid"]).toUpperCase();if("ios"===self["cordova"]["platformId"]){const t=self["cordova"]["plugins"]["idfa"],e=await t["getInfo"]();if(!e["trackingLimited"])return a=!0,self.C3AdUtilsMD5(e["idfa"]).toUpperCase()}}function p(t,i){if("android"===self["cordova"]["platformId"])return t;if("ios"===self["cordova"]["platformId"]){const o=!!n[i];return e.debug&&!a&&o?(console.log("[C3 advert]","USING TEST AD UNITS"),n[i]):t}}self.C3AdUtils={Success:r,Failure:s,StartAdmobPlus:d,UpdateAdmobPlusRequest:u,SetInitConfigureOptions:l,HasInitConfigurationOptions:c,GetAdUnit:p,get ConfigurationOptions(){return e},get TestId(){return f()}}}

// scripts/plugins/advert/dom/bannerWrapper.js
"use strict";{const e=self.C3AdUtils,t=e.Success,s=e.Failure,i=0,a=1,d=2,n=3,o=4,r=5,_={get LOAD(){return self["admob"]["Events"]["adLoad"]},get LOAD_FAIL(){return self["admob"]["Events"]["adLoadFail"]}};class l{constructor(e,t,_,l,h,m){if(!e)return s(m,"Unit ID not specified");if(!t)return s(m,"Ad size not specified");if(!_)return s(m,"Ad position not specified");switch(this._adUnitId=e,this._position=_,this._size="",this._offset=l,this._overlap=!!h,t){case"portrait":case"landscape":default:this._size=r;break;case"standard":this._size=i;break;case"large":this._size=a;break;case"medium":this._size=d;break;case"full":this._size=n;break;case"leaderboard":this._size=o}this._ad=null,this._adLoading=!1,this._adShowing=!1,this._remove_load_listeners=null,this._load_settled_promise=null,this._load_settled_promise_resolver=null}Release(){this._remove_load_listeners&&this._remove_load_listeners(),this._remove_load_listeners=null,this._load_settled_promise=null,this._load_settled_promise_resolver=null,this._ad=null}Load(s,i){if(this._ad)return t(i,"banner ad loaded");h.call(this,i);const a={"adUnitId":e.GetAdUnit(this._adUnitId,"banner"),"size":this._size,"position":this._position,"npa":"NON_PERSONALIZED"===s?"1":"0"};this._overlap&&(a["offset"]=this._offset),this._ad=new self["admob"]["BannerAd"](a),this._load_settled_promise=new Promise(e=>this._load_settled_promise_resolver=e),this._ad["load"]()}async Show(e){return this._ad?this._adLoading?s(e,"banner ad still loading"):this._adShowing?t(e,"banner ad already shown"):(await this._ad["show"](),this._adShowing=!0,t(e,"banner shown"),void(this._overlap||self["C3MobileAdvertsAPI"]["real"]["forceResize"]())):s(e,"banner ad not created")}async Hide(e){return this._ad?this._adLoading?s(e,"banner ad still loading"):this._adShowing?(await this._ad["hide"](),this._adShowing=!1,t(e,"banner ad hidden"),void(this._overlap||self["C3MobileAdvertsAPI"]["real"]["forceResize"]())):t(e,"banner ad not being shown"):s(e,"banner ad not created")}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}OnLoadSettled(){return this._load_settled_promise}}function h(e){const i=s=>{s.ad===this._ad&&(this._adLoading=!1,t(e,"banner ad loaded"),document.removeEventListener(_.LOAD,i),document.removeEventListener(_.LOAD_FAIL,a),this._load_settled_promise_resolver&&this._load_settled_promise_resolver())},a=t=>{t.ad===this._ad&&(this._ad=null,this._adLoading=!1,s(e,"banner ad failed to load"),document.removeEventListener(_.LOAD,i),document.removeEventListener(_.LOAD_FAIL,a),this._load_settled_promise_resolver&&this._load_settled_promise_resolver())};this._remove_load_listeners=()=>{document.removeEventListener(_.LOAD,i),document.removeEventListener(_.LOAD_FAIL,a),document.removeEventListener(_.LOAD,i),document.removeEventListener(_.LOAD_FAIL,a)},document.addEventListener(_.LOAD,i),document.addEventListener(_.LOAD_FAIL,a)}self.C3BannerAd=l}

// scripts/plugins/advert/dom/interstitialWrapper.js
"use strict";{const t=self.C3AdUtils,e=t.Success,i=t.Failure,s={get LOAD(){return self["admob"]["Events"]["adLoad"]},get LOAD_FAIL(){return self["admob"]["Events"]["adLoadFail"]},get SHOW(){return self["admob"]["Events"]["adShow"]},get SHOW_FAIL(){return self["admob"]["Events"]["adShowFail"]},get DISMISS(){return self["admob"]["Events"]["adDismiss"]}};class a{constructor(t,e){if(!t)return i(e,"Unit ID not specified");this._adUnitId=t,this._ad=null,this._adLoading=!1,this._adShowing=!1,this._loadSuccess=!1,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise(),document.addEventListener(s.DISMISS,async t=>{this._adShowing=!1,this._adLoading=!0,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),d.call(this),self["C3MobileAdvertsAPI"]["real"]["resumeRuntime"](),await this._ad["load"]()})}GetLoadPromise(){return this._loadPromise||(this._loadPromise=new Promise(t=>{this._loadPromiseResolver=t})),this._loadPromise}ResolveLoadPromise(t){this._loadSuccess=t,this._loadPromiseResolver&&this._loadPromiseResolver(t),this._loadPromise=null,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise()}Load(e,i){const s={"adUnitId":t.GetAdUnit(this._adUnitId,"interstitial"),"npa":"NON_PERSONALIZED"===e?"1":"0"};this._adLoading=!0,this._adShowing=!1,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),this._ad=new self["admob"]["InterstitialAd"](s),d.call(this,i),this._ad["load"]()}HandleOnLoadedResult(e,i){e?t.Success(i,"interstitial ad load"):t.Failure(i,"interstitial ad failed to load")}async Show(t){if(!this._ad)return i(t,"interstitial ad not created");if(this._adShowing)return e(t,"interstitial ad already shown");const s=async()=>{this._loadSuccess?(o.call(this,t),await this._ad["show"]()):(d.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad["load"](),await this.GetLoadPromise(),this._loadSuccess?(o.call(this,t),await this._ad["show"]()):i(t,"interstitial ad failed to load"))};this._adLoading?(await this.GetLoadPromise(),await s()):await s()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function d(t){const a=i=>{i.ad===this._ad&&(this._adLoading=!1,this.ResolveLoadPromise(!0),t&&e(t,"interstitial ad load"),document.removeEventListener(s.LOAD,a),document.removeEventListener(s.LOAD_FAIL,d))},d=e=>{e.ad===this._ad&&(this._adLoading=!1,this.ResolveLoadPromise(!1),t&&i(t,"interstitial ad failed to load"),document.removeEventListener(s.LOAD,a),document.removeEventListener(s.LOAD_FAIL,d))};document.addEventListener(s.LOAD,a),document.addEventListener(s.LOAD_FAIL,d)}function o(t){const a=i=>{i.ad===this._ad&&(this._adShowing=!0,self["C3MobileAdvertsAPI"]["real"]["suspendRuntime"](),t&&e(t,"interstitial ad show"),document.removeEventListener(s.SHOW,a),document.removeEventListener(s.SHOW_FAIL,d))},d=e=>{e.ad===this._ad&&(this._adShowing=!1,t&&i(t,"interstitial ad failed to show"),document.removeEventListener(s.SHOW,a),document.removeEventListener(s.SHOW_FAIL,d))};document.addEventListener(s.SHOW,a),document.addEventListener(s.SHOW_FAIL,d)}self.C3InterstitialAd=a}

// scripts/plugins/advert/dom/rewardedWrapper.js
"use strict";{const e=self.C3AdUtils,t=e.Success,s=e.Failure,d={get LOAD(){return self["admob"]["Events"]["adLoad"]},get LOAD_FAIL(){return self["admob"]["Events"]["adLoadFail"]},get SHOW(){return self["admob"]["Events"]["adShow"]},get SHOW_FAIL(){return self["admob"]["Events"]["adShowFail"]},get DISMISS(){return self["admob"]["Events"]["adDismiss"]},get REWARD(){return self["admob"]["Events"]["adReward"]}};class i{constructor(e,t){if(!e)return s(t,"Unit ID not specified");this._adUnitId=e,this._ad=null,this._adLoading=!1,this._adShowing=!1,this._loadSuccess=!1,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise(),this._reward=null}GetLoadPromise(){return this._loadPromise||(this._loadPromise=new Promise(e=>{this._loadPromiseResolver=e})),this._loadPromise}ResolveLoadPromise(e){this._loadSuccess=e,this._loadPromiseResolver&&this._loadPromiseResolver(e),this._loadPromise=null,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise()}Load(t,s){const d={"adUnitId":e.GetAdUnit(this._adUnitId,"rewarded"),"npa":"NON_PERSONALIZED"===t?"1":"0"};this._adLoading=!0,this._adShowing=!1,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),this._ad=new self["admob"]["RewardedAd"](d),a.call(this,s),this._ad["load"]()}HandleOnLoadedResult(t,s){t?e.Success(s,"rewarded ad load"):e.Failure(s,"rewarded ad failed to load")}async Show(e){if(!this._ad)return s(e,"rewarded ad not created");if(this._adShowing)return t(e,"rewarded ad already shown");const d=async()=>{this._loadSuccess?(o.call(this,e),await this._ad["show"]()):(a.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad["load"](),await this.GetLoadPromise(),this._loadSuccess?(o.call(this,e),await this._ad["show"]()):s(e,"rewarded ad failed to load"))};this._adLoading?(await this.GetLoadPromise(),await d()):await d()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function a(e){const i=s=>{s.ad===this._ad&&(this._adLoading=!1,this.ResolveLoadPromise(!0),e&&t(e,"rewarded ad load"),document.removeEventListener(d.LOAD,i),document.removeEventListener(d.LOAD_FAIL,a))},a=t=>{t.ad===this._ad&&(this._adLoading=!1,this.ResolveLoadPromise(!1),e&&s(e,"rewarded ad failed to load"),document.removeEventListener(d.LOAD,i),document.removeEventListener(d.LOAD_FAIL,a))};document.addEventListener(d.LOAD,i),document.addEventListener(d.LOAD_FAIL,a)}function o(e){const i=e=>{e.ad===this._ad&&(this._adShowing=!0,self["C3MobileAdvertsAPI"]["real"]["suspendRuntime"]())},o=e=>{e.ad===this._ad&&(this._reward=e["reward"])},r=t=>{t.ad===this._ad&&(this._adShowing=!1,e&&s(e,"rewarded ad failed to show"),document.removeEventListener(d.SHOW,i),document.removeEventListener(d.SHOW_FAIL,r),document.removeEventListener(d.REWARD,o),document.removeEventListener(d.DISMISS,n))},n=l=>{if(l.ad===this._ad){if(null!==this._reward){const s=String(this._reward["type"]),d=String(this._reward["amount"]);e&&t(e,JSON.stringify([s,d]))}else e&&s(e,"closed with no reward");this._reward=null,this._adShowing=!1,this._adLoading=!0,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),a.call(this),self["C3MobileAdvertsAPI"]["real"]["resumeRuntime"](),this._ad["load"](),document.removeEventListener(d.SHOW,i),document.removeEventListener(d.SHOW_FAIL,r),document.removeEventListener(d.REWARD,o),document.removeEventListener(d.DISMISS,n)}};document.addEventListener(d.SHOW,i),document.addEventListener(d.SHOW_FAIL,r),document.addEventListener(d.REWARD,o),document.addEventListener(d.DISMISS,n)}self.C3RewardedAd=i}

// scripts/plugins/advert/dom/rewardedInterstitialWrapper.js
"use strict";{const e=self.C3AdUtils,t=e.Success,i=e.Failure,s={get LOAD(){return self["admob"]["Events"]["adLoad"]},get LOAD_FAIL(){return self["admob"]["Events"]["adLoadFail"]},get SHOW(){return self["admob"]["Events"]["adShow"]},get SHOW_FAIL(){return self["admob"]["Events"]["adShowFail"]},get DISMISS(){return self["admob"]["Events"]["adDismiss"]},get REWARD(){return self["admob"]["Events"]["adReward"]}};class d{constructor(e,t){if(!e)return i(t,"Unit ID not specified");this._adUnitId=e,this._ad=null,this._adLoading=!1,this._adShowing=!1,this._loadSuccess=!1,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise(),this._reward=null}GetLoadPromise(){return this._loadPromise||(this._loadPromise=new Promise(e=>{this._loadPromiseResolver=e})),this._loadPromise}ResolveLoadPromise(e){this._loadSuccess=e,this._loadPromiseResolver&&this._loadPromiseResolver(e),this._loadPromise=null,this._loadPromiseResolver=null,this._loadPromise=this.GetLoadPromise()}Load(t,i){const s={"adUnitId":e.GetAdUnit(this._adUnitId,"rewardedInterstitial"),"npa":"NON_PERSONALIZED"===t?"1":"0"};this._adLoading=!0,this._adShowing=!1,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),this._ad=new self["admob"]["RewardedInterstitialAd"](s),a.call(this,i),this._ad["load"]()}HandleOnLoadedResult(t,i){t?e.Success(i,"rewarded interstitial ad load"):e.Failure(i,"rewarded interstitial ad failed to load")}async Show(e){if(!this._ad)return i(e,"rewarded interstitial ad not created");if(this._adShowing)return t(e,"rewarded interstitial ad already shown");const s=async()=>{this._loadSuccess?(o.call(this,e),await this._ad["show"]()):(a.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad["load"](),await this.GetLoadPromise(),this._loadSuccess?(o.call(this,e),await this._ad["show"]()):i(e,"rewarded interstitial ad failed to load"))};this._adLoading?(await this.GetLoadPromise(),await s()):await s()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function a(e){const d=i=>{i.ad===this._ad&&(this._adLoading=!1,this.ResolveLoadPromise(!0),e&&t(e,"rewarded interstitial ad load"),document.removeEventListener(s.LOAD,d),document.removeEventListener(s.LOAD_FAIL,a))},a=t=>{t.ad===this._ad&&(this._adLoading=!1,this.ResolveLoadPromise(!1),e&&i(e,"rewarded interstitial ad failed to load"),document.removeEventListener(s.LOAD,d),document.removeEventListener(s.LOAD_FAIL,a))};document.addEventListener(s.LOAD,d),document.addEventListener(s.LOAD_FAIL,a)}function o(e){const d=e=>{e.ad===this._ad&&(this._adShowing=!0,self["C3MobileAdvertsAPI"]["real"]["suspendRuntime"]())},o=e=>{e.ad===this._ad&&(this._reward=e["reward"])},r=t=>{t.ad===this._ad&&(this._adShowing=!1,e&&i(e,"rewarded interstitial ad failed to show"),document.removeEventListener(s.SHOW,d),document.removeEventListener(s.SHOW_FAIL,r),document.removeEventListener(s.REWARD,o),document.removeEventListener(s.DISMISS,n))},n=l=>{if(l.ad===this._ad){if(null!==this._reward){const i=String(this._reward["type"]),s=String(this._reward["amount"]);e&&t(e,JSON.stringify([i,s]))}else e&&i(e,"closed with no reward");this._reward=null,this._adShowing=!1,this._adLoading=!0,this._loadSuccess=!1,this._loadPromise=null,this._loadPromise=this.GetLoadPromise(),a.call(this),self["C3MobileAdvertsAPI"]["real"]["resumeRuntime"](),this._ad["load"](),document.removeEventListener(s.SHOW,d),document.removeEventListener(s.SHOW_FAIL,r),document.removeEventListener(s.REWARD,o),document.removeEventListener(s.DISMISS,n)}};document.addEventListener(s.SHOW,d),document.addEventListener(s.SHOW_FAIL,r),document.addEventListener(s.REWARD,o),document.addEventListener(s.DISMISS,n)}self.C3RewardedInterstitialAd=d}

// scripts/plugins/advert/dom/consentWrapper.js
"use strict";{const t=self.C3AdUtils,s=t.Success,a=t.Failure,n=!!self["cordova"]&&"ios"===self["cordova"]["platformId"],e=!!self["cordova"]&&"android"===self["cordova"]["platformId"],i=0,r=2,o=1,c=3;class u{constructor(){this._adPersonalization="UNKNOWN",this._inEEAorUnknown="",this._consentStatusIndex=0,this._consentStatusString="UNKNOWN",this._trackingStatusString="not-determined",this._hasConsentForm=!1}async Reset(){t.ConfigurationOptions.debug&&await self["consent"]["reset"]()}GetAdPersonalization(){return this._adPersonalization}async RequestTrackingAuthorization(){n&&await self["admob"]["requestTrackingAuthorization"]()}async GetTrackingAuthorizationStatus(){if(e)return this._trackingStatusString="not-determined";const t=self["cordova"]["plugins"]["idfa"],s=await t["getInfo"]();if(!s["trackingLimited"])return this._trackingStatusString="authorized";switch(s["trackingPermission"]){case t["TRACKING_PERMISSION_NOT_DETERMINED"]:return this._trackingStatusString="not-determined";case t["TRACKING_PERMISSION_RESTRICTED"]:case t["TRACKING_PERMISSION_DENIED"]:return this._trackingStatusString="denied";case t["TRACKING_PERMISSION_AUTHORIZED"]:return this._trackingStatusString="authorized"}}async RequestIDFA(t){return e?s(t,"not-determined"):n?(await g.call(this),"true"===this._inEEAorUnknown?await this.RequestTrackingAuthorization():(await this.GetTrackingAuthorizationStatus(),"not-determined"===this._trackingStatusString&&(await h.call(this),this._hasConsentForm?await this.ShowIDFAMessage():await this.RequestTrackingAuthorization())),await this.GetTrackingAuthorizationStatus(),s(t,this._trackingStatusString)):void 0}async RequestInfoUpdateForTesting(t,s,n){return await _.call(this,t,s,t=>{a(n,t?"object"==typeof t?t.message:t:"requestInfoUpdate error")})}async RequestInfoUpdateForTestingSkipErrors(t,s,a){await _.call(this,t,s)}async ShowConsentForm(t,s=!1){switch(await l.call(this),t){case"eu":{const t=await h.call(this);if(S.call(this)&&t){const t=await self["consent"]["loadForm"]();await t.show()}break}case"always":{const t=await h.call(this),a=await g.call(this);if(t&&"true"===a){const t=await self["consent"]["loadForm"]();await t.show()}else if(t&&s){const t=await self["consent"]["loadForm"]();await t.show()}break}}await l.call(this),await g.call(this),await w.call(this)}async ShowIDFAMessage(t){await this.ShowConsentForm("always",!0)}async UpdateConsentStatus(){await l.call(this),await g.call(this),await w.call(this)}async SuccessResponse(t){await this.GetTrackingAuthorizationStatus(),s(t,`${this._consentStatusString}&&${this._trackingStatusString}&&${this._inEEAorUnknown}`)}async FailureResponse(t,s){a(t,s)}async StatusUpdateSuccessResponse(t){await this.UpdateConsentStatus(),await this.GetTrackingAuthorizationStatus(),s(t,`${this._consentStatusString}&&${this._trackingStatusString}&&${this._inEEAorUnknown}`)}}async function h(){const t=await self["consent"]["getFormStatus"]();return this._hasConsentForm=t===self["consent"]["FormStatus"]["Available"],this._hasConsentForm}async function l(){const t=await self["consent"]["getConsentStatus"]();switch(this._consentStatusIndex=t,this._consentStatusIndex){case o:return this._consentStatusString="REQUIRED";case r:return this._consentStatusString="NOT_REQUIRED";case c:return this._consentStatusString="OBTAINED";case i:return this._consentStatusString="UNKNOWN"}}function S(){switch(this._consentStatusIndex){case o:return!0;case r:case c:return!1;case i:return!0}}function w(){switch(this._consentStatusIndex){case o:return this._adPersonalization="NON_PERSONALIZED";case r:case c:return this._adPersonalization="PERSONALIZED";case i:return this._adPersonalization="NON_PERSONALIZED"}}async function g(){if(e)switch(this._consentStatusIndex){case o:return this._inEEAorUnknown="true";case r:return this._inEEAorUnknown="false";case c:case i:return this._inEEAorUnknown="true"}if(n){const t=await d.call(this,"IABTCF_gdprApplies","getInt");return this._inEEAorUnknown=t?"true":"false"}}async function d(t,s){return new Promise((a,n)=>{self["NativeStorage"][s](t,t=>a(t),t=>a(1))})}async function _(s,a,n){let e="",i=null;if(s){switch(a){case"EEA":e=self["consent"]["DebugGeography"]["EEA"];break;case"NOT_EEA":e=self["consent"]["DebugGeography"]["NotEEA"];break;default:e=self["consent"]["DebugGeography"]["Disabled"]}i=[await t.TestId]}try{return s?await self["consent"]["requestInfoUpdate"]({debugGeography:e,testDeviceIds:i}):await self["consent"]["requestInfoUpdate"](),!0}catch(t){return n&&n(t),!1}}self.C3Consent=new u}

// scripts/plugins/advert/dom/md5.js
"use strict";{const t=(t,e)=>{let c=t[0],s=t[1],f=t[2],h=t[3];c=r(c,s,f,h,e[0],7,-680876936),h=r(h,c,s,f,e[1],12,-389564586),f=r(f,h,c,s,e[2],17,606105819),s=r(s,f,h,c,e[3],22,-1044525330),c=r(c,s,f,h,e[4],7,-176418897),h=r(h,c,s,f,e[5],12,1200080426),f=r(f,h,c,s,e[6],17,-1473231341),s=r(s,f,h,c,e[7],22,-45705983),c=r(c,s,f,h,e[8],7,1770035416),h=r(h,c,s,f,e[9],12,-1958414417),f=r(f,h,c,s,e[10],17,-42063),s=r(s,f,h,c,e[11],22,-1990404162),c=r(c,s,f,h,e[12],7,1804603682),h=r(h,c,s,f,e[13],12,-40341101),f=r(f,h,c,s,e[14],17,-1502002290),s=r(s,f,h,c,e[15],22,1236535329),c=o(c,s,f,h,e[1],5,-165796510),h=o(h,c,s,f,e[6],9,-1069501632),f=o(f,h,c,s,e[11],14,643717713),s=o(s,f,h,c,e[0],20,-373897302),c=o(c,s,f,h,e[5],5,-701558691),h=o(h,c,s,f,e[10],9,38016083),f=o(f,h,c,s,e[15],14,-660478335),s=o(s,f,h,c,e[4],20,-405537848),c=o(c,s,f,h,e[9],5,568446438),h=o(h,c,s,f,e[14],9,-1019803690),f=o(f,h,c,s,e[3],14,-187363961),s=o(s,f,h,c,e[8],20,1163531501),c=o(c,s,f,h,e[13],5,-1444681467),h=o(h,c,s,f,e[2],9,-51403784),f=o(f,h,c,s,e[7],14,1735328473),s=o(s,f,h,c,e[12],20,-1926607734),c=l(c,s,f,h,e[5],4,-378558),h=l(h,c,s,f,e[8],11,-2022574463),f=l(f,h,c,s,e[11],16,1839030562),s=l(s,f,h,c,e[14],23,-35309556),c=l(c,s,f,h,e[1],4,-1530992060),h=l(h,c,s,f,e[4],11,1272893353),f=l(f,h,c,s,e[7],16,-155497632),s=l(s,f,h,c,e[10],23,-1094730640),c=l(c,s,f,h,e[13],4,681279174),h=l(h,c,s,f,e[0],11,-358537222),f=l(f,h,c,s,e[3],16,-722521979),s=l(s,f,h,c,e[6],23,76029189),c=l(c,s,f,h,e[9],4,-640364487),h=l(h,c,s,f,e[12],11,-421815835),f=l(f,h,c,s,e[15],16,530742520),s=l(s,f,h,c,e[2],23,-995338651),c=n(c,s,f,h,e[0],6,-198630844),h=n(h,c,s,f,e[7],10,1126891415),f=n(f,h,c,s,e[14],15,-1416354905),s=n(s,f,h,c,e[5],21,-57434055),c=n(c,s,f,h,e[12],6,1700485571),h=n(h,c,s,f,e[3],10,-1894986606),f=n(f,h,c,s,e[10],15,-1051523),s=n(s,f,h,c,e[1],21,-2054922799),c=n(c,s,f,h,e[8],6,1873313359),h=n(h,c,s,f,e[15],10,-30611744),f=n(f,h,c,s,e[6],15,-1560198380),s=n(s,f,h,c,e[13],21,1309151649),c=n(c,s,f,h,e[4],6,-145523070),h=n(h,c,s,f,e[11],10,-1120210379),f=n(f,h,c,s,e[2],15,718787259),s=n(s,f,h,c,e[9],21,-343485551),t[0]=i(c,t[0]),t[1]=i(s,t[1]),t[2]=i(f,t[2]),t[3]=i(h,t[3])},e=(t,e,r,o,l,n)=>(e=i(i(e,t),i(o,n)),i(e<<l|e>>>32-l,r)),r=(t,r,o,l,n,c,s)=>e(r&o|~r&l,t,r,n,c,s),o=(t,r,o,l,n,c,s)=>e(r&l|o&~l,t,r,n,c,s),l=(t,r,o,l,n,c,s)=>e(r^o^l,t,r,n,c,s),n=(t,r,o,l,n,c,s)=>e(o^(r|~l),t,r,n,c,s),c=e=>{const r=e.length,o=[1732584193,-271733879,-1732584194,271733878];let l;for(l=64;l<=e.length;l+=64)t(o,s(e.substring(l-64,l)));e=e.substring(l-64);const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<e.length;l++)n[l>>2]|=e.charCodeAt(l)<<(l%4<<3);if(n[l>>2]|=128<<(l%4<<3),l>55)for(t(o,n),l=0;l<16;l++)n[l]=0;return n[14]=8*r,t(o,n),o},s=t=>{const e=[];for(let r=0;r<64;r+=4)e[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return e},f="0123456789abcdef".split(""),h=t=>{let e="";for(let r=0;r<4;r++)e+=f[t>>8*r+4&15]+f[t>>8*r&15];return e},d=t=>{for(let e=0;e<t.length;e++)t[e]=h(t[e]);return t.join("")},a=t=>d(c(t));let i=(t,e)=>t+e&4294967295;if("5d41402abc4b2a76b9719d911017c592"!=a("hello")){}self.C3AdUtilsMD5=a}

// scripts/plugins/advert/dom/real.js
"use strict";{const e=self.C3AdUtils,a=self.C3Consent,t=self.C3BannerAd,i=self.C3InterstitialAd,n=self.C3RewardedAd,r=self.C3RewardedInterstitialAd;let s=null,o=null,d=null,l=null,u=null;const w={},c=(e,a)=>{w[e]=a};c("CreateBannerAdvert",async(i,n,r,o,d,l,u,w)=>{if(!await e.StartAdmobPlus(w,r))return;d&&s&&(await s.OnLoadSettled(),await s.Hide(()=>!0),s.Release(),s=null);const c=await a.GetAdPersonalization();s||(s=new t(i,n,o,l,u,w)),s.Load(c,w)}),c("ShowBannerAdvert",async a=>{if(!s)return e.Failure(a,"banner ad not created");s.Show(a)}),c("HideBannerAdvert",async a=>{if(!s)return e.Failure(a,"banner ad not created");s.Hide(a)}),c("CreateInterstitialAdvert",async(t,n,r)=>{if(o){if(o.IsShowing())return e.Success(r,"interstitial ad already showing");if(o.IsLoading()){const e=await o.GetLoadPromise();o.HandleOnLoadedResult(e,r)}else{const e=await a.GetAdPersonalization();o.Load(e,r)}return}if(!await e.StartAdmobPlus(r,n))return;const s=await a.GetAdPersonalization();o=new i(t,r),o.Load(s,r)}),c("ShowInterstitialAdvert",async a=>{if(!o)return e.Failure(a,"interstitial ad not created");o.Show(a)}),c("CreateVideoAdvert",async(t,i,r)=>{if(d||l){if(l){if(l.IsShowing())return e.Success(r,"rewarded ad already showing");if(l.IsLoading()){const e=await l.GetLoadPromise();l.HandleOnLoadedResult(e,r)}else{const e=await a.GetAdPersonalization();l.Load(e,r)}return}if(d){if(d.IsShowing())return e.Success(r,"rewarded ad already showing");if(d.IsLoading()){const e=await d.GetLoadPromise();d.HandleOnLoadedResult(e,r)}else{const e=await a.GetAdPersonalization();d.Load(e,r)}return}}if(!await e.StartAdmobPlus(r,i))return;const s=await a.GetAdPersonalization();d=new n(t,r),d.Load(s,r)}),c("ShowVideoAdvert",async a=>{if(!d)return e.Failure(a,"video ad not created");d.Show(a)}),c("CreateRewardedAdvert",async(t,i,r)=>{if(l||d){if(l){if(l.IsShowing())return e.Success(r,"rewarded ad already showing");if(l.IsLoading()){const e=await l.GetLoadPromise();l.HandleOnLoadedResult(e,r)}else{const e=await a.GetAdPersonalization();l.Load(e,r)}return}if(d){if(d.IsShowing())return e.Success(r,"rewarded ad already showing");if(d.IsLoading()){const e=await d.GetLoadPromise();d.HandleOnLoadedResult(e,r)}else{const e=await a.GetAdPersonalization();d.Load(e,r)}return}}if(!await e.StartAdmobPlus(r,i))return;const s=await a.GetAdPersonalization();l=new n(t,r),l.Load(s,r)}),c("ShowRewardedAdvert",async a=>{if(!l)return e.Failure(a,"rewarded ad not created");l.Show(a)}),c("CreateRewardedInterstitialAdvert",async(t,i,n)=>{if(u){if(u.IsShowing())return e.Success(n,"rewarded interstitial ad already showing");if(u.IsLoading()){const e=await u.GetLoadPromise();u.HandleOnLoadedResult(e,n)}else{const e=await a.GetAdPersonalization();u.Load(e,n)}return}if(!await e.StartAdmobPlus(n,i))return;const s=await a.GetAdPersonalization();u=new r(t,n),u.Load(s,n)}),c("ShowRewardedInterstitialAdvert",async a=>{if(!u)return e.Failure(a,"rewarded interstitial ad not created");u.Show(a)}),c("Configure",async(t,i,n,r,s,o,d,l,u)=>{const w=!e.HasInitConfigurationOptions();return e.SetInitConfigureOptions(t,i,n,r,s,o,d),await e.StartAdmobPlus(u,o)?(w&&await a.Reset(),await a.RequestInfoUpdateForTesting(o,d,u)?(w?l?await a.ShowConsentForm("eu"):await a.UpdateConsentStatus():await a.ShowConsentForm("always"),void await a.SuccessResponse(u)):a.FailureResponse(u,"failure to update consent information")):a.FailureResponse(u,"failure to initialize")}),c("RequestConsent",async a=>{w["Configure"](e.ConfigurationOptions.id,e.ConfigurationOptions.pubID,e.ConfigurationOptions.privacyPolicy,e.ConfigurationOptions.showFree,"always",e.ConfigurationOptions.debug,e.ConfigurationOptions.debugLocation,!1,a)}),c("SetMaxAdContentRating",async(a,t)=>{if(await e.StartAdmobPlus(t)){if(!a)return e.Failure(t,"Label not specified");try{e.UpdateAdmobPlusRequest("maxAdContentRating",a),e.Success(t,"")}catch(a){e.Failure(t,"invalid label")}}}),c("TagForChildDirectedTreatment",async(a,t)=>{if(await e.StartAdmobPlus(t))try{e.UpdateAdmobPlusRequest("tagForChildDirectedTreatment",1===a),e.Success(t,"")}catch(a){e.Failure(t,"invalid label")}}),c("TagForUnderAgeOfConsent",async(a,t)=>{if(await e.StartAdmobPlus(t))try{e.UpdateAdmobPlusRequest("tagForUnderAgeOfConsent",1===a),e.Success(t,"")}catch(a){e.Failure(t,"invalid label")}}),c("RequestIDFA",async t=>{await e.StartAdmobPlus(t)&&a.RequestIDFA(t)}),c("StatusUpdate",async(t,i,n)=>{if(!await e.StartAdmobPlus(n,t))return a.FailureResponse(n,"failure to initialize");await a.RequestInfoUpdateForTestingSkipErrors(t,i,n),await a.StatusUpdateSuccessResponse(n)}),self["C3MobileAdvertsAPI"]||(self["C3MobileAdvertsAPI"]={}),self["C3MobileAdvertsAPI"]["real"]=w}

// scripts/plugins/advert/dom/fake.js
"use strict";{const e="PERSONALIZED",t={},a=(e,a)=>t[e]=a,n=e=>new Promise(t=>setTimeout(t,e));let r=null,d=null,s=null,l=null,i=null;function o(e,t){const a=t.slice(0,-1),n=t[t.length-1];return console.log(e,a),[a,n]}a("CreateBannerAdvert",async(...e)=>{const[t,a]=o("CreateBannerAdvert",e);await n(50),r?a("Banner already exists"):(r="ready",a(null,"Created banner"))}),a("ShowBannerAdvert",async(...e)=>{const[t,a]=o("ShowBannerAdvert",e);await n(50),"ready"!=r?a("Banner cannot be shown"):(r="shown",a(null,"Showed banner"))}),a("HideBannerAdvert",async(...e)=>{const[t,a]=o("HideBannerAdvert",e);await n(50),"shown"!=r?a("Banner cannot be hidden"):(r=null,a(null,"Hid banner"))}),a("CreateInterstitialAdvert",async(...e)=>{const[t,a]=o("CreateInterstitialAdvert",e);await n(50),d?a("Intersitial already exists"):(d="ready",a(null,"Created interstitial"))}),a("ShowInterstitialAdvert",async(...e)=>{const[t,a]=o("ShowInterstitialAdvert",e);await n(50),"ready"!=d?a("Cannot show interstitial"):(d=null,a(null,"Interstitial shown"))}),a("CreateVideoAdvert",async(...e)=>{const[t,a]=o("CreateVideoAdvert",e);await n(50),s?a("Video already exists"):(s="ready",a(null,"Created video"))}),a("ShowVideoAdvert",async(...e)=>{const[t,a]=o("ShowVideoAdvert",e);await n(50),"ready"!=s?a("Cannot show video"):(s=null,a(null,'["example type", 20]'))}),a("CreateRewardedAdvert",async(...e)=>{const[t,a]=o("CreateRewardedAdvert",e);await n(50),l?a("Rewarded already exists"):(l="ready",a(null,"Created rewarded"))}),a("ShowRewardedAdvert",async(...e)=>{const[t,a]=o("ShowRewardedAdvert",e);await n(50),"ready"!=l?a("Cannot show rewarded"):(l=null,a(null,'["example type", 20]'))}),a("CreateRewardedInterstitialAdvert",async(...e)=>{const[t,a]=o("CreateRewardedInterstitialAdvert",e);await n(50),i?a("Rewarded intersitial already exists"):(i="ready",a(null,"Created rewarded interstitial"))}),a("ShowRewardedInterstitialAdvert",async(...e)=>{const[t,a]=o("ShowRewardedInterstitialAdvert",e);await n(50),"ready"!=i?a("Cannot show rewarded interstitial"):(i=null,a(null,"Rewarded interstitial shown"))}),a("Configure",async(...t)=>{const[a,r]=o("Configure",t);await n(50),r(null,e+"&&true")}),a("RequestConsent",async(...t)=>{const[a,r]=o("RequestConsent",t);await n(50),r(null,e+"&&true")}),a("RequestIDFA",async(...e)=>{const[t,a]=o("RequestIDFA",e);await n(50),a(null,"authorized")}),self["C3MobileAdvertsAPI"]||(self["C3MobileAdvertsAPI"]={}),self["C3MobileAdvertsAPI"]["fake"]=t}

// scripts/plugins/advert/dom/web.js
"use strict";{const e=self.C3AdUtils,a={},d=(e,d)=>{a[e]=d};let r=!1,t=null;const s=async d=>a["webAdsScriptLoaded"]?(r||(self["adsbygoogle"]=self["adsbygoogle"]||[],self["adBreak"]=self["adConfig"]=e=>self["adsbygoogle"].push(e),r=!0),t||(t=new Promise((e,a)=>{self["adConfig"]({"preloadAdBreaks":"on","onReady":()=>e(!0)})}),t)):(e.Failure(d,"advert script not loaded, likely blocked by an ad blocker"),!1),i=()=>{a["suspendRuntime"]&&a["suspendRuntime"]()},n=()=>{a["resumeRuntime"]&&a["resumeRuntime"]()};d("CreateBannerAdvert",async(a,d,r,t,s,i,n)=>{e.Failure(n,"banner ads not supported in web platform")}),d("ShowBannerAdvert",async a=>{e.Failure(a,"banner ads not supported in web platform")}),d("HideBannerAdvert",async a=>{e.Failure(a,"banner ads not supported in web platform")}),d("CreateInterstitialAdvert",async(a,d,r)=>{await s(r)&&e.Success(r,"interstitial ad created")}),d("ShowInterstitialAdvert",async a=>{await s(a)&&self["adBreak"]({"type":"next","beforeAd":()=>i(),"afterAd":()=>n(),"adBreakDone":d=>{switch(d["breakStatus"]){case"viewed":case"dismissed":e.Success(a,"interstitial ad show");break;default:console.table(d),e.Failure(a,"interstitial ad failed to show")}}})}),d("CreateVideoAdvert",async(a,d,r)=>{e.Failure(r,"video ads are deprecated")}),d("ShowVideoAdvert",async a=>{e.Failure(a,"video ads are deprecated")}),d("CreateRewardedAdvert",async(a,d,r)=>{await s(r)&&e.Success(r,"rewarded ad created")}),d("ShowRewardedAdvert",async a=>{await s(a)&&self["adBreak"]({"type":"reward","beforeAd":()=>i(),"afterAd":()=>n(),"adBreakDone":d=>{switch(d["breakStatus"]){case"viewed":case"dismissed":e.Success(a,"rewarded ad show");break;case"ignored":e.Failure(a,"rewarded ad ignored");break;default:console.table(d),e.Failure(a,"rewarded ad failed to show")}},"beforeReward":e=>{e()},"adDismissed":()=>{e.Failure(a,"closed with no reward")},"adViewed":()=>{e.Success(a,JSON.stringify(["Reward",1]))}})}),d("CreateRewardedInterstitialAdvert",async(a,d,r)=>{await s(r)&&e.Success(r,"rewarded interstitial ad created")}),d("ShowRewardedInterstitialAdvert",async a=>{await s(a)&&self["adBreak"]({"type":"reward","beforeAd":()=>i(),"afterAd":()=>n(),"adBreakDone":d=>{switch(d["breakStatus"]){case"viewed":case"dismissed":e.Success(a,"rewarded interstitial ad show");break;case"ignored":e.Failure(a,"rewarded interstitial ad ignored");break;default:console.table(d),e.Failure(a,"rewarded interstitial ad failed to show")}},"beforeReward":e=>{e()},"adDismissed":()=>{e.Failure(a,"closed with no reward")},"adViewed":()=>{e.Success(a,JSON.stringify(["Reward",1]))}})}),d("Configure",async(d,r,t,s,i,n,o,l,c)=>{a["webAdsScriptLoaded"]?e.Success(c,"UNKNOWN&&not-determined&&true"):e.Failure(c,"advert script not loaded, likely blocked by an ad blocker")}),d("RequestConsent",async a=>{e.Success(a,"UNKNOWN&&not-determined&&true")}),d("SetMaxAdContentRating",async(a,d)=>{e.Failure(d,"setting max ad content rating not supported in web platform")}),d("TagForChildDirectedTreatment",async(a,d)=>{e.Failure(d,"tagging for children not supported in web platform")}),d("TagForUnderAgeOfConsent",async(a,d)=>{e.Failure(d,"tagging for under age of consent not supported in web platform")}),d("RequestIDFA",async a=>{e.Success(a,"not-determined")}),d("StatusUpdate",async(a,d,r)=>{e.Success(r,"UNKNOWN&&not-determined&&true")}),self["C3MobileAdvertsAPI"]||(self["C3MobileAdvertsAPI"]={}),self["C3MobileAdvertsAPI"]["web"]=a}

// scripts/plugins/advert/dom/domside.js
"use strict";{const e="advert",t=!1;let n=!1;const i=class extends self.DOMHandler{constructor(t){super(t,e);const n=e=>[e,t=>this._CallMethod(e,t)];this.AddRuntimeMessageHandlers([n("CreateBannerAdvert"),n("ShowBannerAdvert"),n("HideBannerAdvert"),n("CreateInterstitialAdvert"),n("ShowInterstitialAdvert"),n("CreateVideoAdvert"),n("ShowVideoAdvert"),n("CreateRewardedAdvert"),n("ShowRewardedAdvert"),n("CreateRewardedInterstitialAdvert"),n("ShowRewardedInterstitialAdvert"),n("Configure"),n("RequestConsent"),n("SetUserPersonalisation"),n("SetMaxAdContentRating"),n("TagForChildDirectedTreatment"),n("TagForUnderAgeOfConsent"),n("RequestIDFA"),n("StatusUpdate"),(e=>[e,e=>this._AddScript(e[0],e[1])])("AddScript")])}_GetApi(){return self["cordova"]?self["C3MobileAdvertsAPI"]["real"]:self["cordova"]||t?t?self["C3MobileAdvertsAPI"]["fake"]:void 0:self["C3MobileAdvertsAPI"]["web"]}_SuspendRuntime(){this.GetRuntimeInterface().PostToRuntimeComponent("runtime","visibilitychange",{"hidden":!0})}_ResumeRuntime(){this.GetRuntimeInterface().PostToRuntimeComponent("runtime","visibilitychange",{"hidden":!1})}_ForceResize(){const e=this.GetRuntimeInterface();e&&(e.SkipNextAndroidVirtualKeyboardDetection(),e.PostToRuntimeComponent("runtime","window-resize",{"innerWidth":e._GetWindowInnerWidth(),"innerHeight":e._GetWindowInnerHeight(),"devicePixelRatio":self.devicePixelRatio,"isFullscreen":self.RuntimeInterface.IsDocumentFullscreen(),"cssDisplayMode":e.GetCssDisplayMode()}))}async _CallMethod(e,t){const i=this._GetApi();if(i["suspendRuntime"]||(i["suspendRuntime"]=()=>this._SuspendRuntime()),i["resumeRuntime"]||(i["resumeRuntime"]=()=>this._ResumeRuntime()),i["forceResize"]||(i["forceResize"]=()=>this._ForceResize()),!i)throw n||(n=!0,console.warn("The Mobile Advert plugin is not loaded. Please note that it only works in Android or iOS exports")),new Error("advert plugin not loaded");return new Promise((n,r)=>{(0,i[e])(...t,(e,t)=>{e?r(e):n(t)})})}async _AddScript(e,t=null){const n=this._GetApi();return n["webAdsScriptLoaded"]=!1,new Promise((i,r)=>{const s=document.createElement("script");if(t)for(let e in t)s.setAttribute(e,t[e]);s.onload=function(){n["webAdsScriptLoaded"]=!0,i()},s.onerror=function(e){n["webAdsScriptLoaded"]=!1,i()},s.src=e,document.head.appendChild(s)})}};self.RuntimeInterface.AddDOMHandlerClass(i)}

// scripts/plugins/googleplay/dom/domSide.js
"use strict";{const e="googleplay",t=class extends self.DOMHandler{constructor(t){super(t,e),this.AddRuntimeMessageHandlers([["load",([e])=>this._Load(e)],["signin",()=>this._SignIn()],["signout",()=>this._SignOut()],["getplayer",()=>this._RequestPlayerDetails()],["submitscore",e=>this._SubmitScore(e)],["requestscores",e=>this._RequestHiScores(e)],["requestachievements",e=>this._RequestAchievements(e)],["requestmetadata",e=>this._RequestAchievementMetaData(e)],["reveal",e=>this._RevealAchievement(e)],["unlock",e=>this._UnlockAchievement(e)],["increment",e=>this._IncrementAchievement(e)],["setsteps",e=>this._SetSteps(e)],["showleaderboard",e=>this._ShowLeaderboard(e)],["showachievements",e=>this._ShowAchievements(e)]]),this._playinterface=null,this._isSignedIn=!1,this._isLoaded=!1}async _RequestPlayerDetails(){if(!this._isSignedIn)return null;const e={"id":"","display":"","avatar":"","givenName":"","familyName":""};let t;return t=window["cordova"]?await this._CallNativeAPIMethod("getPlayerData"):await this._CallWebAPIMethod("players/me"),e["id"]=t["playerId"]||"",e["display"]=t["displayName"]||"",e["avatar"]=t["avatarImageUrl"]||"",t["name"]&&(e["givenName"]=t["name"]["givenName"]||"",e["familyName"]=t["name"]["familyName"]||""),e}_SignIn(){if(!this._isLoaded||this._isSignedIn)return null;this._playinterface?this._playinterface["signin"]():self["gapi"]["auth"]["signIn"]({"callback":window["googlePlaySigninCallback"]})}_SignOut(){if(!this._isSignedIn)return null;this._playinterface?console.log("[Construct Play Games plugin] Sign out no longer supported with Play Games SDK v2"):self["gapi"]["auth"]["signOut"]()}_SubmitScore(e){if(!this._isSignedIn)return null;if(this._playinterface)return this._CallNativeAPIMethod("submitScore",e);{const t=e["leaderboardId"];return this._CallWebAPIMethod(`leaderboards/${t}/scores`,e,"post")}}async _RequestHiScores(e){if(!this._isSignedIn)return null;const t={"page":[],"total":0,"best":0,"formattedbest":"","besttag":"","rank":0,"formattedrank":""};let a;if(this._playinterface)a=await this._CallNativeAPIMethod("getHiScores",e);else{const t=e["leaderboardId"],i=e["collection"],s=e["type"];a=await this._CallWebAPIMethod(`leaderboards/${t}/${s}/${i}`,e)}return t["total"]=parseInt(a["numScores"],10)||0,a["playerScore"]&&(t["best"]=parseInt(a["playerScore"]["scoreValue"],10)||0,t["formattedbest"]=a["playerScore"]["formattedScore"]||"",t["besttag"]=a["playerScore"]["scoreTag"]||"",t["rank"]=parseInt(a["playerScore"]["scoreRank"],10)||0,t["formattedrank"]=a["playerScore"]["formattedScoreRank"]||""),t["page"]=a["items"],t}async _RequestAchievements(e){const t=e["which"];if(!this._isSignedIn)return null;if(this._playinterface){const a=await this._CallNativeAPIMethod("getAchievements",e),i=new Map,s=a["items"];for(const e of a["items"])i.set(e["id"],{"name":e["name"],"description":e["description"],"type":e["achievementType"],"totalSteps":e["totalSteps"],"revealedUrl":e["revealedIconUrl"],"unlockedUrl":e["unlockedIconUrl"]});return{"page":s.filter(e=>e["state"]===t),"id":i}}return{"page":(await this._CallWebAPIMethod("players/me/achievements",e))["items"].filter(e=>e["state"]===t),"id":null}}async _RequestAchievementMetaData(e){const t=e["reload"];if(!this._isSignedIn)return null;if(this._playinterface)return this._RequestAchievements({"which":"ALL","reload":t});{const e=await this._CallWebAPIMethod("achievements"),t=new Map;for(const a of e["items"])t.set(a["id"],{"name":a["name"],"description":a["description"],"type":a["achievementType"],"totalSteps":a["totalSteps"],"revealedUrl":a["revealedIconUrl"],"unlockedUrl":a["unlockedIconUrl"]});return{"page":null,"id":t}}}async _RevealAchievement(e){const t=e["id"];return this._isSignedIn?(this._playinterface?await this._CallNativeAPIMethod("revealAchievement",{"achievementId":t}):await this._CallWebAPIMethod(`achievements/${t}/reveal`,null,"post"),!0):null}async _UnlockAchievement(e){const t=e["id"];return this._isSignedIn?(this._playinterface?await this._CallNativeAPIMethod("unlockAchievement",{"achievementId":t}):await this._CallWebAPIMethod(`achievements/${t}/unlock`,null,"post"),!0):null}async _IncrementAchievement(e){const t=e["id"],a=e["steps"];return this._isSignedIn?(this._playinterface?await this._CallNativeAPIMethod("incrementAchievement",{"achievementId":t,"numSteps":a}):await this._CallWebAPIMethod(`achievements/${t}/increment`,{"stepsToIncrement":a},"post"),!0):null}async _SetSteps(e){const t=e["id"],a=e["steps"];return this._isSignedIn?(this._playinterface?await this._CallNativeAPIMethod("setStepsAchievement",{"achievementId":t,"numSteps":a}):await this._CallWebAPIMethod(`achievements/${t}/setStepsAtLeast`,{"steps":a},"post"),!0):null}_ShowLeaderboard(e){const t=e["id"];if(!this._isSignedIn)return null;if(this._playinterface)return null!=t?this._CallNativeAPIMethod("showLeaderboard",{"leaderboardId":t}):this._CallNativeAPIMethod("showLeaderboards");throw new Error("not available")}_ShowAchievements(){if(!this._isSignedIn)return null;if(this._playinterface)return this._CallNativeAPIMethod("showAchievements");throw new Error("not available")}_CallWebAPIMethod(e,t=void 0,a="get"){return new Promise((i,s)=>{self["gapi"]["client"]["request"]({"path":"/games/v1/"+e,"method":a,"params":t,"callback":function(e){let t=e?e["error"]:"no_response";t?("object"==typeof t?t="string"==typeof t["message"]?t["message"]:"unknown":"string"!=typeof t&&(t="unknown"),s(t)):i(e)}})})}_CallNativeAPIMethod(e,t={}){return new Promise((a,i)=>{this._playinterface[e](t,(e,t)=>{e?i(e):a(t)})})}_Load(e){return new Promise((t,a)=>{const i=(e,t)=>{this._isSignedIn=t,this.PostToRuntime("login",{"state":t,"error":e})};window["cordova"]?this._LoadCordovaAPI(t,a,i):this._LoadWebAPI(e,t,a,i)})}_LoadWebAPI(e,t,a,i){const s=(e,t)=>{const a=document.createElement("meta");a.setAttribute("name","google-signin-"+e),a.setAttribute("content",t),document.head.appendChild(a)};window["googlePlayLoadCallback"]=(...e)=>{this._isLoaded=!0,t(...e)},window["googlePlaySigninCallback"]=e=>{e["status"]&&e["status"]["signed_in"]?i("",!0):i(e["error"]+"",!1)},s("clientid",e),s("cookiepolicy","single_host_origin"),s("callback","googlePlaySigninCallback"),s("scope","https://www.googleapis.com/auth/games");const n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("async",""),n.setAttribute("src","https://apis.google.com/js/client.js?onload=googlePlayLoadCallback"),n.addEventListener("error",()=>a("failed to load script")),document.head.appendChild(n)}_LoadCordovaAPI(e,t,a){const i=window["cordova"]["plugins"]["ConstructPlayGames"];if(!i)return t();this._playinterface=i,e(),this._isLoaded=!0,i["setCallback"](a),i["silentSignIn"]()}};self.RuntimeInterface.AddDOMHandlerClass(t)}

// scripts/plugins/Bluetooth/dom/domSide.js
"use strict";{const e="bluetooth";function t(e){const t=[];for(var i in e)!0===e[i]&&t.push(i);return t}const i=class extends self.DOMHandler{constructor(t){super(t,e),this._isSupported=!!navigator["bluetooth"],this._devicesMap=new Map,this.AddRuntimeMessageHandlers([["init",()=>this._OnInit()],["request-device",e=>this._OnRequestDevice(e)],["disconnect-device",e=>this._OnDisconnectDevice(e)],["request-primary-services",e=>this._OnRequestPrimaryServices(e)],["request-characteristics",e=>this._OnRequestCharacteristics(e)],["read-characteristic",e=>this._OnReadCharacteristic(e)],["notify-characteristic",e=>this._OnNotifyCharacteristic(e)],["write-characteristic",e=>this._OnWriteCharacteristic(e)]])}_OnInit(){return{"isSupported":this._isSupported}}_GetDeviceInfo(e){return this._devicesMap.get(e)||null}async _GetPrimaryServiceInfo(e,t){const i=this._GetDeviceInfo(e);if(!i)return null;const r=i.primaryServicesCache;let c=r.get(t);if(c)return c;const s=await i.device["gatt"]["getPrimaryService"](t);return c=r.get(t),c||(c={primaryService:s,characteristicsCache:new Map},r.set(t,c)),c}async _GetCharacteristicInfo(e,t,i){const r=await this._GetPrimaryServiceInfo(e,t);if(!r)return null;const c=r.characteristicsCache;let s=c.get(i);if(s)return s;const a=await r.primaryService["getCharacteristic"](i);return s=c.get(i),s||(s={characteristic:a},c.set(i,s)),s}async _OnRequestDevice(e){const t=[];e["services"].length>0&&t.push({"services":e["services"]}),e["deviceName"]&&t.push({"name":e["deviceName"]}),e["deviceNamePrefix"]&&t.push({"namePrefix":e["deviceNamePrefix"]});const i={};t.length>0&&(i["filters"]=t),e["optionalServices"].length>0&&(i["optionalServices"]=e["optionalServices"]),e["acceptAllDevices"]&&(i["acceptAllDevices"]=!0);try{const e=await navigator["bluetooth"]["requestDevice"](i);e.addEventListener("gattserverdisconnected",()=>this._OnDeviceDisconnected(e)),await e["gatt"]["connect"](),this._devicesMap.set(e["id"],{device:e,primaryServicesCache:new Map}),this.PostToRuntime("device-connected",{"id":e["id"],"name":e["name"]||"(unknown)"})}catch(e){console.info("[Bluetooth] Requesting device failed: ",e),this.PostToRuntime("request-device-failed")}}_OnDeviceDisconnected(e){const t=e["id"];this._devicesMap.delete(t);let i="";for(const e of this._devicesMap.keys()){i=e;break}this.PostToRuntime("device-disconnected",{"id":t,"nextDefaultDeviceId":i})}_OnDisconnectDevice(e){const t=this._devicesMap.get(e["id"]);t&&t.device["gatt"]["disconnect"]()}async _OnRequestPrimaryServices(e){const t=e["id"],i=this._devicesMap.get(t);if(!i)return{"isOk":!1};try{const e=await i.device["gatt"]["getPrimaryServices"](),t=i.primaryServicesCache;for(const i of e){const e=i["uuid"];t.has(e)||t.set(e,{primaryService:i,characteristicsCache:new Map})}return{"isOk":!0,"uuids":e.map(e=>e["uuid"])}}catch(e){return console.warn(`[Bluetooth] Requesting device '${t}' primary services failed: `,e),{"isOk":!1}}}async _OnRequestCharacteristics(e){const t=e["id"],i=e["service"];try{const e=await this._GetPrimaryServiceInfo(t,i);if(!e)return{"isOk":!1};const r=await e.primaryService["getCharacteristics"](),c=e.characteristicsCache;for(const e of r){const t=e["uuid"];c.has(t)||c.set(t,{characteristic:e})}return{"isOk":!0,"uuids":r.map(e=>e["uuid"])}}catch(e){return console.warn(`[Bluetooth] Requesting device '${t}' service '${i}' characteristics failed: `,e),{"isOk":!1}}}async _OnReadCharacteristic(e){const i=e["id"],r=e["service"],c=e["characteristic"];let s=null;try{const e=await this._GetCharacteristicInfo(i,r,c);if(!e)return{"isOk":!1};s=e.characteristic;return{"isOk":!0,"arrayBuffer":(await e.characteristic["readValue"]()).buffer}}catch(e){let a=[];return s&&!s["properties"]["read"]&&(a=["\nNote the characteristic does not allow the 'read' property. The properties it does have are: ",t(s["properties"])]),console.warn(`[Bluetooth] Reading device '${i}' service '${r}' characteristic '${c}' failed: `,e,...a),{"isOk":!1}}}async _OnNotifyCharacteristic(e){const i=e["id"],r=e["service"],c=e["characteristic"];let s=null;try{const t=await this._GetCharacteristicInfo(i,r,c);return t?(s=t.characteristic,"start"===e["which"]?(await s["startNotifications"](),s.addEventListener("characteristicvaluechanged",e=>{this.PostToRuntime("characteristic-notification",{"id":i,"service":r,"characteristic":c,"arrayBuffer":s.value.buffer})})):await s["stopNotifications"](),{"isOk":!0}):{"isOk":!1}}catch(e){let a=[];return s&&!s["properties"]["notify"]&&(a=["\nNote the characteristic does not allow the 'notify' property. The properties it does have are: ",t(s["properties"])]),console.warn(`[Bluetooth] Setting notifications on device '${i}' service '${r}' characteristic '${c}' failed: `,e,...a),{"isOk":!1}}}async _OnWriteCharacteristic(e){const i=e["id"],r=e["service"],c=e["characteristic"],s=e["arrayBuffer"];let a=null;try{const e=await this._GetCharacteristicInfo(i,r,c);return e?(a=e.characteristic,await e.characteristic["writeValue"](s),{"isOk":!0}):{"isOk":!1}}catch(e){let s=[];return a&&!a["properties"]["write"]&&(s=["\nNote the characteristic does not allow the 'write' property. The properties it does have are: ",t(a["properties"])]),console.warn(`[Bluetooth] Writing device '${i}' service '${r}' characteristic '${c}' failed: `,e,...s),{"isOk":!1}}}};self.RuntimeInterface.AddDOMHandlerClass(i)}

// scripts/plugins/Button/dom/domSide.js
"use strict";{const e="button";function t(e){e.stopPropagation()}const n=class extends self.DOMElementHandler{constructor(t){super(t,e)}CreateElement(e,n){const s=document.createElement("input"),d=n["isCheckbox"];let l=s;if(d){s.type="checkbox";const e=document.createElement("label");e.appendChild(s),e.appendChild(document.createTextNode("")),e.style.fontFamily="sans-serif",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.display="inline-block",e.style.color="black",l=e}else s.type="button";return l.style.position="absolute",l.addEventListener("pointerdown",t),l.addEventListener("pointerrawupdate",t),l.addEventListener("pointerup",t),l.addEventListener("mousedown",t),l.addEventListener("mouseup",t),l.addEventListener("keydown",t),l.addEventListener("keyup",t),l.addEventListener("contextmenu",e=>e.preventDefault()),s.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",e,{"isChecked":s.checked})),n["id"]&&(s.id=n["id"]),n["className"]&&(s.className=n["className"]),this.UpdateState(l,n),l}_GetInputElem(e){return"input"===e.tagName.toLowerCase()?e:e.firstChild}_GetFocusElement(e){return this._GetInputElem(e)}UpdateState(e,t){const n=this._GetInputElem(e);n.checked=t["isChecked"],n.disabled=!t["isEnabled"],e.title=t["title"],e===n?n.value=t["text"]:e.lastChild.textContent=t["text"]}};self.RuntimeInterface.AddDOMHandlerClass(n)}

// scripts/plugins/Share/dom/domSide.js
"use strict";{const e="share";function t(){const e=self["RealFile"]||self["File"];return"function"==typeof navigator["canShare"]&&navigator["canShare"]({"files":[new e(["test file"],"test.txt",{})]})}const i=class extends self.DOMHandler{constructor(i){super(i,e);const s=!!this._GetSharePlugin();this._isSupported="function"==typeof navigator["share"]||s,this._isFilesSupported=t()||s,this.AddRuntimeMessageHandlers([["init",e=>this._OnInit(e)],["share",e=>this._OnShare(e)],["request-rate",e=>this._OnRateApp(e)],["request-store",e=>this._OnShowStore(e)]])}_OnInit(){return{"isSupported":this._isSupported,"isFilesSupported":this._isFilesSupported}}_GetSharePlugin(){return window["plugins"]&&window["plugins"]["socialsharing"]}_GetRatePlugin(){return window["cordova"]&&window["cordova"]["plugins"]&&window["cordova"]["plugins"]["RateApp"]}async _OnShare(e){const t=e["text"],i=e["title"],s=e["url"],r=e["files"].slice(0),o=r.length>0,n=this._GetSharePlugin();if(n){const e={};if(t&&(e["message"]=t),i&&(e["subject"]=i),s&&(e["url"]=s),o){let t=0;for(const e of r)t+=e.size;try{const i=await this._CordovaGetTempDirEntry(Math.floor(1.25*t));e["files"]=await Promise.all(r.map(e=>this._CordovaWriteTempFile(e,i)))}catch(e){return console.log("[Share plugin] Share failed: ",e),void this.PostToRuntime("share-failed")}}n["shareWithOptions"](e,()=>{this.PostToRuntime("share-completed")},e=>{console.log("[Share plugin] Share failed: ",e),this.PostToRuntime("share-failed")})}else{const e={};t&&(e["text"]=t),i&&(e["title"]=i),s&&(e["url"]=s),o&&(e["files"]=r);try{await navigator["share"](e),this.PostToRuntime("share-completed")}catch(e){console.log("[Share plugin] Share failed: ",e),this.PostToRuntime("share-failed")}}}_OnRateApp(e){const t=e["body"],i=e["confirm"],s=e["cancel"],r=e["appID"],o=this._GetRatePlugin();o&&o["Rate"](t,i,s,r)}_OnShowStore(e){const t=e["appID"],i=this._GetRatePlugin();i&&i["Store"](t)}_CordovaGetTempDirEntry(e){return new Promise((t,i)=>{window["requestFileSystem"](window["TEMPORARY"],e,e=>t(e["root"]),i)})}_CordovaWriteTempFile(e,t){return new Promise((i,s)=>{t["getFile"](e.name,{"create":!0,"exclusive":!1},t=>{const r=t["toURL"]();t["createWriter"](t=>{t["onwriteend"]=()=>i(r),t["onerror"]=s,t["write"](e)})},s)})}};self.RuntimeInterface.AddDOMHandlerClass(i)}

// scripts/plugins/FileSystem/dom/domSide.js
"use strict";{const e="filesystem";async function t(e,t,r){const i=await e["createWritable"]({"keepExistingData":!!r});if(r){const t=await e["getFile"]();await i["seek"](t.size)}await i["write"](t),await i["close"]()}function r(e){let t=e.replaceAll("\\","/");return t.startsWith("/")&&(t=t.substring(1)),t.endsWith("/")&&(t=t.substring(0,t.length-1)),t}async function i(e,t){"prompt"===await e["queryPermission"]({"mode":t})&&await e["requestPermission"]({"mode":t})}const a=["<app>","<web-resource>","<current-app-data>","<local-app-data>","<roaming-app-data>","<desktop>","<documents>","<downloads>","<pictures>","<profile>","<saved-games>","<screenshots>","<videos>"],n=class extends self.DOMHandler{constructor(t){super(t,e),this._pickerMap=new Map,this.AddRuntimeMessageHandlers([["init",e=>this._Init(e)],["show-save-file-picker",e=>this._ShowSaveFilePicker(e)],["show-open-file-picker",e=>this._ShowOpenFilePicker(e)],["show-folder-picker",e=>this._ShowFolderPicker(e)],["write-text-file",e=>this._WriteTextFile(e)],["write-binary-file",e=>this._WriteBinaryFile(e)],["read-text-file",e=>this._ReadTextFile(e)],["read-binary-file",e=>this._ReadBinaryFile(e)],["create-folder",e=>this._CreateFolder(e)],["copy-file",e=>this._CopyFile(e)],["delete",e=>this._Delete(e)],["list-content",e=>this._ListContent(e)]])}_Init(e){const t=e["pickerMap"];t&&(this._pickerMap=t);const r=this._iRuntime._GetDirectoryHandles(),i=new Set;for(let e=0,t=Math.min(r.length,a.length);e<t;++e){const t=r[e],n=a[e];t&&(this._pickerMap.set(n,[t]),i.add(n))}return{"isFSAPISupported":!!window["showSaveFilePicker"],"additionalPickerTags":i,"builtInPickerTags":a}}async _ShowSaveFilePicker(e){const t=e["pickerTag"],r=e["pickerOpts"];try{const e=await window["showSaveFilePicker"](r);return this._pickerMap.set(t,[e]),this._SavePickerMap(),{"isOk":!0,"pickedFileNames":[e["name"]]}}catch(e){return console.warn("[Construct] Error showing save file picker: ",e),{"isOk":!1}}}async _ShowOpenFilePicker(e){const t=e["pickerTag"],r=e["pickerOpts"];try{const e=await window["showOpenFilePicker"](r);return this._pickerMap.set(t,e),this._SavePickerMap(),{"isOk":!0,"pickedFileNames":e.map(e=>e["name"])}}catch(e){return console.warn("[Construct] Error showing open file picker: ",e),{"isOk":!1}}}async _ShowFolderPicker(e){const t=e["pickerTag"],r=e["pickerOpts"];try{const e=await window["showDirectoryPicker"](r);return this._pickerMap.set(t,[e]),this._SavePickerMap(),{"isOk":!0,"pickedFolderNames":[e["name"]]}}catch(e){return console.warn("[Construct] Error showing folder picker: ",e),{"isOk":!1}}}_SavePickerMap(){this.PostToRuntime("save-picker-map",{"pickerMap":this._pickerMap})}async _FollowPath(e,t,r){const i=t.split("/"),a=i.pop();for(const t of i)e=await e["getDirectoryHandle"](t,{"create":r});return{folderHandle:e,lastName:a}}async _GetFileHandleFor(e,t,a){const n=this._pickerMap.get(e);if(!Array.isArray(n)||0===n.length)throw new Error(`nothing picked for tag '${e}'`);if(1===n.length&&"directory"===n[0]["kind"]){const e=n[0];if(await i(e,a?"readwrite":"read"),!(t=r(t)))throw new Error("empty folder path");const o=await this._FollowPath(e,t,a);return await o.folderHandle["getFileHandle"](o.lastName,{"create":a})}if(1!==n.length||t){for(const e of n)if(e["name"]===t)return await i(e,a?"readwrite":"read"),e;throw new Error(`no file with name '${t}'`)}{const e=n[0];return await i(e,a?"readwrite":"read"),e}}async _GetFolderHandleFor(e,t,a){const n=this._pickerMap.get(e);if(!Array.isArray(n)||0===n.length)throw new Error(`nothing picked for tag '${e}'`);if(1===n.length&&"directory"===n[0]["kind"]){const e=n[0];return await i(e,a?"readwrite":"read"),t=r(t),await this._FollowPath(e,t,a)}throw new Error(`picker tag '${e}' is not for a folder`)}async _WriteTextFile(e){const r=e["pickerTag"],i=e["folderPath"],a=e["text"],n=e["keepExisting"];try{const e=await this._GetFileHandleFor(r,i,!0);return await t(e,a,n),{"isOk":!0}}catch(e){return console.error("[Construct] Error writing text file: ",e),{"isOk":!1}}}async _WriteBinaryFile(e){const r=e["pickerTag"],i=e["folderPath"],a=e["arrayBuffer"];try{const e=await this._GetFileHandleFor(r,i,!0);return await t(e,a),{"isOk":!0}}catch(e){return console.error("[Construct] Error writing binary file: ",e),{"isOk":!1}}}async _ReadTextFile(e){const t=e["pickerTag"],r=e["folderPath"];try{const e=await this._GetFileHandleFor(t,r,!1),i=await e["getFile"]();return{"isOk":!0,"text":await i["text"]()}}catch(e){return console.error("[Construct] Error reading text file: ",e),{"isOk":!1}}}async _ReadBinaryFile(e){const t=e["pickerTag"],r=e["folderPath"];try{const e=await this._GetFileHandleFor(t,r,!1),i=await e["getFile"]();return{"isOk":!0,"arrayBuffer":await i["arrayBuffer"]()}}catch(e){return console.error("[Construct] Error reading binary file: ",e),{"isOk":!1}}}async _CreateFolder(e){const t=e["pickerTag"],r=e["folderPath"];try{const{folderHandle:e,lastName:i}=await this._GetFolderHandleFor(t,r,!0);if(!i)throw new Error("empty folder path");return await e["getDirectoryHandle"](i,{"create":!0}),{"isOk":!0}}catch(e){return console.error("[Construct] Error creating folder: ",e),{"isOk":!1}}}async _CopyFile(e){const t=e["pickerTag"],r=e["srcFolderPath"],i=e["destFolderPath"];try{const e=await this._GetFolderHandleFor(t,i,!0),a=await this._GetFolderHandleFor(t,r,!1);if(!a.lastName||!e.lastName)throw new Error("empty folder path");const n=await a.folderHandle["getFileHandle"](a.lastName,{"create":!1}),o=await e.folderHandle["getFileHandle"](e.lastName,{"create":!0}),s=await n["getFile"](),c=await o["createWritable"]();return await s.stream().pipeTo(c),{"isOk":!0}}catch(e){return console.error("[Construct] Error copying file: ",e),{"isOk":!1}}}async _Delete(e){const t=e["pickerTag"],r=e["folderPath"],i=e["isRecursive"];try{const{folderHandle:e,lastName:a}=await this._GetFolderHandleFor(t,r,!1);if(!a)throw new Error("empty folder path");return await e["removeEntry"](a,{"recursive":i}),{"isOk":!0}}catch(e){return console.error("[Construct] Error deleting: ",e),{"isOk":!1}}}async _DoListContent(e,t,r,i,a){const n=[];try{for await(const a of e.values())"file"===a["kind"]?i.push(t+a["name"]):"directory"===a["kind"]?(r.push(t+a["name"]),n.push(a)):console.warn(`unknown folder entry kind '${a["kind"]}' (name '${a["name"]}')`)}catch(e){if(console.warn(`Error listing contents for path '${t}': `,e),""===t)throw e}a&&await Promise.all(n.map(e=>this._DoListContent(e,t+e["name"]+"/",r,i,a)))}async _ListContent(e){const t=e["pickerTag"],r=e["folderPath"],i=e["isRecursive"];try{let{folderHandle:e,lastName:a}=await this._GetFolderHandleFor(t,r,!1);a&&(e=await e["getDirectoryHandle"](a,{"create":!1}));const n=[],o=[];return await this._DoListContent(e,"",n,o,i),{"isOk":!0,"folderNames":n,"fileNames":o}}catch(e){return console.error("[Construct] Error listing content: ",e),{"isOk":!1}}}};self.RuntimeInterface.AddDOMHandlerClass(n)}

// scripts/plugins/filechooser/dom/domSide.js
"use strict";{const e="file-chooser";function t(e){e.stopPropagation()}const s=class extends self.DOMElementHandler{constructor(t){super(t,e),this.AddDOMElementMessageHandler("click",(e,t)=>this._Click(e,t)),this.AddDOMElementMessageHandler("clear",e=>this._Clear(e))}CreateElement(e,s){const n=document.createElement("input");return n.type="file",n.style.position="absolute",n.style.userSelect="none",n.style.webkitUserSelect="none",n.addEventListener("pointerdown",t),n.addEventListener("pointerrawupdate",t),n.addEventListener("pointerup",t),n.addEventListener("mousedown",t),n.addEventListener("mouseup",t),n.addEventListener("contextmenu",e=>e.preventDefault()),n.addEventListener("change",()=>this.PostToRuntimeElement("change",e,{"files":Array.from(n.files)})),s["id"]&&(n.id=s["id"]),s["className"]&&(n.className=s["className"]),this.UpdateState(n,s),n}UpdateState(e,t){e.setAttribute("accept",t["accept"]),t["isMultiSelect"]?e.setAttribute("multiple",""):e.removeAttribute("multiple"),t["isEnabled"]?e.removeAttribute("disabled"):e.setAttribute("disabled","")}_Click(e,t){e["click"]()}_Clear(e){e.value=""}};self.RuntimeInterface.AddDOMHandlerClass(s)}

// scripts/plugins/video/dom/domSide.js
"use strict";{function e(e){return e&&!e.paused&&!e.ended&&e.currentTime>0}const t="video",a=class extends self.DOMElementHandler{constructor(e){super(e,t),this.SetAutoAttach(!1),this._isRuntimeInWorker=!1,this._supportsRvfc=!1,this._postImageBitmaps=!1,this._sequenceNumber=0,this._numVideos=0,this._destroyedVideos=new WeakSet,this.AddRuntimeMessageHandler("init",e=>this._OnInit(e)),this.AddDOMElementMessageHandlers([["play",e=>this._OnPlay(e)],["pause",e=>this._OnPause(e)],["set-source",(e,t)=>this._OnSetSource(e,t)],["set-playback-time",(e,t)=>this._OnSetPlaybackTime(e,t)],["set-playback-rate",(e,t)=>this._OnSetPlaybackRate(e,t)],["set-looping",(e,t)=>this._OnSetLooping(e,t)],["set-muted",(e,t)=>this._OnSetMuted(e,t)],["set-volume",(e,t)=>this._OnSetVolume(e,t)]]),self["C3Video_GetElement"]=e=>this.GetElementById(e)}async _OnInit(e){this._isRuntimeInWorker=e["isInWorker"];const t=document.createElement("video");this._supportsRvfc=!!t["requestVideoFrameCallback"]&&!this._iRuntime.IsAndroidWebView();const a=!!self["createImageBitmap"];return this._postImageBitmaps=this._isRuntimeInWorker||a,{"postImageBitmaps":this._postImageBitmaps,"supportedFormats":{"webm-vp8":!!t.canPlayType("video/webm;codecs=vp8"),"webm-vp9":!!t.canPlayType("video/webm;codecs=vp9"),"webm-av1":!!t.canPlayType("video/webm;codecs=av01.0.00M.08"),"mp4-h264":!!t.canPlayType("video/mp4;codecs=avc1.420034"),"mp4-h265":!!t.canPlayType("video/mp4;codecs=hev1.1.2.L93.B0"),"mp4-av1":!!t.canPlayType("video/mp4;codecs=av01.0.00M.08")}}}TryPlayMedia(e){this._iRuntime.TryPlayMedia(e),this._postImageBitmaps&&this._supportsRvfc&&-1===e["c3_rvfcId"]&&(e["c3_rvfcId"]=e["requestVideoFrameCallback"](()=>this._OnVideoFrameCallback(e)))}RemovePendingPlay(e){this._iRuntime.RemovePendingPlay(e),this._postImageBitmaps&&this._supportsRvfc&&-1!==e["c3_rvfcId"]&&(e["cancelVideoFrameCallback"](e["c3_rvfcId"]),e["c3_rvfcId"]=-1)}async _OnVideoFrameCallback(e){if(!this._destroyedVideos.has(e)){e["c3_rvfcId"]=e["requestVideoFrameCallback"](()=>this._OnVideoFrameCallback(e));try{const t=e["c3_sequenceNumber"]++,a=await createImageBitmap(e);t>e["c3_lastFrameSequence"]&&(e["c3_imageBitmap"]=a,e["c3_lastFrameSequence"]=t)}catch(e){}}}CreateElement(e,t){const a=document.createElement("video");a.crossOrigin="anonymous",a["playsInline"]=!0,a["c3_imageBitmap"]=null,a["c3_rvfcId"]=-1,a["c3_sequenceNumber"]=0,a["c3_lastFrameSequence"]=-1,a.addEventListener("canplay",()=>this._SendPlaybackEvent(a,e,0)),a.addEventListener("canplaythrough",()=>this._SendPlaybackEvent(a,e,1)),a.addEventListener("ended",()=>this._SendPlaybackEvent(a,e,2)),a.addEventListener("error",()=>this._SendPlaybackEvent(a,e,3)),a.addEventListener("loadstart",()=>this._SendPlaybackEvent(a,e,4)),a.addEventListener("playing",()=>this._SendPlaybackEvent(a,e,5)),a.addEventListener("pause",()=>this._SendPlaybackEvent(a,e,6)),a.addEventListener("stalled",()=>this._SendPlaybackEvent(a,e,7));const s=t["autoplay"];return 0===s?(a.autoplay=!1,a.preload="none"):1===s?(a.autoplay=!1,a.preload="auto"):a.autoplay=!0,t["src"]&&(a.src=t["src"]),2===s&&this.TryPlayMedia(a),this._numVideos++,this._StartTicking(),a}_SendPlaybackEvent(e,t,a){this._destroyedVideos.has(e)||this.PostToRuntimeElement("playback-event",t,{"type":a})}UpdateState(e,t){}DestroyElement(t){this.RemovePendingPlay(t),e(t)&&t.pause(),t.src="",this._numVideos=Math.max(this._numVideos-1,0),0===this._numVideos&&this._StopTicking(),this._destroyedVideos.add(t)}_OnPlay(e){this.TryPlayMedia(e)}_OnPause(e){this.RemovePendingPlay(e),e.pause()}_OnSetSource(e,t){e.src=t["src"],e.load()}_OnSetPlaybackTime(e,t){try{e.currentTime=t["time"]}catch(e){console.error("[Video] Exception setting playback time: ",e)}}_OnSetPlaybackRate(e,t){try{e.playbackRate=t["rate"]}catch(e){console.error("[Video] Exception setting playback rate: ",e)}}_OnSetLooping(e,t){e.loop=t["isLooping"]}_OnSetMuted(e,t){e.muted=t["isMuted"]}_OnSetVolume(e,t){e.volume=t["volume"]}Tick(){const e={},t={"sequenceNumber":this._sequenceNumber++,"videoData":e},a=[],s=[];for(const[t,i]of this._elementMap.entries()){const n=i.GetElement(),c={"currentTime":n.currentTime,"playbackRate":n.playbackRate,"duration":n.duration,"videoWidth":n.videoWidth,"videoHeight":n.videoHeight};if(this._postImageBitmaps)if(this._supportsRvfc){const e=n["c3_imageBitmap"];n["c3_imageBitmap"]=null,c["imageBitmap"]=e,e&&a.push(e)}else s.push(createImageBitmap(n).then(e=>{c["imageBitmap"]=e,a.push(e)}).catch(e=>{c["imageBitmap"]=null}));e[t.toString()]=c}Promise.all(s).then(()=>{this._isRuntimeInWorker?this.PostToRuntime("state",t,!1,a):this._PostToRuntimeMaybeSync("state",t)})}};self.RuntimeInterface.AddDOMHandlerClass(a)}

// start-export.js
"use strict";if(window["C3_IsSupported"]){const e=false;window["c3_runtimeInterface"]=new self.RuntimeInterface({useWorker:e,workerMainUrl:"workermain.js",runtimeScriptList:["scripts/c3main.js"],scriptFolder:"scripts/",exportType:"html5"})}
